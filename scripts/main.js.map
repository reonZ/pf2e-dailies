{"version":3,"file":"main.js","mappings":"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GAEfrG,OAAOwH,OAAOnB,ICrBjCoB,EAAgB,CACzB,SACA,WACA,UACA,QACA,UACA,SACA,WACA,QACA,SACA,SACA,cACA,QACA,UACA,QACA,OACA,YACA,aACA,UACA,QACA,mBACA,UACA,WACA,QACA,WACA,QACA,UACA,QACA,UACA,YACA,UACA,WACA,aACA,SACA,UACA,SACA,UACA,UACA,UACA,aACA,QACA,SACA,UACA,SACA,OACA,UACA,QACA,UACA,UACA,WACA,QACA,UACA,QACA,QACA,YACA,UACA,UACA,SACA,UACA,SACA,UACA,WACA,SACA,QACA,SACA,SACA,SACA,UACA,WACA,UACA,OACA,UACA,YACA,UACA,UACA,SACA,eACA,UACA,QACA,UACA,SACA,QACA,SACA,QACA,UACA,aACA,QACA,SACA,eACA,OACA,UACA,SACA,WACA,QACA,aACA,UACA,UACA,SACA,YACA,UACA,SACA,WACA,OACA,UACA,WACA,YACA,OACA,UACA,WCpGG,SAASC,EAAWtE,GACvB,OAAKA,EACEA,EAAI,GAAG2C,cAAgB3C,EAAI4C,MAAM,GADvB,EAErB,CCXO,SAAS2B,EAAyCC,EAAeC,GACpE,MAAMC,EAAmB,GAEzB,GAAIF,GAASC,EACT,IAAK,IAAIE,EAAIH,EAAOG,GAAKF,EAAKE,IAAKD,EAAOE,KAAKD,QAE/C,IAAK,IAAIA,EAAIH,EAAOG,GAAKF,EAAKE,IAAKD,EAAOE,KAAKD,GAGnD,OAAOD,CACX,CCHA,MAAMG,EAAkB,+BAQXC,EAAQ,CAEbC,iBACA,OAAOb,EAAiBtB,OAC5B,EACAoC,WAAaC,GACFrH,KAAKwB,KAAKH,SAASiG,OAAOC,KAAKC,UAAUH,IAEpDI,uBAAwB,EAAGJ,QAAOlH,QAAOuH,OAAO,UAAWC,gBACvD,MAAMC,EAAqB,CACvB9I,IAAK,mBACL4I,OACAhI,KAAM,iBAAiB2H,SACvBlH,SAGJ,OADIwH,GAAaA,EAAUE,SAAQD,EAAKD,UAAYA,GAC7CC,CAAI,EAEfE,iBAAkB,EAAGvH,OAAMwH,WACe,CAClCnF,KAAM,OACNoF,IAAK,4C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A,uFACA,kEACA,GACA,0DACA,GACA,6CACA,0CACA,+DACA,+CACA,wEACA,QACA,uBACA,IACA,GACA,qCACA,4BACA,mBACA,cACA,0EACA,SACA,kBACA,YACA,6BACA,yFACA,wDACA,aACA,YACA,8BACA,sFACA,wDACA,aACA,YACA,+BACA,uFACA,aACA,YACA,+BACA,2FACA,0DACA,aACA,SACA,iDACA,8CACA,yCACA,wGACA,GACA,oCACA,2BACA,+CACA,gDACA,YACA,GACA,+BACA,kCACA,6EACA,0DACA,2DACA,YACA,kEACA,4EACA,8EACA,GACA,qCACA,+DACA,gEACA,uBACA,kFACA,+DACA,gEACA,gBACA,YACA,kBACA,iBACA,qCACA,kFACA,+DACA,gEACA,4CACA,kFACA,kFACA,+DACA,gEACA,uBACA,kFACA,+DACA,gEACA,gBACA,YACA,GACA,wBACA,SACA,kCACA,qDACA,wBACA,6BACA,6BACA,0FACA,gEACA,0DACA,YACA,qBACA,UACA,4EACA,wCACA,GACA,wCACA,gDACA,gDACA,GACA,sDACA,+EACA,kCACA,uBACA,6FACA,kDACA,kCACA,gBACA,GACA,6FACA,YACA,SACA,IACA,GACA,0BACFtmB,KAAK,MC/HM4O,GAAc,CACvB,8DACA,gDACA,+EACA,GACA,MACA,kCACA,2BACA,uCACA,MACA,2CACA,uDACA,oBACA,wBACA,uCACA,gBACA,oBACA,4BACA,wBACA,uCACA,4BACA,2CACA,qBACA,yBACA,iBACA,aACA,QACA,8CACA,iBACA,IACA,GACA,4CACA,8BACA,0BACA,cACA,wFACA,SACA,kBACA,YACA,gCACA,8FACA,aACA,SACA,cACA,0CACA,iDACA,SACA,2EACA,+CACA,4DACA,0BACA,0CACA,GACA,mCACA,gDACA,gEACA,iDACA,8CACA,YACA,SACA,IACA,GACA,4BACF5O,KAAK,MC/DMumB,GAAS,CAClB,sEACA,0FACA,iEACA,GACA,6EACA,GACA,MACA,kCACA,uCACA,MACA,+DACA,sBACA,2BACA,GACA,gDACA,8EACA,GACA,2CACA,qCACA,sCACA,8EACA,YACA,GACA,+FACA,QACA,GACA,8DACA,IACA,GACA,uCACA,yBACA,qBACA,cACA,+EACA,SACA,gCACA,6FACA,mBACA,8DACA,+DACA,2FACA,4FACA,YACA,SACA,kCACA,sDACA,wBACA,4BACA,6BACA,gFACA,wBACA,iCACA,6CACA,2CACA,8CACA,oDACA,sBACA,iBACA,oEACA,YACA,qBACA,UACA,yEACA,uDACA,sCACA,2GACA,8BACA,oEACA,YACA,SACA,IACA,GACA,uBACFvmB,KAAK,MC1EMwmB,GAAO,CAChB,gFACA,yEACA,0DACA,GACA,gFACA,GACA,8BACA,iFACA,wEACA,+DACA,wEACA,IACA,GACA,sEACA,yBACA,yBACA,2BACA,IACA,GACA,6EACA,GACA,yDACA,GACA,8FACA,GACA,iCACA,kBACA,mBACA,0BACA,2BACA,wBACA,sBACA,sBACA,2BACA,cACA,gBACA,IACA,GACA,qCACA,sBACA,wBACA,cACA,uFACA,SACA,kBACA,YACA,8BACA,qDACA,aACA,YACA,8BACA,4FACA,aACA,YACA,6BACA,yFACA,aACA,YACA,gCACA,kGACA,aACA,SACA,cACA,YACA,6BACA,6BACA,8CACA,mBACA,mDACA,aACA,YACA,8BACA,6BACA,mCACA,4CACA,2DACA,0CACA,aACA,YACA,8BACA,8BACA,qCACA,sCACA,gEACA,oDACA,aACA,YACA,8BACA,6BACA,uCACA,qCACA,wEACA,wEACA,8FACA,aACA,YACA,8BACA,gCACA,uCACA,6CACA,wEACA,sDACA,8FACA,aACA,SACA,8EACA,yCACA,8BACA,GACA,yCACA,GACA,0EACA,wHACA,oHACA,GACA,iCACA,mDACA,kFACA,oEACA,4EACA,0CACA,8DACA,8CACA,wCACA,iBACA,YACA,GACA,4FACA,gEACA,qEACA,4DACA,2CACA,GACA,sEACA,6HACA,8CACA,0EACA,wCACA,0CACA,qBACA,gBACA,YACA,SACA,kDACA,oDACA,GACA,+DACA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","sources":["webpack:///webpack/bootstrap","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///../../../../foundryVTT-projects/@utils/module.ts","webpack:///../../../../foundryVTT-projects/@utils/foundry/path.ts","webpack:///../../../../foundryVTT-projects/@utils/foundry/settings.ts","webpack:///../../../../foundryVTT-projects/@utils/foundry/flags.ts","webpack:///../../../../foundryVTT-projects/@utils/foundry/localize.ts","webpack:///../../../../foundryVTT-projects/@utils/foundry/notification.ts","webpack:///../../../../foundryVTT-projects/@utils/pf2e/dc.ts","webpack:///../../../../foundryVTT-projects/@utils/foundry/uuid.ts","webpack:///../../../../foundryVTT-projects/@utils/pf2e/spell.ts","webpack:///../../../../foundryVTT-projects/@utils/pf2e/utils.ts","webpack:///../../../../foundryVTT-projects/@utils/pf2e/item.ts","webpack:///../../../../foundryVTT-projects/@utils/pf2e/skills.ts","webpack:///../../../../foundryVTT-projects/@utils/pf2e/languages.ts","webpack:///../../../../foundryVTT-projects/@utils/string.ts","webpack:///../../../../foundryVTT-projects/@utils/utils.ts","webpack:///./src/api.ts","webpack:///./src/data/spell.ts","webpack:///./src/data/ace.ts","webpack:///./src/data/chain.ts","webpack:///./src/data/feat.ts","webpack:///./src/data/flexibility.ts","webpack:///./src/data/language.ts","webpack:///./src/data/mind.ts","webpack:///./src/data/rations.ts","webpack:///../../../../foundryVTT-projects/@utils/foundry/item.ts","webpack:///./src/data/resistance.ts","webpack:///./src/data/savant.ts","webpack:///./src/data/skill.ts","webpack:///./src/data/tome.ts","webpack:///../../../../foundryVTT-projects/@utils/function.ts","webpack:///./src/dailies.ts","webpack:///./src/data/familiar.ts","webpack:///../../../../foundryVTT-projects/@utils/pf2e/predicate.ts","webpack:///./src/apps/interface/data.ts","webpack:///./src/apps/interface/shared.ts","webpack:///./src/apps/interface/drop.ts","webpack:///./src/apps/interface/process.ts","webpack:///./src/apps/interface.ts","webpack:///../../../../foundryVTT-projects/@utils/foundry/module.ts","webpack:///./src/apps/customs/tome.ts","webpack:///./src/apps/customs/flexibility.ts","webpack:///./src/apps/customs/savant.ts","webpack:///./src/apps/customs/mind.ts","webpack:///./src/apps/customs.ts","webpack:///./src/main.ts","webpack:///./src/rest.ts","webpack:///./src/sheet.ts","webpack:///../../../../foundryVTT-projects/@utils/libwrapper.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","export let MODULE_ID = ''\r\nexport let TYPE = 'module'\r\n\r\nexport function setModuleID(id: string, isSystem = false) {\r\n    if (!MODULE_ID) MODULE_ID = id\r\n    TYPE = isSystem ? 'system' : 'module'\r\n}\r\n","import { MODULE_ID, TYPE } from '@utils/module'\r\n\r\nexport function getSettingLocalizationPath(...path: string[]) {\r\n    return `${MODULE_ID}.settings.${path.join('.')}`\r\n}\r\n\r\nexport function flagsUpdatePath(...path: string[]) {\r\n    return `flags.${MODULE_ID}.${path.join('/')}`\r\n}\r\n\r\nexport function templatePath(...path: string[]) {\r\n    path = path.filter(x => typeof x === 'string')\r\n    return `${TYPE}s/${MODULE_ID}/templates/${path.join('/')}`\r\n}\r\n\r\nexport function imagePath(...path: string[]) {\r\n    return `${TYPE}s/${MODULE_ID}/images/${path.join('/')}`\r\n}\r\n","import { MODULE_ID } from '@utils/module'\r\nimport { getSettingLocalizationPath } from '@utils/foundry/path'\r\n\r\nexport function getSetting<T extends any>(key: string) {\r\n    return game.settings.get(MODULE_ID, key) as T\r\n}\r\n\r\nexport function setSetting(key: string, value: unknown) {\r\n    return game.settings.set(MODULE_ID, key, value)\r\n}\r\n\r\n/**\r\n * options.scope = 'world'\r\n *\r\n * options.config = false\r\n */\r\nexport function registerSetting<\r\n    TType extends number | string | boolean | object | Function,\r\n    TChoices extends Record<string, unknown> | undefined\r\n>(options: Omit<SettingRegistration<TType, TChoices>, 'choices'> & { choices?: string[] | Record<string, unknown> }) {\r\n    const name = options.name\r\n    options.scope = options.scope ?? 'world'\r\n    options.config = options.config ?? false\r\n    if (options.config) {\r\n        options.name = getSettingLocalizationPath(name, 'name')\r\n        options.hint = getSettingLocalizationPath(name, 'hint')\r\n    }\r\n    if (Array.isArray(options.choices)) {\r\n        options.choices = options.choices.reduce((choices, choice) => {\r\n            choices[choice] = getSettingLocalizationPath(name, 'choices', choice)\r\n            return choices\r\n        }, {} as Record<string, unknown>)\r\n    }\r\n    game.settings.register<TType, TChoices>(MODULE_ID, name, options as SettingRegistration<TType, TChoices>)\r\n}\r\n\r\n/**\r\n * options.restricted = true\r\n *\r\n * options.icon = 'fas fa-cogs'\r\n */\r\nexport function registerSettingMenu(\r\n    options: RequiredBy<Partial<Omit<SettingSubmenuConfig, 'type'>>, 'name'> & { type: ConstructorOf<FormApplication> }\r\n) {\r\n    const name = options.name\r\n    options.name = getSettingLocalizationPath('menus', name, 'name')\r\n    options.label = getSettingLocalizationPath('menus', name, 'label')\r\n    options.hint = getSettingLocalizationPath('menus', name, 'hint')\r\n    options.restricted = options.restricted ?? true\r\n    options.icon = options.icon ?? 'fas fa-cogs'\r\n    game.settings.registerMenu(MODULE_ID, name, options as SettingSubmenuConfig)\r\n}\r\n\r\nexport function getCombatTrackerConfig() {\r\n    return game.settings.get('core', 'combatTrackerConfig') as { resource: string; skipDefeated: boolean }\r\n}\r\n","import { MODULE_ID } from '@utils/module'\r\n\r\nexport function hasModuleFlag(doc: FoundryDocument) {\r\n    return getProperty(doc, `flags.${MODULE_ID}`) !== undefined\r\n}\r\n\r\nexport function flagPath(key: string) {\r\n    return `flags.${MODULE_ID}.key`\r\n}\r\n\r\nexport function getFlag<T extends unknown>(doc: FoundryDocument, key: string): T | undefined\r\nexport function getFlag<T extends unknown>(doc: FoundryDocument, key: string, fallback: T): T\r\nexport function getFlag<T extends unknown>(doc: FoundryDocument, key: string, fallback?: T): T | undefined {\r\n    return (doc.getFlag(MODULE_ID, key) as T | undefined) ?? fallback\r\n}\r\n\r\n/**\r\n * @template {foundry.Document} T\r\n * @param {T} doc\r\n * @param {string} key\r\n * @param {any} value\r\n * @returns T\r\n */\r\nexport function setFlag(doc: FoundryDocument, key: string, value: unknown) {\r\n    return doc.setFlag(MODULE_ID, key, value)\r\n}\r\n\r\nexport function getSourceId(doc: ClientDocumentMixin) {\r\n    return doc.getFlag<ItemUUID>('core', 'sourceId')\r\n}\r\n\r\nexport function hasSourceId(doc: ClientDocumentMixin, sourceId: DocumentUUID) {\r\n    return getSourceId(doc) === sourceId\r\n}\r\n\r\nexport function includesSourceId(doc: ClientDocumentMixin, list: DocumentUUID[]) {\r\n    const sourceId = getSourceId(doc)\r\n    return sourceId ? list.includes(sourceId) : false\r\n}\r\n","import { MODULE_ID } from '@utils/module'\r\nimport { warn, NotifyArgs, info, error } from '@utils/foundry/notification'\r\n\r\nexport type LocalizeArgs = [key: string, data?: Record<string, string | number | boolean>]\r\n\r\nexport function localize(...args: LocalizeArgs) {\r\n    let [key, data] = args\r\n    key = `${MODULE_ID}.${key}`\r\n    if (data) return game.i18n.format(key, data)\r\n    return game.i18n.localize(key)\r\n}\r\n\r\nexport function hasLocalization(key: string) {\r\n    return game.i18n.has(`${MODULE_ID}.${key}`, false)\r\n}\r\n\r\nexport function localizePath(key: string) {\r\n    return `${MODULE_ID}.${key}`\r\n}\r\n\r\nexport function localizeTemplate(key: string, { hash }: { hash: Record<string, string> }) {\r\n    return localize(`${key}`, hash)\r\n}\r\n\r\nexport function subLocalize(subKey: string) {\r\n    const fn = (...args: LocalizeArgs) => localize(`${subKey}.${args[0]}`, args[1])\r\n\r\n    Object.defineProperties(fn, {\r\n        warn: {\r\n            value: (...args: NotifyArgs) => warn(`${subKey}.${args[0]}`, args[1], args[2]),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n        info: {\r\n            value: (...args: NotifyArgs) => info(`${subKey}.${args[0]}`, args[1], args[2]),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n        error: {\r\n            value: (...args: NotifyArgs) => error(`${subKey}.${args[0]}`, args[1], args[2]),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n        has: {\r\n            value: (key: string) => hasLocalization(`${subKey}.${key}`),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n        path: {\r\n            value: (key: string) => localizePath(`${subKey}.${key}`),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n        template: {\r\n            value: (key: string, { hash }: { hash: Record<string, string> }) => fn(key, hash),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n    })\r\n\r\n    return fn as ((...args: LocalizeArgs) => string) & {\r\n        warn: (...args: NotifyArgs) => void\r\n        info: (...args: NotifyArgs) => void\r\n        error: (...args: NotifyArgs) => void\r\n        has: (key: string) => boolean\r\n        path: (key: string) => string\r\n        template: (key: string, options: { hash: Record<string, string> }) => string\r\n    }\r\n}\r\n","import { localize } from '@utils/foundry/localize'\r\n\r\nexport type NotifyArgs = [str: string, arg1?: boolean | Record<string, string | number | boolean>, arg2?: boolean]\r\n\r\nfunction notify(\r\n    str: string,\r\n    arg1?: 'warning' | 'info' | 'error' | boolean | Record<string, string | number | boolean>,\r\n    arg2?: boolean | Record<string, string | number | boolean>,\r\n    arg3?: boolean\r\n) {\r\n    const type = typeof arg1 === 'string' ? arg1 : 'info'\r\n    const data = typeof arg1 === 'object' ? arg1 : typeof arg2 === 'object' ? arg2 : undefined\r\n    const permanent = typeof arg1 === 'boolean' ? arg1 : typeof arg2 === 'boolean' ? arg2 : arg3 ?? false\r\n\r\n    ui.notifications.notify(localize(str, data), type, { permanent })\r\n}\r\n\r\nexport function warn(...args: NotifyArgs) {\r\n    const [str, arg1, arg2] = args\r\n    notify(str, 'warning', arg1, arg2)\r\n}\r\n\r\nexport function info(...args: NotifyArgs) {\r\n    const [str, arg1, arg2] = args\r\n    notify(str, 'info', arg1, arg2)\r\n}\r\n\r\nexport function error(...args: NotifyArgs) {\r\n    const [str, arg1, arg2] = args\r\n    notify(str, 'error', arg1, arg2)\r\n}\r\n","const dcByLevel = new Map<number, number>()\r\ndcByLevel.set(-1, 13)\r\ndcByLevel.set(0, 14)\r\ndcByLevel.set(1, 15)\r\ndcByLevel.set(2, 16)\r\ndcByLevel.set(3, 18)\r\ndcByLevel.set(4, 19)\r\ndcByLevel.set(5, 20)\r\ndcByLevel.set(6, 22)\r\ndcByLevel.set(7, 23)\r\ndcByLevel.set(8, 24)\r\ndcByLevel.set(9, 26)\r\ndcByLevel.set(10, 27)\r\ndcByLevel.set(11, 28)\r\ndcByLevel.set(12, 30)\r\ndcByLevel.set(13, 31)\r\ndcByLevel.set(14, 32)\r\ndcByLevel.set(15, 34)\r\ndcByLevel.set(16, 35)\r\ndcByLevel.set(17, 36)\r\ndcByLevel.set(18, 38)\r\ndcByLevel.set(19, 39)\r\ndcByLevel.set(20, 40)\r\ndcByLevel.set(21, 42)\r\ndcByLevel.set(22, 44)\r\ndcByLevel.set(23, 46)\r\ndcByLevel.set(24, 48)\r\ndcByLevel.set(25, 50)\r\n\r\nconst dcAdjustments = new Map<DCAdjustment, number>()\r\ndcAdjustments.set('incredibly easy', -10)\r\ndcAdjustments.set('very easy', -5)\r\ndcAdjustments.set('easy', -2)\r\ndcAdjustments.set('normal', 0)\r\ndcAdjustments.set('hard', 2)\r\ndcAdjustments.set('very hard', 5)\r\ndcAdjustments.set('incredibly hard', 10)\r\n\r\n/**\r\n * Normal Level Based DCs\r\n * @param level\r\n * @param proficiencyWithoutLevel\r\n */\r\nexport function calculateDC(level: number, { proficiencyWithoutLevel = false, rarity = 'common' }: DCOptions = {}): number {\r\n    // assume level 0 if garbage comes in. We cast level to number because the backing data may actually have it\r\n    // stored as a string, which we can't catch at compile time\r\n    const dc = dcByLevel.get(level) ?? 14\r\n    if (proficiencyWithoutLevel) {\r\n        // -1 shouldn't be subtracted since it's just\r\n        // a creature level and not related to PC levels\r\n        return adjustDCByRarity(dc - Math.max(level, 0), rarity)\r\n    } else {\r\n        return adjustDCByRarity(dc, rarity)\r\n    }\r\n}\r\n\r\nexport function adjustDCByRarity(dc: number, rarity: Rarity = 'common') {\r\n    return adjustDC(dc, rarityToDCAdjustment(rarity))\r\n}\r\n\r\nexport function adjustDC(dc: number, adjustment: DCAdjustment = 'normal') {\r\n    return dc + (dcAdjustments.get(adjustment) ?? 0)\r\n}\r\n\r\nexport function rarityToDCAdjustment(rarity: Rarity = 'common'): PositiveDCAdjustment {\r\n    if (rarity === 'uncommon') {\r\n        return 'hard'\r\n    } else if (rarity === 'rare') {\r\n        return 'very hard'\r\n    } else if (rarity === 'unique') {\r\n        return 'incredibly hard'\r\n    } else {\r\n        return 'normal'\r\n    }\r\n}\r\n","export function chatUUID(uuid: string, name?: string) {\r\n    if (name) return `@UUID[${uuid}]{${name}}`\r\n    return `@UUID[${uuid}]`\r\n}\r\n\r\nexport function fakeChatUUID(name: string) {\r\n    return `<span style=\"background: #DDD;\r\n    padding: 1px 4px;\r\n    border: 1px solid var(--color-border-dark-tertiary);\r\n    border-radius: 2px;\r\n    white-space: nowrap;\r\n    word-break: break-all;\">${name}</span>`\r\n}\r\n\r\nexport function documentUuidFromTableResult(result: TableResult) {\r\n    if (result.type === CONST.TABLE_RESULT_TYPES.DOCUMENT) return `${result.documentCollection}.${result.documentId}`\r\n    if (result.type === CONST.TABLE_RESULT_TYPES.COMPENDIUM) return `Compendium.${result.documentCollection}.${result.documentId}`\r\n    return undefined\r\n}\r\n","import { chatUUID } from '@utils/foundry/uuid'\r\n\r\nexport const MAGIC_TRADITIONS = new Set(['arcane', 'divine', 'occult', 'primal'] as const)\r\n\r\nexport const SPELL_COMPONENTS = ['focus', 'material', 'somatic', 'verbal'] as const\r\n\r\nconst scrolls: (ConsumablePF2e | null)[] = []\r\nexport async function createSpellScroll(uuid: ItemUUID, level: OneToTen | false, temp = false) {\r\n    const spell = (await fromUuid<SpellPF2e>(uuid))?.toObject()\r\n    if (!spell) return null\r\n\r\n    if (level === false) level = spell.system.level.value\r\n\r\n    const scrollUUID = getScrollCompendiumUUID(level)\r\n    scrolls[level] ??= await fromUuid<ConsumablePF2e>(scrollUUID)\r\n\r\n    const scroll = scrolls[level]?.toObject()\r\n    if (!scroll) return null\r\n\r\n    spell.system.location.heightenedLevel = level\r\n\r\n    scroll.name = `Scroll of ${spell.name} (Level ${level})`\r\n    scroll.system.temporary = temp\r\n    scroll.system.spell = spell\r\n    scroll.system.traits.value.push(...spell.system.traditions.value)\r\n\r\n    const sourceId = spell.flags.core?.sourceId\r\n    if (sourceId) scroll.system.description.value = `${chatUUID(sourceId)}\\n<hr />${scroll.system.description.value}`\r\n\r\n    return scroll\r\n}\r\n\r\nfunction getScrollCompendiumUUID(level: OneToTen): ItemUUID {\r\n    return `Compendium.pf2e.equipment-srd.${scrollCompendiumIds[level]}`\r\n}\r\n\r\nconst scrollCompendiumIds: Record<number, string> = {\r\n    1: 'RjuupS9xyXDLgyIr', // Compendium.pf2e.equipment-srd.RjuupS9xyXDLgyIr\r\n    2: 'Y7UD64foDbDMV9sx',\r\n    3: 'ZmefGBXGJF3CFDbn',\r\n    4: 'QSQZJ5BC3DeHv153',\r\n    5: 'tjLvRWklAylFhBHQ',\r\n    6: '4sGIy77COooxhQuC',\r\n    7: 'fomEZZ4MxVVK3uVu',\r\n    8: 'iPki3yuoucnj7bIt',\r\n    9: 'cFHomF3tty8Wi1e5',\r\n    10: 'o1XIHJ4MJyroAHfF',\r\n}\r\n","const wordCharacter = String.raw`[\\p{Alphabetic}\\p{Mark}\\p{Decimal_Number}\\p{Join_Control}]`\r\nconst nonWordCharacter = String.raw`[^\\p{Alphabetic}\\p{Mark}\\p{Decimal_Number}\\p{Join_Control}]`\r\nconst nonWordCharacterRE = new RegExp(nonWordCharacter, 'gu')\r\n\r\nconst wordBoundary = String.raw`(?:${wordCharacter})(?=${nonWordCharacter})|(?:${nonWordCharacter})(?=${wordCharacter})`\r\nconst nonWordBoundary = String.raw`(?:${wordCharacter})(?=${wordCharacter})`\r\nconst lowerCaseLetter = String.raw`\\p{Lowercase_Letter}`\r\nconst upperCaseLetter = String.raw`\\p{Uppercase_Letter}`\r\nconst lowerCaseThenUpperCaseRE = new RegExp(`(${lowerCaseLetter})(${upperCaseLetter}${nonWordBoundary})`, 'gu')\r\n\r\nconst nonWordCharacterHyphenOrSpaceRE = /[^-\\p{White_Space}\\p{Alphabetic}\\p{Mark}\\p{Decimal_Number}\\p{Join_Control}]/gu\r\nconst upperOrWordBoundariedLowerRE = new RegExp(`${upperCaseLetter}|(?:${wordBoundary})${lowerCaseLetter}`, 'gu')\r\n\r\n/**\r\n * The system's sluggification algorithm for labels and other terms.\r\n * @param text The text to sluggify\r\n * @param [options.camel=null] The sluggification style to use\r\n */\r\nexport function sluggify(text: string, { camel = null }: { camel?: 'dromedary' | 'bactrian' | null } = {}): string {\r\n    // Sanity check\r\n    if (typeof text !== 'string') {\r\n        console.warn('Non-string argument passed to `sluggify`')\r\n        return ''\r\n    }\r\n\r\n    switch (camel) {\r\n        case null:\r\n            return text\r\n                .replace(lowerCaseThenUpperCaseRE, '$1-$2')\r\n                .toLowerCase()\r\n                .replace(/[']/g, '')\r\n                .replace(nonWordCharacterRE, ' ')\r\n                .trim()\r\n                .replace(/[-\\s]+/g, '-')\r\n        case 'bactrian': {\r\n            const dromedary = sluggify(text, { camel: 'dromedary' })\r\n            return dromedary.charAt(0).toUpperCase() + dromedary.slice(1)\r\n        }\r\n        case 'dromedary':\r\n            return text\r\n                .replace(nonWordCharacterHyphenOrSpaceRE, '')\r\n                .replace(/[-_]+/g, ' ')\r\n                .replace(upperOrWordBoundariedLowerRE, (part, index) => (index === 0 ? part.toLowerCase() : part.toUpperCase()))\r\n                .replace(/\\s+/g, '')\r\n        default:\r\n            throw ErrorPF2e(\"I don't think that's a real camel.\")\r\n    }\r\n}\r\n\r\nexport function ErrorPF2e(message: string): Error {\r\n    return Error(`PF2e System | ${message}`)\r\n}\r\n\r\n/** Check if an element is present in the provided set. Especially useful for checking against literal sets */\r\nexport function setHasElement<T extends Set<unknown>>(set: T, value: unknown): value is SetElement<T> {\r\n    return set.has(value)\r\n}\r\n","import { adjustDCByRarity, calculateDC } from '@utils/pf2e/dc'\r\nimport { MAGIC_TRADITIONS } from '@utils/pf2e/spell'\r\nimport { setHasElement } from '@utils/pf2e/utils'\r\n\r\nexport function identifyItem(\r\n    item: PhysicalItemPF2e,\r\n    { proficiencyWithoutLevel = false, notMatchingTraditionModifier }: IdentifyItemOptions\r\n): GenericIdentifyDCs | IdentifyMagicDCs | IdentifyAlchemyDCs {\r\n    const baseDC = calculateDC(item.level, { proficiencyWithoutLevel })\r\n    const rarity = getDcRarity(item)\r\n    const dc = adjustDCByRarity(baseDC, rarity)\r\n    if (item.isMagical) {\r\n        return identifyMagic(item, dc, notMatchingTraditionModifier)\r\n    } else if (item.isAlchemical) {\r\n        return { cra: dc }\r\n    } else {\r\n        return { dc: dc }\r\n    }\r\n}\r\n\r\n/** All cursed items are incredibly hard to identify */\r\nfunction getDcRarity(item: PhysicalItemPF2e): Rarity {\r\n    return item.traits.has('cursed') ? 'unique' : item.rarity\r\n}\r\n\r\nfunction identifyMagic(item: PhysicalItemPF2e, baseDc: number, notMatchingTraditionModifier: number) {\r\n    const result = {\r\n        occult: baseDc,\r\n        primal: baseDc,\r\n        divine: baseDc,\r\n        arcane: baseDc,\r\n    }\r\n    const traditions = getMagicTraditions(item)\r\n    for (const key of MAGIC_TRADITIONS) {\r\n        // once an item has a magic tradition, all skills\r\n        // that don't match the tradition are hard\r\n        if (traditions.size > 0 && !traditions.has(key)) {\r\n            result[key] = baseDc + notMatchingTraditionModifier\r\n        }\r\n    }\r\n    return { arc: result.arcane, nat: result.primal, rel: result.divine, occ: result.occult }\r\n}\r\n\r\n/**\r\n * Extract all traits from an item, that match a magic tradition\r\n */\r\nfunction getMagicTraditions(item: PhysicalItemPF2e): Set<MagicTradition> {\r\n    const traits: string[] = item.system.traits.value\r\n    return new Set(traits.filter((t): t is MagicTradition => setHasElement(MAGIC_TRADITIONS, t)))\r\n}\r\n\r\nexport function getChoiSetRuleSelection<T extends unknown>(item: ItemPF2e, option: string) {\r\n    const rules = item._source.system.rules as ChoiceSetSource[]\r\n    const rule = rules.find(rule => rule.key === 'ChoiceSet' && rule.rollOption === option)\r\n    return rule?.selection as T | undefined\r\n}\r\n\r\nconst RUNE_PROPERTY_KEYS = ['propertyRune1', 'propertyRune2', 'propertyRune3', 'propertyRune4'] as const\r\n\r\nexport function getFreePropertyRuneSlot(item: WeaponPF2e | ArmorPF2e): null | typeof RUNE_PROPERTY_KEYS[number] {\r\n    const potency = item.system.potencyRune.value\r\n    if (potency === null) return null\r\n\r\n    for (let i = 0; i < potency; i++) {\r\n        const property = RUNE_PROPERTY_KEYS[i]\r\n        if (!item.system[property].value) return property\r\n    }\r\n\r\n    return null\r\n}\r\n\r\nconst PHYSICAL_ITEM_TYPES = new Set(['armor', 'backpack', 'book', 'consumable', 'equipment', 'treasure', 'weapon'] as const)\r\n\r\n/** Checks if the given item data is a physical item with a quantity and other physical fields. */\r\nexport function isPhysicalData(source: ItemSourcePF2e): source is PhysicalItemSource\r\nexport function isPhysicalData(source: PreCreate<ItemSourcePF2e>): source is PreCreate<PhysicalItemSource>\r\nexport function isPhysicalData(source: ItemSourcePF2e | PreCreate<ItemSourcePF2e>): boolean {\r\n    return setHasElement(PHYSICAL_ITEM_TYPES, source.type)\r\n}\r\n\r\nexport function hasInvestedProperty(source: ItemSourcePF2e): source is MagicItemSource {\r\n    return isPhysicalData(source) && 'invested' in source.system.equipped\r\n}\r\n","export const SKILL_DICTIONARY = {\r\n    acr: 'acrobatics',\r\n    arc: 'arcana',\r\n    ath: 'athletics',\r\n    cra: 'crafting',\r\n    dec: 'deception',\r\n    dip: 'diplomacy',\r\n    itm: 'intimidation',\r\n    med: 'medicine',\r\n    nat: 'nature',\r\n    occ: 'occultism',\r\n    prf: 'performance',\r\n    rel: 'religion',\r\n    soc: 'society',\r\n    ste: 'stealth',\r\n    sur: 'survival',\r\n    thi: 'thievery',\r\n} as const\r\n\r\nexport const SKILL_ABBREVIATIONS = Object.keys(SKILL_DICTIONARY) as (keyof typeof SKILL_DICTIONARY)[]\r\n\r\nexport const SKILL_LONG_FORMS = Object.values(SKILL_DICTIONARY)\r\n\r\nexport function getTranslatedSkills() {\r\n    const skillList = (CONFIG as unknown as ConfigPF2e).PF2E.skillList\r\n    return Object.entries(skillList).reduce((result: Record<string, string>, [key, value]) => {\r\n        return {\r\n            ...result,\r\n            [key]: game.i18n.localize(value).toLocaleLowerCase(game.i18n.lang),\r\n        }\r\n    }, {})\r\n}\r\n","export const LANGUAGE_LIST = [\r\n    'common',\r\n    'draconic',\r\n    'dwarven',\r\n    'elven',\r\n    'gnomish',\r\n    'goblin',\r\n    'halfling',\r\n    'jotun',\r\n    'orcish',\r\n    'sylvan',\r\n    'undercommon',\r\n    'ysoki',\r\n    'abyssal',\r\n    'adlet',\r\n    'aklo',\r\n    'akitonian',\r\n    'alghollthu',\r\n    'amurrun',\r\n    'anadi',\r\n    'ancient-osiriani',\r\n    'anugobu',\r\n    'arcadian',\r\n    'aquan',\r\n    'arboreal',\r\n    'auran',\r\n    'boggard',\r\n    'calda',\r\n    'caligni',\r\n    'celestial',\r\n    'cyclops',\r\n    'daemonic',\r\n    'destrachan',\r\n    'drooni',\r\n    'dziriak',\r\n    'ekujae',\r\n    'erutaki',\r\n    'formian',\r\n    'garundi',\r\n    'girtablilu',\r\n    'gnoll',\r\n    'goloma',\r\n    'grippli',\r\n    'hallit',\r\n    'hwan',\r\n    'iblydan',\r\n    'ignan',\r\n    'ikeshti',\r\n    'immolis',\r\n    'infernal',\r\n    'iruxi',\r\n    'jistkan',\r\n    'jyoti',\r\n    'kaava',\r\n    'kashrishi',\r\n    'kibwani',\r\n    'kitsune',\r\n    'kelish',\r\n    'lirgeni',\r\n    'mahwek',\r\n    'minaten',\r\n    'minkaian',\r\n    'mwangi',\r\n    'mzunu',\r\n    'nagaji',\r\n    'necril',\r\n    'ocotan',\r\n    'okaiyan',\r\n    'osiriani',\r\n    'protean',\r\n    'rasu',\r\n    'ratajin',\r\n    'razatlani',\r\n    'requian',\r\n    'russian',\r\n    'senzar',\r\n    'shadowtongue',\r\n    'shobhad',\r\n    'shisk',\r\n    'shoanti',\r\n    'shoony',\r\n    'skald',\r\n    'sphinx',\r\n    'strix',\r\n    'taldane',\r\n    'tekritanin',\r\n    'tengu',\r\n    'terran',\r\n    'thassilonian',\r\n    'tien',\r\n    'utopian',\r\n    'vanara',\r\n    'varisian',\r\n    'varki',\r\n    'vishkanyan',\r\n    'vudrani',\r\n    'wyrwood',\r\n    'xanmba',\r\n    'androffan',\r\n    'azlanti',\r\n    'grioth',\r\n    'kovintal',\r\n    'migo',\r\n    'munavri',\r\n    'samsaran',\r\n    'sasquatch',\r\n    'shae',\r\n    'yithian',\r\n    'druidic',\r\n] as const\r\n","export function cleanSplit(str: string | undefined) {\r\n    if (!str) return []\r\n    return str\r\n        .split(',')\r\n        .map(x => x.trim())\r\n        .filter(x => x)\r\n}\r\n\r\nexport function capitalize(str?: string) {\r\n    if (!str) return ''\r\n    return str[0].toUpperCase() + str.slice(1)\r\n}\r\n","export function sequenceArray<N extends number = number>(start: number, end: number) {\r\n    const levels: number[] = []\r\n\r\n    if (start <= end) {\r\n        for (let i = start; i <= end; i++) levels.push(i)\r\n    } else {\r\n        for (let i = start; i >= end; i--) levels.push(i)\r\n    }\r\n\r\n    return levels as N[]\r\n}\r\n","import { getChoiSetRuleSelection, getFreePropertyRuneSlot } from '@utils/pf2e/item'\r\nimport { SKILL_LONG_FORMS } from '@utils/pf2e/skills'\r\nimport { LANGUAGE_LIST } from '@utils/pf2e/languages'\r\nimport { capitalize } from '@utils/string'\r\nimport { sequenceArray } from '@utils/utils'\r\nimport { createSpellScroll } from '@utils/pf2e/spell'\r\n\r\nconst halfLevelString = 'max(1,floor(@actor.level/2))'\r\n\r\ntype CreateSkillArgs = { skill: string; value: ZeroToFour | string; mode?: AELikeChangeMode; predicate?: RawPredicate }\r\ntype CreateLanguageArgs = { language: string; mode?: AELikeChangeMode; predicate?: RawPredicate }\r\ntype CreateLoreArgs = { name: string; rank: OneToFour }\r\ntype CreateResistanceArgs = { type: string; value: number | string | 'half'; predicate?: RawPredicate }\r\ntype CreateScrollArgs = { uuid: ItemUUID; level?: OneToTen }\r\n\r\nexport const utils = {\r\n    // Skills\r\n    get skillNames() {\r\n        return SKILL_LONG_FORMS.slice()\r\n    },\r\n    skillLabel: (skill: string) => {\r\n        return game.i18n.localize(CONFIG.PF2E.skillList[skill as SkillLongForm])\r\n    },\r\n    createSkillRuleElement: ({ skill, value, mode = 'upgrade', predicate }: CreateSkillArgs) => {\r\n        const rule: AELikeSource = {\r\n            key: 'ActiveEffectLike',\r\n            mode,\r\n            path: `system.skills.${skill}.rank`,\r\n            value,\r\n        }\r\n        if (predicate && predicate.length) rule.predicate = predicate\r\n        return rule\r\n    },\r\n    createLoreSource: ({ name, rank }: CreateLoreArgs) => {\r\n        const data: DeepPartial<LoreSource> = {\r\n            type: 'lore',\r\n            img: 'systems/pf2e/icons/default-icons/lore.svg',\r\n            name,\r\n            system: { proficient: { value: rank as OneToFour } },\r\n        }\r\n        return data\r\n    },\r\n    // Languages\r\n    get languageNames() {\r\n        return LANGUAGE_LIST.slice()\r\n    },\r\n    languageLabel: (language: string) => {\r\n        return game.i18n.localize(CONFIG.PF2E.languages[language as Language])\r\n    },\r\n    createLanguageRuleElement: ({ language, mode = 'add', predicate }: CreateLanguageArgs) => {\r\n        const rule: AELikeSource = {\r\n            key: 'ActiveEffectLike',\r\n            mode,\r\n            path: 'system.traits.languages.value',\r\n            value: language,\r\n        }\r\n        if (predicate && predicate.length) rule.predicate = predicate\r\n        return rule\r\n    },\r\n    // resistances\r\n    resistanceLabel: (resistance: string, value?: number) => {\r\n        let str = game.i18n.localize(`PF2E.Trait${capitalize(resistance)}`)\r\n        if (value) str += ` ${value}`\r\n        return str\r\n    },\r\n    createResistanceRuleElement: ({ type, value, predicate }: CreateResistanceArgs) => {\r\n        if (value === 'half') value = halfLevelString\r\n        const rule: IWRRuleElementSource = {\r\n            key: 'Resistance',\r\n            type,\r\n            value,\r\n        }\r\n        if (predicate && predicate.length) rule.predicate = predicate\r\n        return rule\r\n    },\r\n    // feats\r\n    createFeatSource: async (uuid: ItemUUID) => {\r\n        const source = (await fromUuid<FeatPF2e>(uuid))?.toObject()\r\n        if (!source) throw new Error(`An error occured while trying to create a feat source with uuid: ${uuid}`)\r\n        return source\r\n    },\r\n    // spells\r\n    createSpellScrollSource: async ({ uuid, level }: CreateScrollArgs) => {\r\n        const source = await createSpellScroll(uuid, level ?? false, true)\r\n        if (!source) throw new Error(`An error occured while trying to create a spell scroll source with uuid: ${uuid}`)\r\n        return source\r\n    },\r\n    createSpellSource: async (uuid: ItemUUID) => {\r\n        const source = (await fromUuid<SpellPF2e>(uuid))?.toObject()\r\n        if (!source) throw new Error(`An error occured while trying to create a spell source with uuid: ${uuid}`)\r\n        return source\r\n    },\r\n    // Rule Elements\r\n    get halfLevelString() {\r\n        return halfLevelString\r\n    },\r\n    getChoiSetRuleSelection,\r\n    //\r\n    proficiencyLabel: (rank: ZeroToFour) => {\r\n        return game.i18n.localize(CONFIG.PF2E.proficiencyLevels[rank])\r\n    },\r\n    randomOption: async <T extends string | { value: string }>(options: T[]) => {\r\n        const roll = (await new Roll(`1d${options.length}`).evaluate({ async: true })).total\r\n        const result = options[roll - 1]!\r\n        if (typeof result === 'string') return result\r\n        return result.value\r\n    },\r\n    halfLevelValue: (actor: CharacterPF2e) => Math.max(1, Math.floor(actor.level / 2)),\r\n    sequenceArray,\r\n    // equipment\r\n    damageLabel: (damage: string) => {\r\n        return game.i18n.localize(CONFIG.PF2E.weaponDamage[damage as WeaponDamageType])\r\n    },\r\n    weaponTraitLabel: (trait: string) => {\r\n        return game.i18n.localize(CONFIG.PF2E.weaponTraits[trait as WeaponTrait])\r\n    },\r\n    weaponPropertyRunesLabel: (rune: string) => {\r\n        return game.i18n.localize(CONFIG.PF2E.weaponPropertyRunes[rune as WeaponPropertyRuneType])\r\n    },\r\n    hasFreePropertySlot: (item: WeaponPF2e | ArmorPF2e) => {\r\n        const potency = item.system.runes.potency\r\n        return potency > 0 && item.system.runes.property.length < potency\r\n    },\r\n    getFreePropertyRuneSlot,\r\n}\r\n","export type SpellGenerics = ['spell', {}, '']\r\n\r\nexport function createSpellDaily(key: string, uuid: ItemUUID, filter: DailySpellFilter = {}, level?: number, label?: string) {\r\n    const daily: Daily<SpellGenerics> = {\r\n        key,\r\n        label,\r\n        item: {\r\n            uuid,\r\n        },\r\n        rows: [\r\n            {\r\n                type: 'drop',\r\n                slug: 'spell',\r\n                filter: {\r\n                    type: 'spell',\r\n                    search: filter,\r\n                },\r\n            },\r\n        ],\r\n        process: async ({ addSpell, utils, fields, messages }) => {\r\n            const uuid = fields.spell.uuid!\r\n            const source = await utils.createSpellSource(uuid)\r\n            const label = `${source.name} (Level ${level || source.system.level.value})`\r\n            addSpell(source, level)\r\n            messages.add('spells', { uuid, label })\r\n        },\r\n    }\r\n    return daily\r\n}\r\n","import { localizePath } from '@utils/foundry/localize'\r\nimport { createSpellDaily, SpellGenerics } from './spell'\r\n\r\nexport const TricksterAce = (() => {\r\n    const daily = createSpellDaily(\r\n        'ace',\r\n        'Compendium.pf2e.feats-srd.POrE3ZgBRdBL9MsW',\r\n        {\r\n            category: ['cantrip', 'spell'],\r\n            level: 4,\r\n        },\r\n        4\r\n    )\r\n\r\n    const row = daily.rows![0] as DailyRowDropSpell<SpellGenerics>\r\n    row.filter.drop = item => {\r\n        const castTime = item.system.time.value\r\n        if (castTime.includes('hour') || (castTime.includes('min') && parseInt(castTime) > 10)) {\r\n            return { error: localizePath('interface.error.drop.wrongSpellTime'), data: { time: '10 min' } }\r\n        }\r\n        return true\r\n    }\r\n\r\n    return daily\r\n})()\r\n","type ChainRow = typeof rows[number]\r\ntype ChainChild = 'expert' | 'master'\r\ntype ChainGenerics = [ChainRow, {}, ChainChild]\r\n\r\nconst rows = ['first', 'second', 'third', 'fourth', 'fifth', 'sixth', 'seventh'] as const\r\n\r\nexport function createScrollChain(key: string, uuids: [ItemUUID, ItemUUID, ItemUUID], label?: string) {\r\n    const daily: Daily<ChainGenerics> = {\r\n        key,\r\n        label,\r\n        item: {\r\n            uuid: uuids[0],\r\n        },\r\n        children: [\r\n            {\r\n                slug: 'expert',\r\n                uuid: uuids[1],\r\n            },\r\n            {\r\n                slug: 'master',\r\n                uuid: uuids[2],\r\n            },\r\n        ],\r\n        rows: [\r\n            createRow('first', 1), //\r\n            createRow('second', 2, 8),\r\n            createRow('third', 3, undefined, 'expert'), //\r\n            createRow('fourth', 4, 14, 'expert'),\r\n            createRow('fifth', 5, 16, 'expert'),\r\n            createRow('sixth', 6, undefined, 'master'), //\r\n            createRow('seventh', 7, 20, 'master'),\r\n        ],\r\n        process: async ({ utils, fields, addItem, messages }) => {\r\n            for (const field of Object.values(fields)) {\r\n                const uuid = field.uuid!\r\n                const level = (rows.indexOf(field.row) + 1) as OneToTen\r\n                const source = await utils.createSpellScrollSource({ uuid, level })\r\n                addItem(source)\r\n                messages.add('scrolls', { uuid, label: source.name })\r\n            }\r\n        },\r\n    }\r\n    return daily\r\n}\r\n\r\nfunction createRow(slug: ChainRow, level: OneToTen, minActorLevel?: number, child?: ChainChild) {\r\n    const row: DailyRow<ChainGenerics> = {\r\n        type: 'drop',\r\n        slug,\r\n        label: `PF2E.SpellLevel${level}`,\r\n        filter: {\r\n            type: 'spell',\r\n            search: {\r\n                category: ['spell'],\r\n                level,\r\n            },\r\n        },\r\n    }\r\n    if (minActorLevel) row.condition = ({ actor }) => actor.level >= minActorLevel\r\n    if (child) row.childPredicate = [child]\r\n    return row\r\n}\r\n","type FeatGenerics = ['feat', {}, '']\r\n\r\nexport function createFeatDaily(key: string, uuid: ItemUUID, filter: DailyFeatFilter = {}, label?: string) {\r\n    const daily: Daily<FeatGenerics> = {\r\n        key,\r\n        label,\r\n        item: {\r\n            uuid,\r\n        },\r\n        rows: [\r\n            {\r\n                type: 'drop',\r\n                slug: 'feat',\r\n                filter: {\r\n                    type: 'feat',\r\n                    search: filter,\r\n                },\r\n            },\r\n        ],\r\n        process: async ({ utils, fields, addFeat, messages }: DailyProcessFunctionArgs<FeatGenerics>) => {\r\n            const uuid = fields.feat.uuid!\r\n            const source = await utils.createFeatSource(uuid)\r\n            addFeat(source)\r\n            messages.add('feats', { uuid })\r\n        },\r\n    }\r\n    return daily\r\n}\r\n","type FlexibilityRow = 'flexibility' | 'improved'\r\ntype FlexibilityChild = 'improved'\r\ntype FlexibilityGenerics = [FlexibilityRow, {}, FlexibilityChild]\r\n\r\nexport const combatFlexibility: Daily<FlexibilityGenerics> = {\r\n    key: 'flexibility',\r\n    item: {\r\n        uuid: 'Compendium.pf2e.classfeatures.8g6HzARbhfcgilP8', // Combat Flexibility\r\n    },\r\n    children: [\r\n        {\r\n            slug: 'improved',\r\n            uuid: 'Compendium.pf2e.classfeatures.W2rwudMNcAxs8VoX', // Improved Flexibility\r\n        },\r\n    ],\r\n    rows: [\r\n        createRow('flexibility', 8), //\r\n        createRow('improved', 14, 'improved'),\r\n    ],\r\n    process: async ({ utils, fields, addFeat, messages, children }) => {\r\n        const uuid = fields.flexibility.uuid!\r\n        const source = await utils.createFeatSource(uuid)\r\n        addFeat(source)\r\n        messages.add('feats', { uuid })\r\n\r\n        if (children.improved) {\r\n            const uuid = fields.improved.uuid!\r\n            const source = await utils.createFeatSource(uuid)\r\n            addFeat(source, children.improved)\r\n            messages.add('feats', { uuid })\r\n        }\r\n    },\r\n}\r\n\r\nfunction createRow(slug: FlexibilityRow, level: number, child?: FlexibilityChild) {\r\n    const row: DailyRowDrop<FlexibilityGenerics> = {\r\n        type: 'drop',\r\n        label: `PF2E.Level${level}`,\r\n        slug,\r\n        filter: {\r\n            type: 'feat',\r\n            search: {\r\n                category: ['class'],\r\n                traits: ['fighter'],\r\n                level,\r\n            },\r\n        },\r\n    }\r\n    if (child) row.childPredicate = [child]\r\n    return row\r\n}\r\n","type LanguageGenerics = ['language', {}, '']\r\n\r\nexport function createLanguageDaily(key: string, uuid: ItemUUID, label?: string) {\r\n    const daily: Daily<LanguageGenerics> = {\r\n        key,\r\n        label,\r\n        item: {\r\n            uuid,\r\n        },\r\n        rows: [\r\n            {\r\n                type: 'select',\r\n                slug: 'language',\r\n                options: ({ actor, utils }) => {\r\n                    const actorLanguages = actor.system.traits.languages.value\r\n                    return utils.languageNames.filter(x => !actorLanguages.includes(x)).sort()\r\n                },\r\n                labelizer: ({ utils }) => utils.languageLabel,\r\n            },\r\n        ],\r\n        process: ({ addRule, utils, fields, messages }) => {\r\n            const value = fields.language.value\r\n            const source = utils.createLanguageRuleElement({ language: value })\r\n            addRule(source)\r\n            messages.add('languages', { uuid, selected: utils.languageLabel(value), label })\r\n        },\r\n    }\r\n    return daily\r\n}\r\n","import { MODULE_ID } from '@src/main'\r\nimport { localize, subLocalize } from '@utils/foundry/localize'\r\nimport { getFlag } from '@utils/foundry/flags'\r\n\r\ntype MindRow = 'alert' | 'smith' | 'mental' | 'runic' | 'advanced'\r\ntype MindChild = 'weapon' | 'mental' | 'runic' | 'advanced'\r\ntype MindGenerics = [MindRow, {}, MindChild]\r\n\r\nconst MIND_WEAPON_UUID = 'Compendium.pf2e-dailies.equipment.VpmEozw21aRxX15P'\r\n\r\nconst WEAPON_BASE_TYPES = {\r\n    '0': { die: 'd4', traits: ['finesse', 'agile'], usage: 'held-in-one-hand' },\r\n    '1': { die: 'd6', traits: ['finesse'], usage: 'held-in-one-hand' },\r\n    '2': { die: 'd8', traits: [], usage: 'held-in-one-hand' },\r\n    '3': { die: 'd10', traits: ['reach'], usage: 'held-in-two-hands' },\r\n}\r\n\r\nconst WEAPON_GROUPS = {\r\n    slashing: 'sword',\r\n    piercing: 'spear',\r\n    bludgeoning: 'club',\r\n} as Record<WeaponDamageType, string>\r\n\r\nconst WEAPON_TRAITS = ['grapple', 'nonlethal', 'shove', 'trip', 'modular']\r\n\r\nconst WEAPON_DAMAGE_TYPES = Object.keys(WEAPON_GROUPS)\r\n\r\nconst WEAPON_RUNES = ['corrosive', 'disrupting', 'flaming', 'frost', 'shock', 'thundering']\r\n\r\nconst WEAPON_GREATER_RUNES = [\r\n    'anarchic',\r\n    'axiomatic',\r\n    'greaterCorrosive',\r\n    'greaterDisrupting',\r\n    'greaterFlaming',\r\n    'greaterFrost',\r\n    'greaterShock',\r\n    'greaterThundering',\r\n    'holy',\r\n    'unholy',\r\n]\r\n\r\nexport const mindSmith: Daily<MindGenerics> = {\r\n    key: 'mindsmith',\r\n    item: {\r\n        uuid: 'Compendium.pf2e.feats-srd.juikoiIA0Jy8PboY', // Mind Smith Dedication\r\n    },\r\n    children: [\r\n        {\r\n            slug: 'weapon',\r\n            uuid: MIND_WEAPON_UUID, // Mind Weapon\r\n        },\r\n        {\r\n            slug: 'mental',\r\n            uuid: 'Compendium.pf2e.feats-srd.PccekOihIbRWdDky', // Malleable Mental Forge\r\n        },\r\n        {\r\n            slug: 'runic',\r\n            uuid: 'Compendium.pf2e.feats-srd.2uQbQgz1AbjzcFSp', // Runic Mind Smithing\r\n        },\r\n        {\r\n            slug: 'advanced',\r\n            uuid: 'Compendium.pf2e.feats-srd.fgnfXwFcn9jZlXGD', // Advanced Runic Mind Smithing\r\n        },\r\n    ],\r\n    rows: [\r\n        {\r\n            type: 'alert',\r\n            slug: 'alert',\r\n            message: () => localize('interface.alert.weapon'),\r\n            fix,\r\n            childPredicate: [{ not: 'weapon' }],\r\n        },\r\n        {\r\n            type: 'select',\r\n            slug: 'smith',\r\n            label: () => localize('label.mindsmith'),\r\n            options: WEAPON_DAMAGE_TYPES,\r\n            labelizer: ({ utils }) => utils.damageLabel,\r\n            childPredicate: ['weapon'],\r\n        },\r\n        {\r\n            type: 'select',\r\n            slug: 'mental',\r\n            label: () => localize('label.mentalforge'),\r\n            options: WEAPON_TRAITS,\r\n            labelizer: ({ utils }) => utils.weaponTraitLabel,\r\n            childPredicate: ['weapon', 'mental'],\r\n        },\r\n        {\r\n            type: 'select',\r\n            slug: 'runic',\r\n            label: () => localize('label.runicmind'),\r\n            options: WEAPON_RUNES,\r\n            labelizer: ({ utils }) => utils.weaponPropertyRunesLabel,\r\n            childPredicate: ['weapon', 'runic', { not: 'advanced' }],\r\n            condition: ({ children, utils }) => utils.hasFreePropertySlot(children.weapon as WeaponPF2e),\r\n        },\r\n        {\r\n            type: 'select',\r\n            slug: 'advanced',\r\n            label: () => localize('label.runicmind'),\r\n            options: WEAPON_GREATER_RUNES,\r\n            labelizer: ({ utils }) => utils.weaponPropertyRunesLabel,\r\n            childPredicate: ['weapon', 'advanced'],\r\n            condition: ({ children, utils }) => utils.hasFreePropertySlot(children.weapon as WeaponPF2e),\r\n        },\r\n    ],\r\n    process: ({ children, updateItem, fields, messages, item, utils }) => {\r\n        const weapon = children.weapon as WeaponPF2e | undefined\r\n        if (!weapon) return\r\n\r\n        messages.addGroup('mindsmith')\r\n\r\n        const selected = fields.smith.value as WeaponDamageType\r\n        updateItem({ _id: weapon.id, 'system.damage.damageType': selected, 'system.group': WEAPON_GROUPS[selected] })\r\n        messages.add('mindsmith', { selected: utils.damageLabel(selected), uuid: item.uuid, label: 'mindsmith' })\r\n\r\n        if (children.mental) {\r\n            const selected = fields.mental.value as WeaponTrait\r\n            const traits = deepClone(weapon._source.system.traits?.value ?? [])\r\n            if (!traits.includes(selected)) traits.push(selected)\r\n            updateItem({ _id: weapon.id, 'system.traits.value': traits })\r\n            messages.add('mindsmith', {\r\n                selected: utils.weaponTraitLabel(selected),\r\n                uuid: children.mental.uuid,\r\n                label: 'mentalforge',\r\n            })\r\n        }\r\n\r\n        if ((children.advanced || children.runic) && utils.hasFreePropertySlot(weapon)) {\r\n            const child = (children.advanced ?? children.runic) as ItemPF2e\r\n            const freeSlot = utils.getFreePropertyRuneSlot(weapon)\r\n            const field = fields.advanced ?? fields.runic\r\n            const selected = field.value as WeaponPropertyRuneType\r\n\r\n            if (!weapon.system.runes.property.includes(selected)) {\r\n                updateItem({ _id: weapon.id, [`system.${freeSlot}.value`]: selected, [`flags.${MODULE_ID}.runeSlot`]: freeSlot })\r\n                messages.add('mindsmith', {\r\n                    selected: utils.weaponPropertyRunesLabel(selected),\r\n                    uuid: child.uuid,\r\n                    label: 'runicmind',\r\n                })\r\n            }\r\n        }\r\n    },\r\n    rest: ({ item, sourceId, updateItem }) => {\r\n        if (sourceId !== MIND_WEAPON_UUID) return\r\n\r\n        let traits = item._source.system.traits?.value ?? []\r\n        traits = traits.filter(trait => !WEAPON_TRAITS.includes(trait))\r\n        updateItem({ _id: item.id, 'system.traits.value': traits })\r\n\r\n        const runeSlot = getFlag<string>(item, 'runeSlot')\r\n        if (runeSlot) {\r\n            updateItem({ _id: item.id, [`system.${runeSlot}.value`]: null, [`flags.${MODULE_ID}.-=runeSlot`]: true })\r\n        }\r\n    },\r\n}\r\n\r\nasync function fix({ actor }: DailyValueArgs<MindGenerics>) {\r\n    const localize = subLocalize('dialog.weapon')\r\n\r\n    let content = localize('flavor')\r\n\r\n    for (const key of ['0', '1', '2', '3']) {\r\n        const label = localize(`option.${key}`)\r\n        content += `<label><input type=\"radio\" name=\"type\" value=\"${key}\">${label}</label>`\r\n    }\r\n\r\n    const weapon = await Dialog.wait(\r\n        {\r\n            title: localize('title'),\r\n            content,\r\n            buttons: {\r\n                yes: {\r\n                    icon: '<i class=\"fas fa-save\"></i>',\r\n                    label: localize('accept'),\r\n                    callback: onWeaponSelected,\r\n                },\r\n                no: {\r\n                    icon: '<i class=\"fas fa-times\"></i>',\r\n                    label: localize('cancel'),\r\n                    callback: () => null,\r\n                },\r\n            },\r\n            close: () => null,\r\n        },\r\n        {},\r\n        { id: 'pf2e-dailies-weapon', width: 600 }\r\n    )\r\n\r\n    if (weapon) {\r\n        await actor.createEmbeddedDocuments('Item', [weapon])\r\n        return true\r\n    }\r\n\r\n    return false\r\n}\r\n\r\nasync function onWeaponSelected(html: JQuery) {\r\n    const localize = subLocalize('dialog.weapon')\r\n\r\n    const selection = html.find('[name=type]:checked').val() as keyof typeof WEAPON_BASE_TYPES\r\n    if (!selection) {\r\n        localize.warn('error.noSelection')\r\n        return\r\n    }\r\n\r\n    const weapon = (await fromUuid<WeaponPF2e>(MIND_WEAPON_UUID))?.toObject()\r\n    if (!weapon) {\r\n        localize.warn('error.missing')\r\n        return\r\n    }\r\n\r\n    const stats = WEAPON_BASE_TYPES[selection]\r\n\r\n    setProperty(weapon, 'system.damage.die', stats.die)\r\n    setProperty(weapon, 'system.traits.value', stats.traits.slice())\r\n    setProperty(weapon, 'system.usage.value', stats.usage)\r\n\r\n    return weapon\r\n}\r\n","import { findItemWithSourceId } from '@utils/foundry/item'\r\n\r\nconst RATION_UUID = 'Compendium.pf2e.equipment-srd.L9ZV076913otGtiB'\r\n\r\nexport function getRations(actor: CharacterPF2e) {\r\n    return findItemWithSourceId(actor, RATION_UUID) as ConsumablePF2e | undefined\r\n}\r\n","import { getSourceId, includesSourceId } from '@utils/foundry/flags'\r\n\r\ntype ActorItemTypes<A extends Actor> = (keyof A['itemTypes'])[]\r\n\r\nfunction getItemSourceIdCondition(sourceId: ItemUUID | ItemUUID[]) {\r\n    return Array.isArray(sourceId)\r\n        ? (item: Item) => includesSourceId(item, sourceId)\r\n        : (item: Item) => getSourceId(item) === sourceId\r\n}\r\n\r\nexport function getItems<A extends Actor, I extends Item = CollectionValue<A['items']>>(actor: A, itemTypes?: ActorItemTypes<A>) {\r\n    return (itemTypes ? itemTypes.flatMap(type => actor.itemTypes[type as string]) : actor.items) as Embedded<I>[]\r\n}\r\n\r\nexport function findItemWithSourceId<A extends Actor, I extends Item = CollectionValue<A['items']>>(\r\n    actor: A,\r\n    sourceId: ItemUUID,\r\n    itemTypes?: ActorItemTypes<A>\r\n) {\r\n    return getItems<A, I>(actor, itemTypes).find(getItemSourceIdCondition(sourceId))\r\n}\r\n\r\nexport function hasItemWithSourceId<A extends Actor, I extends Item = CollectionValue<A['items']>>(\r\n    actor: A,\r\n    sourceId: ItemUUID | ItemUUID[],\r\n    itemTypes?: ActorItemTypes<A>\r\n) {\r\n    return getItems<A, I>(actor, itemTypes).some(getItemSourceIdCondition(sourceId))\r\n}\r\n\r\nexport function filterItemsWithSourceId<A extends Actor, I extends Item = CollectionValue<A['items']>>(\r\n    actor: A,\r\n    sourceId: ItemUUID | ItemUUID[],\r\n    itemTypes?: ActorItemTypes<A>\r\n) {\r\n    return getItems<A, I>(actor, itemTypes).filter(getItemSourceIdCondition(sourceId))\r\n}\r\n","type ResistanceGenerics = ['resistance', {}, '']\r\n\r\nexport function createResistancelDaily(\r\n    key: string,\r\n    uuid: ItemUUID,\r\n    resistances: string[],\r\n    resistance: number | 'half' | 'level',\r\n    label?: string,\r\n    random?: boolean\r\n) {\r\n    const daily: Daily<ResistanceGenerics> = {\r\n        key,\r\n        label,\r\n        item: {\r\n            uuid,\r\n        },\r\n        rows: [\r\n            {\r\n                type: random ? 'random' : 'select',\r\n                slug: 'resistance',\r\n                options: resistances,\r\n                labelizer: ({ utils }) => utils.resistanceLabel,\r\n            },\r\n        ],\r\n        process: async ({ utils, fields, actor, addRule, messages }) => {\r\n            const type = random ? await utils.randomOption(resistances) : fields.resistance.value\r\n            const value =\r\n                typeof resistance === 'number' ? resistance : resistance === 'half' ? utils.halfLevelValue(actor) : actor.level\r\n            const rule = utils.createResistanceRuleElement({ type, value })\r\n            addRule(rule)\r\n            messages.add('resistances', { uuid, selected: utils.resistanceLabel(type, value), label, random })\r\n        },\r\n    }\r\n    return daily\r\n}\r\n","type SavantRow = 'first' | 'second' | 'third' | 'fourth'\r\ntype SavantCustom = Record<SavantRow, { level: OneToTen; condition: boolean }>\r\ntype SavantGenerics = [SavantRow, SavantCustom, '']\r\n\r\nexport const scrollSavant: Daily<SavantGenerics> = {\r\n    key: 'savant',\r\n    item: {\r\n        uuid: 'Compendium.pf2e.feats-srd.u5DBg0LrBUKP0JsJ', // Scroll Savant\r\n    },\r\n    prepare: ({ actor }) => {\r\n        const { maxSlot, maxTradition } = getSpellcastingTraditionDetails(actor, 'arcane')\r\n\r\n        return {\r\n            first: { level: maxSlot - 2, condition: true },\r\n            second: { level: maxSlot - 3, condition: true },\r\n            third: { level: maxSlot - 4, condition: maxTradition >= 3 && maxSlot >= 5 },\r\n            fourth: { level: maxSlot - 5, condition: maxTradition >= 4 && maxSlot >= 6 },\r\n        } as SavantCustom\r\n    },\r\n    rows: (['first', 'second', 'third', 'fourth'] as const).map(rowName => {\r\n        const row: DailyRowDrop<SavantGenerics> = {\r\n            type: 'drop',\r\n            slug: rowName,\r\n            label: ({ custom }) => `PF2E.SpellLevel${custom[rowName].level}`,\r\n            filter: {\r\n                type: 'spell',\r\n                search: ({ custom }) => ({\r\n                    category: ['spell'],\r\n                    traditions: ['arcane'],\r\n                    level: custom[rowName].level,\r\n                }),\r\n            },\r\n            condition: ({ custom }) => custom[rowName].condition,\r\n        }\r\n        return row\r\n    }),\r\n    process: async ({ utils, fields, custom, addItem, messages }) => {\r\n        for (const field of Object.values(fields)) {\r\n            const uuid = field.uuid!\r\n            const source = await utils.createSpellScrollSource({ uuid, level: custom[field.row].level })\r\n            addItem(source)\r\n            messages.add('scrolls', { uuid, label: source.name })\r\n        }\r\n    },\r\n}\r\n\r\nfunction getSpellcastingTraditionDetails(actor: CharacterPF2e, tradition: MagicTradition) {\r\n    let maxSlot: OneToTen = 1\r\n    let maxTradition: ZeroToFour = 0\r\n\r\n    for (const entry of actor.spellcasting) {\r\n        if ('pf2e-staves' in entry.flags) continue // we skip staff entries\r\n\r\n        const slots = entry.system.slots\r\n        for (const key in slots) {\r\n            const slot = slots[key as SlotKey]\r\n            if (slot.max) maxSlot = Math.max(maxSlot, Number(key.slice(4))) as OneToTen\r\n        }\r\n\r\n        if (entry.tradition === tradition) maxTradition = Math.max(maxTradition, entry.rank) as ZeroToFour\r\n    }\r\n\r\n    return { maxSlot: Math.min(maxSlot, 10) as OneToTen, maxTradition }\r\n}\r\n","type SkillGenerics = ['skill', {}, '']\r\n\r\nexport function createTrainedSkillDaily(key: string, uuid: ItemUUID, label?: string) {\r\n    const daily: Daily<SkillGenerics> = {\r\n        key,\r\n        label,\r\n        item: {\r\n            uuid,\r\n        },\r\n        rows: [\r\n            {\r\n                type: 'combo',\r\n                slug: 'skill',\r\n                options: ({ actor, utils }) => {\r\n                    const actorSkills = actor.skills\r\n                    return utils.skillNames.filter(x => actorSkills[x]!.rank! < 1)\r\n                },\r\n                labelizer: ({ utils }) => utils.skillLabel,\r\n            },\r\n        ],\r\n        process: ({ fields, addItem, addRule, utils, messages }) => {\r\n            let value = fields.skill.value\r\n\r\n            if (fields.skill.input === 'true') {\r\n                const source = utils.createLoreSource({ name: value, rank: 1 })\r\n                addItem(source)\r\n            } else {\r\n                const source = utils.createSkillRuleElement({ skill: value, value: 1 })\r\n                value = utils.skillLabel(value as SkillLongForm)\r\n                addRule(source)\r\n            }\r\n\r\n            messages.add('skills', { uuid, selected: value, label })\r\n        },\r\n    }\r\n    return daily\r\n}\r\n\r\nexport function createTrainedLoreDaily(key: string, uuid: ItemUUID, label?: string) {\r\n    const daily: Daily<SkillGenerics> = {\r\n        key,\r\n        label,\r\n        item: {\r\n            uuid,\r\n        },\r\n        rows: [\r\n            {\r\n                type: 'input',\r\n                slug: 'skill',\r\n            },\r\n        ],\r\n        process: ({ addItem, utils, fields, messages }) => {\r\n            const value = fields.skill.value\r\n            const source = utils.createLoreSource({ name: value, rank: 1 })\r\n            addItem(source)\r\n            messages.add('skills', { uuid, selected: value, label })\r\n        },\r\n    }\r\n    return daily\r\n}\r\n","type TomeRow = 'first' | 'second'\r\ntype TomeChild = 'adept' | 'second' | 'intense' | 'paragon'\r\ntype TomeCustom = Record<TomeRow, { rank: OneToFour; options: string[] }>\r\ntype TomeGenerics = [TomeRow, TomeCustom, TomeChild]\r\n\r\nexport const thaumaturgeTome: Daily<TomeGenerics> = {\r\n    key: 'tome',\r\n    item: {\r\n        uuid: 'Compendium.pf2e.classfeatures.MyN1cQgE0HsLF20e', // Tome\r\n    },\r\n    children: [\r\n        {\r\n            slug: 'adept',\r\n            uuid: 'Compendium.pf2e.classfeatures.Obm4ItMIIr0whYeO', // Implement Adept\r\n            condition: createChildCondition('adept'),\r\n        },\r\n        {\r\n            slug: 'second',\r\n            uuid: 'Compendium.pf2e.classfeatures.ZEUxZ4Ta1kDPHiq5', // Second Adept\r\n            condition: createChildCondition('adept'),\r\n        },\r\n        {\r\n            slug: 'intense',\r\n            uuid: 'Compendium.pf2e.feats-srd.yRRM1dsY6jakEMaC', // Intense Implement\r\n        },\r\n        {\r\n            slug: 'paragon',\r\n            uuid: 'Compendium.pf2e.classfeatures.QEtgbY8N2V4wTbsI', // Implement Paragon\r\n            condition: createChildCondition('paragon'),\r\n        },\r\n    ],\r\n    prepare: ({ utils, actor, children }) => {\r\n        const skillNames = utils.skillNames\r\n        const actorLevel = actor.level\r\n        const actorSkills = actor.skills as Record<SkillLongForm, { rank: ZeroToFour }>\r\n\r\n        const custom: TomeCustom = {\r\n            first: { options: [], rank: 1 },\r\n            second: { options: [], rank: 1 },\r\n        }\r\n\r\n        // Implement Paragon\r\n        if (children.paragon) {\r\n            const skills = skillNames.filter(x => actorSkills[x].rank < 4)\r\n            custom.first = { rank: 4, options: skills }\r\n            custom.second = { rank: 4, options: skills }\r\n        }\r\n        // Intense Implement or Second Adept or Implement Adept\r\n        else if (children.intense || children.adept || children.second) {\r\n            const masters = skillNames.filter(x => actorSkills[x].rank < 3)\r\n\r\n            if (actorLevel >= 9) {\r\n                custom.first = { rank: 3, options: masters }\r\n                custom.second = { rank: 3, options: masters }\r\n            } else {\r\n                const experts = skillNames.filter(x => actorSkills[x].rank < 2)\r\n                custom.first = { rank: 2, options: experts }\r\n                custom.second = { rank: 3, options: masters }\r\n            }\r\n        }\r\n        // Tome\r\n        else {\r\n            if (actorLevel >= 5) {\r\n                const experts = skillNames.filter(x => actorSkills[x].rank < 2)\r\n                custom.first = { rank: 2, options: experts }\r\n                custom.second = { rank: 2, options: experts }\r\n            } else if (actorLevel >= 3) {\r\n                const trained = skillNames.filter(x => actorSkills[x].rank < 1)\r\n                const experts = skillNames.filter(x => actorSkills[x].rank < 2)\r\n                custom.first = { rank: 1, options: trained }\r\n                custom.second = { rank: 2, options: experts }\r\n            } else {\r\n                const trained = skillNames.filter(x => actorSkills[x].rank < 1)\r\n                custom.first = { rank: 1, options: trained }\r\n                custom.second = { rank: 1, options: trained }\r\n            }\r\n        }\r\n\r\n        return custom\r\n    },\r\n    rows: (['first', 'second'] as const).map(rowName => {\r\n        const row: DailyRow<TomeGenerics> = {\r\n            type: 'combo',\r\n            slug: rowName,\r\n            label: ({ custom, utils }) => utils.proficiencyLabel(custom[rowName].rank),\r\n            options: ({ custom }) => custom[rowName].options,\r\n            labelizer: ({ utils }) => utils.skillLabel,\r\n        }\r\n        return row\r\n    }),\r\n    process: ({ custom, fields, utils, messages, addItem, addRule }) => {\r\n        messages.addGroup('tome', 65)\r\n\r\n        for (const rowName of ['first', 'second'] as const) {\r\n            const rank = custom[rowName].rank\r\n            let value = fields[rowName].value\r\n\r\n            if (fields[rowName].input === 'true') {\r\n                const source = utils.createLoreSource({ name: value, rank })\r\n                addItem(source)\r\n            } else {\r\n                const source = utils.createSkillRuleElement({ skill: value, value: rank })\r\n                value = utils.skillLabel(value)\r\n                addRule(source)\r\n            }\r\n\r\n            messages.add('tome', { label: utils.proficiencyLabel(rank), selected: value })\r\n        }\r\n    },\r\n}\r\n\r\nfunction createChildCondition(option: 'adept' | 'paragon') {\r\n    return function ({ item, utils }: BaseDailyValueArgs<TomeGenerics>) {\r\n        return utils.getChoiSetRuleSelection(item, option) === 'tome'\r\n    }\r\n}\r\n","export const AsyncFunction = async function () {}.constructor as ConstructorOf<(...args: any[]) => Promise<any>>\r\n","import { getSourceId } from '@utils/foundry/flags'\r\nimport { error } from '@utils/foundry/notification'\r\nimport { getSetting } from '@utils/foundry/settings'\r\nimport { utils } from './api'\r\nimport { TricksterAce } from './data/ace'\r\nimport { createScrollChain } from './data/chain'\r\nimport { createFeatDaily } from './data/feat'\r\nimport { combatFlexibility } from './data/flexibility'\r\nimport { createLanguageDaily } from './data/language'\r\nimport { mindSmith } from './data/mind'\r\nimport { getRations } from './data/rations'\r\nimport { createResistancelDaily } from './data/resistance'\r\nimport { scrollSavant } from './data/savant'\r\nimport { createTrainedLoreDaily, createTrainedSkillDaily } from './data/skill'\r\nimport { thaumaturgeTome } from './data/tome'\r\nimport { AsyncFunction } from '@utils/function'\r\n\r\nconst BUILTINS = [\r\n    thaumaturgeTome,\r\n    createTrainedSkillDaily('longevity', 'Compendium.pf2e.feats-srd.WoLh16gyDp8y9WOZ'), // Ancestral Longevity\r\n    createTrainedSkillDaily('ageless', 'Compendium.pf2e.feats-srd.wylnETwIz32Au46y'), // Ageless Spirit\r\n    createTrainedSkillDaily('memories', 'Compendium.pf2e.feats-srd.ptEOt3lqjxUnAW62'), // Ancient Memories\r\n    createTrainedSkillDaily('studies', 'Compendium.pf2e.feats-srd.9bgl6qYWKHzqWZj0'), // Flexible Studies\r\n    createTrainedLoreDaily('study', 'Compendium.pf2e.feats-srd.aLJsBBZzlUK3G8MW'), // Quick Study\r\n    createLanguageDaily('linguistics', 'Compendium.pf2e.feats-srd.eCWQU16hRLfN1KaX'), // Ancestral Linguistics\r\n    createLanguageDaily('borts', 'Compendium.pf2e.equipment-srd.iS7hAQMAaThHYE8g'), // Bort's Blessing\r\n    createResistancelDaily(\r\n        'elementalist',\r\n        'Compendium.pf2e.feats-srd.tx9pkrpmtqe4FnvS',\r\n        ['air', 'earth', 'fire', 'water'],\r\n        'half',\r\n        'elementalist'\r\n    ), // Elementalist Dedication\r\n    createResistancelDaily(\r\n        'ganzi',\r\n        'Compendium.pf2e.heritages.3reGfXH0S82hM7Gp',\r\n        ['acid', 'electricity', 'sonic'],\r\n        'half',\r\n        'ganzi',\r\n        true\r\n    ), // Ganzi\r\n    createFeatDaily('metamagical', 'Compendium.pf2e.classfeatures.89zWKD2CN7nRu2xp', {\r\n        category: ['class'],\r\n        traits: { selected: ['metamagic', 'wizard'], conjunction: 'and' },\r\n        level: 'half',\r\n    }), // Metamagical Experimentation\r\n    combatFlexibility,\r\n    scrollSavant,\r\n    createScrollChain('esoterica', [\r\n        'Compendium.pf2e.feats-srd.OqObuRB8oVSAEKFR', // Scroll Esoterica\r\n        'Compendium.pf2e.feats-srd.nWd7m0yRcIEVUy7O', // Elaborate Scroll Esoterica\r\n        'Compendium.pf2e.feats-srd.LHjPTV5vP3MOsPPJ', // Grand Scroll Esoterica\r\n    ]),\r\n    createScrollChain('trickster', [\r\n        'Compendium.pf2e.feats-srd.ROAUR1GhC19Pjk9C', // Basic Scroll Cache\r\n        'Compendium.pf2e.feats-srd.UrOj9TROtn8nuxPf', // Expert Scroll Cache\r\n        'Compendium.pf2e.feats-srd.lIg5Gzz7W70jfbk1', // Master Scroll Cache\r\n    ]),\r\n    TricksterAce,\r\n    mindSmith,\r\n] as unknown as Daily[]\r\n\r\ntype DailiesUUIDS = Map<ItemUUID, { daily: Daily; index?: number; condition?: BaseDailyConditionFunction }>\r\n\r\nconst BUILTINS_UUIDS: DailiesUUIDS = parseDailies(BUILTINS, 'dailies')\r\nconst UUIDS: DailiesUUIDS = new Map()\r\n\r\nfunction parseDailies(dailies: Daily[], prefix: 'dailies' | 'custom') {\r\n    const uuids: DailiesUUIDS = new Map()\r\n\r\n    for (const original of dailies) {\r\n        const daily = deepClone(original)\r\n\r\n        try {\r\n            const keyWithPrefix = `${prefix}.${daily.key}`\r\n\r\n            uuids.set(daily.item.uuid, { daily, condition: daily.item.condition })\r\n\r\n            daily.key = keyWithPrefix\r\n\r\n            if (daily.children) {\r\n                for (let i = 0; i < daily.children.length; i++) {\r\n                    const { uuid, condition } = daily.children[i]!\r\n                    uuids.set(uuid, { daily, index: i, condition })\r\n                }\r\n            }\r\n        } catch (err) {\r\n            error('error.unexpected')\r\n            console.error(err)\r\n            console.error(`The error occured during data gathering of ${prefix}.${daily.key}`)\r\n        }\r\n    }\r\n\r\n    return uuids\r\n}\r\n\r\nexport async function parseCustomDailies() {\r\n    UUIDS.clear()\r\n\r\n    const CUSTOM_DAILIES: Daily[] = []\r\n\r\n    const customs = getSetting<SavedCustomDaily[]>('customDailies')\r\n    for (const { key, code } of customs) {\r\n        try {\r\n            const fn = new AsyncFunction(code)\r\n            const daily = await fn()\r\n            CUSTOM_DAILIES.push(daily)\r\n        } catch (err) {\r\n            error('error.unexpected')\r\n            console.error(err)\r\n            console.error(`The error occured during call of custom function for ${key}`)\r\n        }\r\n    }\r\n\r\n    for (const [uuid, daily] of BUILTINS_UUIDS.entries()) {\r\n        UUIDS.set(uuid, daily)\r\n    }\r\n\r\n    const CUSTOM_UUIDS = parseDailies(CUSTOM_DAILIES, 'custom')\r\n    for (const [uuid, daily] of CUSTOM_UUIDS.entries()) {\r\n        UUIDS.set(uuid, daily)\r\n    }\r\n}\r\n\r\nexport function getDailies(actor: CharacterPF2e) {\r\n    const dailies: Record<string, ReturnedDaily> = {}\r\n\r\n    for (const item of actor.items) {\r\n        const sourceId = getSourceId(item)\r\n        if (!sourceId || (item.isOfType('physical') && item.isInvested === false)) continue\r\n\r\n        const entry = UUIDS.get(sourceId)\r\n        if (!entry) continue\r\n\r\n        const { daily, index, condition } = entry\r\n        try {\r\n            if (typeof condition === 'function' && !condition({ actor, item, utils })) continue\r\n\r\n            dailies[daily.key] ??= deepClone(daily) as ReturnedDaily\r\n\r\n            if (index === undefined) {\r\n                dailies[daily.key]!.item = item\r\n            } else {\r\n                dailies[daily.key]!.children![index]!.item = item\r\n            }\r\n        } catch (err) {\r\n            error('error.unexpected')\r\n            console.error(err)\r\n            console.error(`The error occured during data gathering of ${daily.key}`)\r\n        }\r\n    }\r\n\r\n    return Object.values(dailies).filter(daily => daily.item && daily.item instanceof Item)\r\n}\r\n\r\nexport function getDailyFromSourceId(sourceId: ItemUUID) {\r\n    return UUIDS.get(sourceId)?.daily\r\n}\r\n\r\nexport function hasAnyDaily(actor: CharacterPF2e) {\r\n    return actor.familiar || getRations(actor)?.uses.value || getDailies(actor).length\r\n}\r\n","export function getFamiliarPack() {\r\n    return game.packs.get('pf2e.familiar-abilities')! as CompendiumCollection<EffectPF2e>\r\n}\r\n\r\nexport function familiarUUID(id: string) {\r\n    return `Compendium.pf2e.familiar-abilities.${id}` as ItemUUID\r\n}\r\n","/** Short form of type and non-null check */\r\nfunction isObject<T extends object>(value: unknown): value is DeepPartial<T>\r\nfunction isObject<T extends string>(value: unknown): value is { [K in T]?: unknown }\r\nfunction isObject(value: unknown): boolean {\r\n    return typeof value === 'object' && value !== null\r\n}\r\n\r\n/**\r\n * Encapsulates logic to determine if a modifier should be active or not for a specific roll based\r\n * on a list of string values. This will often be based on traits, but that is not required - sneak\r\n * attack could be an option that is not a trait.\r\n * @category PF2\r\n */\r\nexport class PredicatePF2e extends Array<PredicateStatement> {\r\n    /** Is the predicate data structurally valid? */\r\n    readonly isValid: boolean\r\n\r\n    constructor(...statements: PredicateStatement[] | [PredicateStatement[]]) {\r\n        if (Array.isArray(statements[0])) {\r\n            super(...statements[0])\r\n        } else {\r\n            super(...(statements as PredicateStatement[]))\r\n        }\r\n        this.isValid = PredicatePF2e.isValid(this)\r\n    }\r\n\r\n    /** Structurally validate the predicates */\r\n    static isValid(statements: unknown): statements is PredicateStatement[] {\r\n        return this.isArray(statements)\r\n    }\r\n\r\n    /** Is this an array of predicatation statements? */\r\n    static override isArray(statements: unknown): statements is PredicateStatement[] {\r\n        return super.isArray(statements) && statements.every(s => StatementValidator.isStatement(s))\r\n    }\r\n\r\n    /** Test if the given predicate passes for the given list of options. */\r\n    static test(predicate: PredicateStatement[] = [], options: Set<string> | string[]): boolean {\r\n        return predicate instanceof PredicatePF2e ? predicate.test(options) : new PredicatePF2e(...predicate).test(options)\r\n    }\r\n\r\n    /** Create a predicate from unknown data, with deprecation support for legacy objects */\r\n    static create(data: unknown, warn = false): PredicatePF2e {\r\n        if (data instanceof PredicatePF2e) return data.clone()\r\n        if (Array.isArray(data)) return new PredicatePF2e(data)\r\n        if (isObject<OldRawPredicate>(data)) {\r\n            if (warn) {\r\n                foundry.utils.logCompatibilityWarning('Predicate data must be an array', {\r\n                    mode: CONST.COMPATIBILITY_MODES.WARNING,\r\n                    since: '4.2.0',\r\n                    until: '4.5.0',\r\n                })\r\n            }\r\n\r\n            return new PredicatePF2e(convertLegacyData(data))\r\n        }\r\n\r\n        return new PredicatePF2e()\r\n    }\r\n\r\n    /** Test this predicate against a domain of discourse */\r\n    test(options: Set<string> | string[]): boolean {\r\n        if (this.length === 0) {\r\n            return true\r\n        } else if (!this.isValid) {\r\n            console.error('PF2e System | The provided predicate set is malformed.')\r\n            return false\r\n        }\r\n\r\n        const domain = options instanceof Set ? options : new Set(options)\r\n        return this.every(s => this.isTrue(s, domain))\r\n    }\r\n\r\n    toObject(): RawPredicate {\r\n        return deepClone([...this])\r\n    }\r\n\r\n    clone(): PredicatePF2e {\r\n        return new PredicatePF2e(this.toObject())\r\n    }\r\n\r\n    /** Is the provided statement true? */\r\n    private isTrue(statement: PredicateStatement, domain: Set<string>): boolean {\r\n        return (\r\n            (typeof statement === 'string' && domain.has(statement)) ||\r\n            (StatementValidator.isBinaryOp(statement) && this.testBinaryOp(statement, domain)) ||\r\n            (StatementValidator.isCompound(statement) && this.testCompound(statement, domain))\r\n        )\r\n    }\r\n\r\n    private testBinaryOp(statement: BinaryOperation, domain: Set<string>): boolean {\r\n        if ('eq' in statement) {\r\n            return domain.has(`${statement.eq[0]}:${statement.eq[1]}`)\r\n        } else {\r\n            const operator = Object.keys(statement)[0]\r\n\r\n            // Allow for tests of partial statements against numeric values\r\n            // E.g., `{ \"gt\": [\"actor:level\", 5] }` would match against \"actor:level:6\" and \"actor:level:7\"\r\n            const [left, right] = Object.values(statement)[0]\r\n            const domainArray = Array.from(domain)\r\n            const leftValues =\r\n                typeof left === 'number' || !Number.isNaN(Number(left))\r\n                    ? [Number(left)]\r\n                    : domainArray.flatMap(d => (d.startsWith(left) ? Number(/:(-?\\d+)$/.exec(d)?.[1]) : []))\r\n            const rightValues =\r\n                typeof right === 'number' || !Number.isNaN(Number(right))\r\n                    ? [Number(right)]\r\n                    : domainArray.flatMap(d => (d.startsWith(right) ? Number(/:(-?\\d+)$/.exec(d)?.[1]) : []))\r\n\r\n            switch (operator) {\r\n                case 'gt':\r\n                    return leftValues.some(l => rightValues.every(r => l > r))\r\n                case 'gte':\r\n                    return leftValues.some(l => rightValues.every(r => l >= r))\r\n                case 'lt':\r\n                    return leftValues.some(l => rightValues.every(r => l < r))\r\n                case 'lte':\r\n                    return leftValues.some(l => rightValues.every(r => l <= r))\r\n                default:\r\n                    console.warn('PF2e System | Malformed binary operation encounter')\r\n                    return false\r\n            }\r\n        }\r\n    }\r\n\r\n    /** Is the provided compound statement true? */\r\n    private testCompound(statement: Exclude<PredicateStatement, Atom>, domain: Set<string>): boolean {\r\n        return (\r\n            ('and' in statement && statement.and.every(subProp => this.isTrue(subProp, domain))) ||\r\n            ('nand' in statement && !statement.nand.every(subProp => this.isTrue(subProp, domain))) ||\r\n            ('or' in statement && statement.or.some(subProp => this.isTrue(subProp, domain))) ||\r\n            ('nor' in statement && !statement.nor.some(subProp => this.isTrue(subProp, domain))) ||\r\n            ('not' in statement && !this.isTrue(statement.not, domain)) ||\r\n            ('if' in statement && !(this.isTrue(statement.if, domain) && !this.isTrue(statement.then, domain)))\r\n        )\r\n    }\r\n}\r\n\r\nclass StatementValidator {\r\n    static isStatement(statement: unknown): statement is PredicateStatement {\r\n        return statement instanceof Object\r\n            ? this.isCompound(statement) || this.isBinaryOp(statement)\r\n            : typeof statement === 'string'\r\n            ? this.isAtomic(statement)\r\n            : false\r\n    }\r\n\r\n    static isAtomic(statement: unknown): statement is Atom {\r\n        return (typeof statement === 'string' && statement.length > 0) || this.isBinaryOp(statement)\r\n    }\r\n\r\n    private static binaryOperators = new Set(['eq', 'gt', 'gte', 'lt', 'lte'])\r\n\r\n    static isBinaryOp(statement: unknown): statement is BinaryOperation {\r\n        if (!isObject(statement)) return false\r\n        const entries = Object.entries(statement)\r\n        if (entries.length > 1) return false\r\n        const [operator, operands]: [string, unknown] = entries[0]\r\n        return (\r\n            this.binaryOperators.has(operator) &&\r\n            Array.isArray(operands) &&\r\n            operands.length === 2 &&\r\n            typeof operands[0] === 'string' &&\r\n            ['string', 'number'].includes(typeof operands[1])\r\n        )\r\n    }\r\n\r\n    static isCompound(statement: unknown): statement is CompoundStatement {\r\n        return (\r\n            isObject(statement) &&\r\n            (this.isAnd(statement) ||\r\n                this.isOr(statement) ||\r\n                this.isNand(statement) ||\r\n                this.isNor(statement) ||\r\n                this.isNot(statement) ||\r\n                this.isIf(statement))\r\n        )\r\n    }\r\n\r\n    static isAnd(statement: { and?: unknown }): statement is Conjunction {\r\n        return (\r\n            Object.keys(statement).length === 1 &&\r\n            Array.isArray(statement.and) &&\r\n            statement.and.every(subProp => this.isStatement(subProp))\r\n        )\r\n    }\r\n\r\n    static isNand(statement: { nand?: unknown }): statement is AlternativeDenial {\r\n        return (\r\n            Object.keys(statement).length === 1 &&\r\n            Array.isArray(statement.nand) &&\r\n            statement.nand.every(subProp => this.isStatement(subProp))\r\n        )\r\n    }\r\n\r\n    static isOr(statement: { or?: unknown }): statement is Disjunction {\r\n        return (\r\n            Object.keys(statement).length === 1 &&\r\n            Array.isArray(statement.or) &&\r\n            statement.or.every(subProp => this.isStatement(subProp))\r\n        )\r\n    }\r\n\r\n    static isNor(statement: { nor?: unknown }): statement is JointDenial {\r\n        return (\r\n            Object.keys(statement).length === 1 &&\r\n            Array.isArray(statement.nor) &&\r\n            statement.nor.every(subProp => this.isStatement(subProp))\r\n        )\r\n    }\r\n\r\n    static isNot(statement: { not?: unknown }): statement is Negation {\r\n        return Object.keys(statement).length === 1 && !!statement.not && this.isStatement(statement.not)\r\n    }\r\n\r\n    static isIf(statement: { if?: unknown; then?: unknown }): statement is Conditional {\r\n        return Object.keys(statement).length === 2 && this.isStatement(statement.if) && this.isStatement(statement.then)\r\n    }\r\n}\r\n\r\nfunction convertLegacyData(predicate: OldRawPredicate): RawPredicate {\r\n    const keys = Object.keys(predicate)\r\n    if (keys.length === 0) return []\r\n    if (keys.length === 1 && Array.isArray(predicate.all)) {\r\n        return deepClone(predicate.all)\r\n    }\r\n    if (keys.length === 1 && Array.isArray(predicate.any) && predicate.any.length === 1) {\r\n        return deepClone(predicate.any)\r\n    }\r\n\r\n    return deepClone(\r\n        [\r\n            predicate.all ?? [],\r\n            Array.isArray(predicate.any) ? { or: predicate.any } : [],\r\n            Array.isArray(predicate.not)\r\n                ? predicate.not.length === 1\r\n                    ? { not: predicate.not[0]! }\r\n                    : { nor: predicate.not }\r\n                : [],\r\n        ].flat()\r\n    )\r\n}\r\n","import { DailiesInterface } from '@apps/interface'\r\nimport { utils } from '@src/api'\r\nimport { getFlag } from '@utils/foundry/flags'\r\nimport { hasLocalization, localize } from '@utils/foundry/localize'\r\nimport { PredicatePF2e } from '@utils/pf2e/predicate'\r\nimport { capitalize } from '@utils/string'\r\n\r\nconst templateOrders: Record<DailyRowType, number> = {\r\n    select: 100,\r\n    combo: 80,\r\n    random: 60,\r\n    alert: 40,\r\n    input: 20,\r\n    drop: 0,\r\n}\r\n\r\nexport async function getTemplate(\r\n    this: DailiesInterface,\r\n    { children = [], key, item, prepare, label, rows = [] }: ReturnedDaily\r\n) {\r\n    const actor = this.actor\r\n    const saved = (this.saved[key] = getFlag<DailySaved>(actor, key) ?? {})\r\n    const rowsObj: Record<string, DailyRow> = (this.rows[key] = {})\r\n    const childrenObj = (this.children[key] = children.reduce((children, { slug, item }) => {\r\n        children[slug] = item\r\n        return children\r\n    }, {} as DailyValueArgs['children']))\r\n\r\n    const prepareArgs: DailyPrepareArgs = {\r\n        actor,\r\n        item,\r\n        children: childrenObj,\r\n        utils,\r\n    }\r\n\r\n    const custom = (this.custom[key] = (prepare && (await prepare(prepareArgs))) || {})\r\n\r\n    const dailyArgs = (this.dailyArgs[key] = {\r\n        ...prepareArgs,\r\n        custom,\r\n    })\r\n\r\n    let groupLabel = await getProcessedValue(label, dailyArgs)\r\n    const labeled = groupLabel ? `label.${groupLabel}` : key.startsWith('dailies.') ? `label.${key.slice(8)}` : undefined\r\n    if (labeled && hasLocalization(labeled)) groupLabel = localize(labeled)\r\n\r\n    const predicates = (this.predicate[key] = children.filter(child => child.item).map(child => child.slug))\r\n\r\n    const template: DailyTemplate = {\r\n        label: groupLabel ? game.i18n.localize(groupLabel) : item.name,\r\n        rows: [],\r\n    }\r\n\r\n    for (const row of rows) {\r\n        rowsObj[row.slug] = row\r\n\r\n        const { type, slug, childPredicate = [], condition, label, save } = row\r\n\r\n        if (childPredicate.length && !PredicatePF2e.test(childPredicate, predicates)) continue\r\n        if (condition && !(await condition(dailyArgs))) continue\r\n\r\n        const savedRow = save === false || type === 'random' ? undefined : saved[slug]\r\n        const rowLabel = await getProcessedValue(label, dailyArgs)\r\n        const value =\r\n            savedRow === undefined\r\n                ? ''\r\n                : typeof savedRow !== 'object'\r\n                ? savedRow\r\n                : 'name' in savedRow\r\n                ? savedRow.name\r\n                : savedRow.selected\r\n\r\n        const rowTemplate: DailyRowTemplate = {\r\n            label: rowLabel ? game.i18n.localize(rowLabel) : '',\r\n            value,\r\n            order: templateOrders[type],\r\n            data: {\r\n                type,\r\n                daily: key,\r\n                row: slug,\r\n            },\r\n        }\r\n\r\n        if (isComboRow(row) || isSelectRow(row) || isRandomRow(row)) {\r\n            const tmp = (await getProcessedValue(row.options, dailyArgs)) ?? []\r\n            if (type !== 'combo' && !tmp.length) continue\r\n\r\n            const labelize =\r\n                (typeof row.labelizer === 'function' && row.labelizer(dailyArgs)) || ((value: string) => capitalize(value))\r\n            rowTemplate.options = tmp.map(value => (typeof value === 'string' ? { value, label: labelize(value) } : value))\r\n\r\n            if (isComboRow(row)) {\r\n                rowTemplate.selected = rowTemplate.value\r\n                rowTemplate.data.input = (savedRow as DailySavedCombo | undefined)?.input ?? true\r\n\r\n                if (!rowTemplate.data.input && tmp.includes(rowTemplate.selected)) {\r\n                    rowTemplate.value = labelize(rowTemplate.selected)\r\n                }\r\n            }\r\n        } else if (isDropRow(row)) {\r\n            rowTemplate.data.uuid = (savedRow as DailySavedDrop | undefined)?.uuid ?? ''\r\n        } else if (isAlerRow(row)) {\r\n            rowTemplate.value = typeof row.message === 'function' ? await row.message(dailyArgs) : row.message\r\n        }\r\n\r\n        template.rows.push(rowTemplate)\r\n    }\r\n\r\n    return template\r\n}\r\n\r\nasync function getProcessedValue<T extends any, R = T extends (...args: any[]) => infer R ? R : T>(obj: T, args: DailyValueArgs) {\r\n    if (typeof obj === 'function') return (await obj(args)) as Promise<R>\r\n    return obj as R\r\n}\r\n\r\nfunction isComboRow(row: DailyRow): row is DailyRowCombo {\r\n    return row.type === 'combo'\r\n}\r\n\r\nfunction isSelectRow(row: DailyRow): row is DailyRowSelect {\r\n    return row.type === 'select'\r\n}\r\n\r\nfunction isRandomRow(row: DailyRow): row is DailyRowRandom {\r\n    return row.type === 'random'\r\n}\r\n\r\nfunction isDropRow(row: DailyRow): row is DailyRowDrop {\r\n    return row.type === 'drop'\r\n}\r\n\r\nfunction isAlerRow(row: DailyRow): row is DailyRowAlert {\r\n    return row.type === 'alert'\r\n}\r\n","import { DailiesInterface } from '@apps/interface'\r\nimport { sequenceArray } from '@utils/utils'\r\n\r\nexport function getSimplifiableValue(actor: CharacterPF2e, value: number | 'half' | 'level' | undefined, fallback: number): number\r\nexport function getSimplifiableValue(\r\n    actor: CharacterPF2e,\r\n    value: number | 'half' | 'level' | undefined,\r\n    fallback?: number\r\n): number | undefined\r\nexport function getSimplifiableValue(\r\n    actor: CharacterPF2e,\r\n    value: number | 'half' | 'level' | undefined,\r\n    fallback?: number\r\n): number | undefined {\r\n    if (value === undefined) return fallback\r\n    if (typeof value === 'number') return value\r\n    if (value === 'level') return actor.level\r\n    if (value === 'half') return Math.max(1, Math.floor(actor.level / 2))\r\n    const numbered = Number(value)\r\n    return isNaN(numbered) ? fallback : numbered\r\n}\r\n\r\nexport async function parseFilter(this: DailiesInterface, filter: DailyDropResultFilter) {\r\n    return {\r\n        type: filter.type,\r\n        search: await (filter.type === 'feat'\r\n            ? parseFeatFilter(this.actor, filter.search)\r\n            : parseSpellFilter(this.actor, filter.search)),\r\n        drop: filter.drop,\r\n    } as DailyDropParsedFilter\r\n}\r\n\r\nfunction checkFilter(selected: (string | number)[] | undefined, checkbox: CheckboxData) {\r\n    if (!selected?.length) return\r\n\r\n    checkbox.selected = selected\r\n    checkbox.isExpanded = true\r\n    selected.forEach(x => (checkbox.options[x]!.selected = true))\r\n}\r\n\r\nfunction setTraits(searchTraits: BaseDailyFilter['traits'], dataTraits: MultiselectData) {\r\n    const traits = getFilterTraits(searchTraits)\r\n    if (traits?.selected.length) {\r\n        dataTraits.conjunction = traits.conjunction\r\n        dataTraits.selected = traits.selected\r\n    }\r\n}\r\n\r\nexport function getFilterTraits<V extends string>(traits: BaseDailyFilter<V>['traits']) {\r\n    if (!traits) return\r\n\r\n    const selected = Array.isArray(traits) ? traits : traits.selected\r\n    if (!selected?.length) return\r\n\r\n    return {\r\n        selected: selected.map(x => (typeof x === 'string' ? { value: x } : x)),\r\n        conjunction: (!Array.isArray(traits) && traits.conjunction) || 'and',\r\n    }\r\n}\r\n\r\nasync function parseSpellFilter(actor: CharacterPF2e, search: DailySpellFilter) {\r\n    const data = await game.pf2e.compendiumBrowser.tabs.spell.getFilterData()\r\n\r\n    checkFilter(search.category, data.checkboxes.category)\r\n    checkFilter(search.school, data.checkboxes.school)\r\n    checkFilter(search.traditions, data.checkboxes.traditions)\r\n    checkFilter(search.rarity, data.checkboxes.rarity)\r\n    checkFilter(search.source, data.checkboxes.source)\r\n\r\n    setTraits(search.traits, data.multiselects.traits)\r\n\r\n    const level = getSpellFilterLevel(actor, search.level)\r\n    if (level?.length) checkFilter(level, data.checkboxes.level)\r\n\r\n    return data\r\n}\r\n\r\nasync function parseFeatFilter(actor: CharacterPF2e, search: DailyFeatFilter) {\r\n    const data = await game.pf2e.compendiumBrowser.tabs.feat.getFilterData()\r\n\r\n    checkFilter(search.category, data.checkboxes.category)\r\n    checkFilter(search.skills, data.checkboxes.skills)\r\n    checkFilter(search.rarity, data.checkboxes.rarity)\r\n    checkFilter(search.source, data.checkboxes.source)\r\n\r\n    setTraits(search.traits, data.multiselects.traits)\r\n\r\n    const level = getFeatFilterLevel(actor, search.level)\r\n    if (level) {\r\n        data.sliders.level.values.min = level.min\r\n        data.sliders.level.values.max = level.max\r\n        data.sliders.level.isExpanded = true\r\n    }\r\n\r\n    return data\r\n}\r\n\r\nexport function getSpellFilterLevel(actor: CharacterPF2e, level: DailySpellFilter['level']) {\r\n    if (Array.isArray(level)) return level\r\n\r\n    const simplified = getSimplifiableValue(actor, level)\r\n    if (simplified) return sequenceArray(1, simplified)\r\n}\r\n\r\nexport function getFeatFilterLevel(actor: CharacterPF2e, level: DailyFeatFilter['level']) {\r\n    if (level === undefined) return\r\n\r\n    if (typeof level === 'object') {\r\n        return {\r\n            min: getSimplifiableValue(actor, level.min, 0),\r\n            max: getSimplifiableValue(actor, level.min, 20),\r\n        }\r\n    } else {\r\n        return { min: 0, max: getSimplifiableValue(actor, level, 20) }\r\n    }\r\n}\r\n","import { DailiesInterface } from '@apps/interface'\r\nimport { subLocalize } from '@utils/foundry/localize'\r\nimport { getTranslatedSkills } from '@utils/pf2e/skills'\r\nimport { sluggify } from '@utils/pf2e/utils'\r\nimport { getFeatFilterLevel, getFilterTraits, getSpellFilterLevel } from './shared'\r\n\r\nconst localize = subLocalize('interface.error.drop')\r\n\r\nexport async function onDropFeat(\r\n    this: DailiesInterface,\r\n    item: ItemPF2e,\r\n    target: HTMLInputElement,\r\n    filter: DailyDropFeatResultFilter\r\n) {\r\n    if (!item.isOfType('feat')) return localize('notFeat')\r\n\r\n    const { search, drop } = filter\r\n\r\n    if (search.category?.length && !search.category.includes(item.category)) {\r\n        return localize.warn('wrongType', { types: localizeAll('featCategories', search.category) })\r\n    }\r\n\r\n    if (search.traits) {\r\n        const traits = getFilterTraits(search.traits)\r\n\r\n        if (traits?.selected.length) {\r\n            const testFn = traits.conjunction === 'or' ? 'some' : 'every'\r\n            const test = traits.selected[testFn](trait => Number(trait.not ?? false) - Number(item.traits.has(trait.value)))\r\n            if (!test) return localize.warn('wrongTraits')\r\n        }\r\n    }\r\n\r\n    if (search.skills?.length) {\r\n        const translatedSkills = getTranslatedSkills()\r\n        const prerequisites = item.system.prerequisites.value.map(prerequisite => prerequisite.value.toLocaleLowerCase())\r\n        const test = search.skills.some(skill =>\r\n            prerequisites.some(prerequisite => prerequisite.includes(skill) || prerequisite.includes(translatedSkills[skill]!))\r\n        )\r\n        if (!test) return localize.warn('wrongSkill', { skills: localizeAll('skillList', search.skills) })\r\n    }\r\n\r\n    if (search.rarity?.length && !search.rarity.includes(item.system.traits.rarity)) {\r\n        return localize.warn('wrongRarity', { rarities: localizeAll('rarityTraits', search.rarity) })\r\n    }\r\n\r\n    if (search.source?.length && !search.source.includes(sluggify(item.system.source.value))) {\r\n        return localize.warn('wrongSource', { sources: search.source.join(', ') })\r\n    }\r\n\r\n    const level = getFeatFilterLevel(this.actor, search.level)\r\n    if (level) {\r\n        const itemLevel = item.level\r\n        if (itemLevel < level.min) return localize.warn('wrongLevelLow', { level: `min: ${level.min}` })\r\n        else if (itemLevel > level.max) return localize.warn('wrongLevelHigh', { level: `max: ${level.max}` })\r\n    }\r\n\r\n    if (drop) {\r\n        const args = this.dailyArgs[target.dataset.daily!]\r\n        if (args) {\r\n            const result = await drop(item, args)\r\n            if (typeof result === 'object') {\r\n                if (result.data) return game.i18n.format(result.error, result.data)\r\n                else return game.i18n.localize(result.error)\r\n            } else if (result === false) {\r\n                return localize.warn('wrongCustom')\r\n            }\r\n        }\r\n    }\r\n\r\n    onDropItem(item, target)\r\n}\r\n\r\nexport async function onDropSpell(\r\n    this: DailiesInterface,\r\n    item: ItemPF2e,\r\n    target: HTMLInputElement,\r\n    filter: DailyDropSpellResultFilter\r\n) {\r\n    if (!item.isOfType('spell')) return localize('notSpell')\r\n\r\n    const { search, drop } = filter\r\n\r\n    if (search.category?.length) {\r\n        const categories = search.category\r\n            .map(x => game.i18n.localize(x === 'cantrip' ? 'PF2E.SpellCantripLabel' : CONFIG.PF2E.spellCategories[x]))\r\n            .join(', ')\r\n\r\n        if (\r\n            (item.isCantrip && !search.category.includes('cantrip')) ||\r\n            (item.isFocusSpell && !search.category.includes('focus')) ||\r\n            (item.isRitual && !search.category.includes('ritual')) ||\r\n            (!item.isCantrip && !item.isFocusSpell && !item.isRitual && !search.category.includes('spell'))\r\n        ) {\r\n            return localize.warn('wrongCategory', { categories })\r\n        }\r\n    }\r\n\r\n    if (search.traits) {\r\n        const traits = getFilterTraits(search.traits)\r\n\r\n        if (traits?.selected.length) {\r\n            const testFn = traits.conjunction === 'or' ? 'some' : 'every'\r\n            const test = traits.selected[testFn](trait => Number(trait.not ?? false) - Number(item.traits.has(trait.value)))\r\n            if (!test) return localize.warn('wrongTraits')\r\n        }\r\n    }\r\n\r\n    if (search.traditions?.length) {\r\n        if (!search.traditions.some(tradition => item.traditions.has(tradition))) {\r\n            return localize.warn('wrongTradition', { traditions: localizeAll('magicTraditions', search.traditions) })\r\n        }\r\n    }\r\n\r\n    const level = getSpellFilterLevel(this.actor, search.level)\r\n    if (level?.length && !level.includes(item.level)) {\r\n        return localize.warn('wrongLevel', { levels: level.join(', ') })\r\n    }\r\n\r\n    if (search.school?.length && !search.school.includes(item.school)) {\r\n        return localize.warn('wrongSchool', { schools: localizeAll('magicSchools', search.school) })\r\n    }\r\n\r\n    if (search.rarity?.length && !search.rarity.includes(item.system.traits.rarity)) {\r\n        return localize.warn('wrongRarity', { rarities: localizeAll('rarityTraits', search.rarity) })\r\n    }\r\n\r\n    if (search.source?.length && !search.source.includes(sluggify(item.system.source.value))) {\r\n        return localize.warn('wrongSource', { sources: search.source.join(', ') })\r\n    }\r\n\r\n    if (drop) {\r\n        const args = this.dailyArgs[target.dataset.daily!]\r\n        if (args) {\r\n            const result = await drop(item, args)\r\n            if (typeof result === 'object') {\r\n                if (result.data) return ui.notifications.warn(game.i18n.format(result.error, result.data))\r\n                else return ui.notifications.warn(game.i18n.localize(result.error))\r\n            } else if (result === false) {\r\n                return localize.warn('wrongCustom')\r\n            }\r\n        }\r\n    }\r\n\r\n    onDropItem(item, target)\r\n}\r\n\r\nfunction localizeAll<C extends keyof typeof CONFIG.PF2E, K extends keyof typeof CONFIG.PF2E[C]>(config: C, list: K[]): string {\r\n    const localized = list.map(key => game.i18n.localize(CONFIG.PF2E[config][key] as unknown as string))\r\n    return localized.join(', ')\r\n}\r\n\r\nexport function onDropItem(item: ItemPF2e, target: HTMLInputElement) {\r\n    target.value = item.name\r\n    target.dataset.uuid = item.uuid\r\n    target.nextElementSibling!.nextElementSibling!.classList.remove('disabled')\r\n}\r\n","import { DailiesInterface } from '@apps/interface'\r\nimport { familiarUUID, getFamiliarPack } from '@data/familiar'\r\nimport { getRations } from '@data/rations'\r\nimport { MODULE_ID } from '@src/main'\r\nimport { getFlag } from '@utils/foundry/flags'\r\nimport { hasLocalization, localize, subLocalize } from '@utils/foundry/localize'\r\nimport { error } from '@utils/foundry/notification'\r\nimport { chatUUID, fakeChatUUID } from '@utils/foundry/uuid'\r\nimport { sluggify } from '@utils/pf2e/utils'\r\n\r\nexport async function processData(this: DailiesInterface) {\r\n    const actor = this.actor\r\n    const dailies = this.dailies\r\n    const fields = getFields.call(this)\r\n    const addItems: DeepPartial<BaseItemSourcePF2e>[] = []\r\n    const addRules: Map<string, DailyRuleSource[]> = new Map()\r\n    const updateItems: EmbeddedDocumentUpdateData<ItemPF2e>[] = []\r\n    const flags: Record<string, DailySaved> = {}\r\n    const msg = subLocalize('message')\r\n\r\n    let addedSpells: boolean = false\r\n    let message = ''\r\n\r\n    const getRules = (item: ItemPF2e) => {\r\n        const id = item.id\r\n        const existing = addRules.get(id)\r\n        if (existing) return existing\r\n\r\n        const rules = deepClone(item._source.system.rules)\r\n\r\n        for (let i = rules.length - 1; i >= 0; i--) {\r\n            if (MODULE_ID in rules[i]!) rules.splice(i, 1)\r\n        }\r\n\r\n        addRules.set(id, rules)\r\n        return rules\r\n    }\r\n\r\n    const messages: DailyMessageGroups = {\r\n        languages: { order: 80, messages: [] },\r\n        skills: { order: 70, messages: [] },\r\n        resistances: { order: 60, messages: [] },\r\n        feats: { order: 50, messages: [] },\r\n        spells: { order: 40, messages: [] },\r\n        scrolls: { order: 30, messages: [] },\r\n    }\r\n\r\n    const messageObj = {\r\n        add: (group: string, options: DailyMessage) => {\r\n            messages[group] ??= { order: 0, messages: [] }\r\n            messages[group]!.messages.push(options)\r\n        },\r\n        addGroup: (group: string, order = 1, label?: string) => {\r\n            messages[group] ??= { label, order, messages: [] }\r\n        },\r\n    }\r\n\r\n    if (actor.familiar && fields['dailies.familiar']) {\r\n        const familiar = actor.familiar\r\n        const pack = getFamiliarPack()\r\n        const abilities: EffectSource[] = []\r\n\r\n        // we remove old abilities\r\n        const ids = familiar.itemTypes.effect.map(effect => effect.id)\r\n        if (ids.length) familiar.deleteEmbeddedDocuments('Item', ids)\r\n\r\n        messageObj.addGroup('familiar', 20)\r\n\r\n        for (const field of Object.values(fields['dailies.familiar'])) {\r\n            const value = field.value as ItemUUID\r\n            const isCustom = value.includes('.')\r\n            const item = await (isCustom ? fromUuid<ItemPF2e>(value) : pack.getDocument(value))\r\n            if (!item || !item.isOfType('effect')) continue\r\n\r\n            const source = item.toObject()\r\n            if (source) {\r\n                abilities.push(source)\r\n                messageObj.add('familiar', { uuid: isCustom ? (value as ItemUUID) : familiarUUID(value) })\r\n            }\r\n        }\r\n\r\n        if (abilities.length) familiar.createEmbeddedDocuments('Item', abilities)\r\n    }\r\n\r\n    if (fields['dailies.rations']?.rations!.value === 'true') {\r\n        const rations = getRations(actor)\r\n\r\n        if (rations?.uses.value) {\r\n            const quantity = rations.quantity\r\n            const { value, max } = rations.uses\r\n\r\n            if (value <= 1) {\r\n                if (quantity <= 1) {\r\n                    rations.delete()\r\n                } else {\r\n                    updateItems.push({\r\n                        _id: rations.id,\r\n                        'system.quantity': Math.max(rations.quantity - 1, 0),\r\n                        'system.charges.value': max,\r\n                    })\r\n                }\r\n            } else {\r\n                updateItems.push({\r\n                    _id: rations.id,\r\n                    'system.charges.value': Math.max(value - 1, 0),\r\n                })\r\n            }\r\n\r\n            const remaining = (quantity - 1) * max + value\r\n            const name = remaining <= 1 ? fakeChatUUID(rations.name) : chatUUID(rations.uuid)\r\n\r\n            if (remaining <= 1) message += msg('rations.last', { name })\r\n            else if (remaining <= 3) message += msg('rations.almost', { name, nb: remaining - 1 })\r\n            else message += msg('rations.used', { name, nb: remaining - 1 })\r\n        }\r\n    }\r\n\r\n    for (const { item, key, process } of dailies) {\r\n        if (!fields[key]) continue\r\n\r\n        const dailyArgs = this.dailyArgs[key]!\r\n\r\n        try {\r\n            await process({\r\n                ...dailyArgs,\r\n                fields: fields[key]!,\r\n                messages: messageObj,\r\n                addItem: source => addItems.push(source),\r\n                updateItem: data => updateItems.push(data),\r\n                addRule: (source, parent) => getRules(parent ?? item).push(source),\r\n                addFeat: (source, parent) => {\r\n                    if (item.isOfType('feat')) {\r\n                        const parentId = (parent ?? item).id\r\n                        setProperty(source, 'flags.pf2e.grantedBy', { id: parentId, onDelete: 'cascade' })\r\n                        setProperty(source, `flags.${MODULE_ID}.grantedBy`, parentId)\r\n                    }\r\n                    addItems.push(source)\r\n                },\r\n                addSpell: (source, level) => {\r\n                    setProperty(source, `flags.${MODULE_ID}.entry`, { level: level })\r\n                    addItems.push(source)\r\n                    addedSpells = true\r\n                },\r\n            })\r\n        } catch (err) {\r\n            error('error.unexpected')\r\n            console.error(err)\r\n            console.error(`The error occured during processing of ${key}`)\r\n        }\r\n    }\r\n\r\n    for (const [key, rowFields] of Object.entries(fields)) {\r\n        const rows = this.rows[key]\r\n        if (!rows) continue\r\n\r\n        for (const { row, type, input, value, uuid } of Object.values(rowFields)) {\r\n            if (type === 'random' || rows[row]?.save === false) continue\r\n\r\n            const flag = (flags[key] ??= {})\r\n\r\n            if (type === 'combo') {\r\n                flag[row] = { input: input === 'true', selected: value }\r\n            } else if (type === 'drop') {\r\n                flag[row] = { uuid: uuid as ItemUUID, name: value }\r\n            } else {\r\n                flag[row] = value\r\n            }\r\n        }\r\n    }\r\n\r\n    for (const [id, rules] of addRules) {\r\n        rules.forEach(x => (x[MODULE_ID] = true))\r\n        updateItems.push({ _id: id, 'system.rules': rules })\r\n    }\r\n\r\n    if (addedSpells) {\r\n        const entry: DeepPartial<SpellcastingEntrySource> = {\r\n            type: 'spellcastingEntry',\r\n            name: localize('spellEntry.name'),\r\n            system: {\r\n                prepared: { value: 'innate' },\r\n                showSlotlessLevels: { value: false },\r\n                showUnpreparedSpells: { value: false },\r\n                proficiency: { value: 1, slug: actor.classDC?.slug || actor.class?.slug || undefined },\r\n            },\r\n        }\r\n        addItems.push(entry)\r\n    }\r\n\r\n    for (const source of addItems) {\r\n        const alreadyTemp = getProperty(source, 'system.temporary') === true\r\n        if (!alreadyTemp) setProperty(source, `flags.${MODULE_ID}.temporary`, true)\r\n    }\r\n\r\n    if (addItems.length) {\r\n        const items = (await actor.createEmbeddedDocuments('Item', addItems)) as ItemPF2e[]\r\n\r\n        for (const item of items) {\r\n            if (item.isOfType('feat')) {\r\n                // we add itemGrants flag to the parent feat to have the cascade effect in the tab\r\n                const parentId = getFlag<string>(item, 'grantedBy')\r\n                if (parentId) {\r\n                    const slug = sluggify(item.name, { camel: 'dromedary' })\r\n                    const path = `flags.pf2e.itemGrants.${slug}`\r\n                    updateItems.push({ _id: parentId, [path]: { id: item.id, onDelete: 'detach' } })\r\n                }\r\n            } else if (item.isOfType('spellcastingEntry')) {\r\n                // we add all the newly created spells with 'addSpell' to this spellcasting entry\r\n                const spells = items.filter(item => item.isOfType('spell') && getFlag(item, 'entry'))\r\n                for (const spell of spells) {\r\n                    const { level } = getFlag<{ level?: number }>(spell, 'entry')!\r\n                    const data: EmbeddedDocumentUpdateData<ItemPF2e> = { _id: spell.id, 'system.location.value': item.id }\r\n                    if (level !== undefined) data['system.location.heightenedLevel'] = level\r\n                    updateItems.push(data)\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    await actor.update({ [`flags.${MODULE_ID}`]: { ...expandObject(flags), rested: false } })\r\n\r\n    if (updateItems.length) await actor.updateEmbeddedDocuments('Item', updateItems)\r\n\r\n    message = parseMessages(messages, message)\r\n    message = message ? `${msg('changes')}<hr />${message}` : msg('noChanges')\r\n    ChatMessage.create({ content: message, speaker: ChatMessage.getSpeaker({ actor }) })\r\n}\r\n\r\nfunction parseMessages(messages: DailyMessageGroups, message: string) {\r\n    const msg = subLocalize('message')\r\n\r\n    const messageList = Object.entries(messages).map(([type, options]) => {\r\n        options.label ??= msg.has(type) ? msg(type) : msg('gained', { type })\r\n        return options\r\n    })\r\n    messageList.sort((a, b) => b.order - a.order)\r\n\r\n    for (const { label, messages } of messageList) {\r\n        if (!messages.length) continue\r\n\r\n        if (message) message += '<hr />'\r\n\r\n        if (label) message += `<p><strong>${label}</strong></p>`\r\n\r\n        for (let { uuid, selected, label, random } of messages) {\r\n            const key = `label.${label}`\r\n            label = label && hasLocalization(key) ? localize(key) : label || ''\r\n\r\n            message += '<p>'\r\n            message += uuid ? `${chatUUID(uuid, label)}` : `<strong>${label}</strong>`\r\n            if (selected) message += ` <span>${selected}</span>`\r\n            if (random) message += ' <i class=\"fa-solid fa-dice-d20\"></i>'\r\n            message += '</p>'\r\n        }\r\n    }\r\n\r\n    return message\r\n}\r\n\r\nfunction getFields(this: DailiesInterface) {\r\n    const elements = this.element\r\n        .find('.window-content .content')\r\n        .find<HTMLInputElement | HTMLSelectElement>('input:not(.alert), select[data-type]')\r\n        .toArray()\r\n\r\n    const fields: Record<string, DailyRowFields> = {}\r\n\r\n    for (const element of elements) {\r\n        const field = {\r\n            ...element.dataset,\r\n            value: element.value,\r\n        } as DailyRowField\r\n\r\n        if (field.type === 'combo' && field.input === 'false') {\r\n            const select = element.previousElementSibling as HTMLSelectElement\r\n            field.value = select.value\r\n        }\r\n\r\n        fields[field.daily] ??= {}\r\n        fields[field.daily]![field.row] = field\r\n    }\r\n\r\n    return fields\r\n}\r\n","import { getFamiliarPack } from '@data/familiar'\r\nimport { getRations } from '@data/rations'\r\nimport { getDailies } from '@src/dailies'\r\nimport { getFlag } from '@utils/foundry/flags'\r\nimport { subLocalize } from '@utils/foundry/localize'\r\nimport { templatePath } from '@utils/foundry/path'\r\nimport { getSetting } from '@utils/foundry/settings'\r\nimport { getTemplate } from './interface/data'\r\nimport { onDropFeat, onDropItem, onDropSpell } from './interface/drop'\r\nimport { processData } from './interface/process'\r\nimport { parseFilter } from './interface/shared'\r\n\r\nconst localize = subLocalize('interface')\r\n\r\nexport class DailiesInterface extends Application {\r\n    private _actor: CharacterPF2e\r\n    private _randomInterval?: NodeJS.Timer\r\n    private _dailies: ReturnedDaily[] = []\r\n    private _dailyArgs: Record<string, DailyValueArgs> = {}\r\n    private _saved: Record<string, DailySaved> = {}\r\n    private _children: Record<string, DailyValueArgs['children']> = {}\r\n    private _custom: Record<string, DailyCustom> = {}\r\n    private _predicate: Record<string, string[]> = {}\r\n    private _rows: Record<string, Record<string, DailyRow>> = {}\r\n\r\n    constructor(actor: CharacterPF2e, options?: Partial<ApplicationOptions>) {\r\n        super(options)\r\n        this._actor = actor\r\n    }\r\n\r\n    static get defaultOptions() {\r\n        return mergeObject(super.defaultOptions, {\r\n            id: 'pf2e-dailies-interface',\r\n            title: localize('title'),\r\n            template: templatePath('interface.hbs'),\r\n            height: 'auto',\r\n            submitOnClose: false,\r\n            submitOnChange: false,\r\n            dragDrop: [\r\n                {\r\n                    dropSelector: '[data-droppable=\"true\"]',\r\n                },\r\n            ],\r\n        })\r\n    }\r\n\r\n    get actor() {\r\n        return this._actor\r\n    }\r\n\r\n    get dailies() {\r\n        return this._dailies\r\n    }\r\n\r\n    get dailyArgs() {\r\n        return this._dailyArgs\r\n    }\r\n\r\n    get saved() {\r\n        return this._saved\r\n    }\r\n\r\n    get children() {\r\n        return this._children\r\n    }\r\n\r\n    get custom() {\r\n        return this._custom\r\n    }\r\n\r\n    get predicate() {\r\n        return this._predicate\r\n    }\r\n\r\n    get rows() {\r\n        return this._rows\r\n    }\r\n\r\n    async getData(options?: Partial<FormApplicationOptions> | undefined) {\r\n        const templates: DailyTemplate[] = []\r\n        const actor = this._actor\r\n        this._dailies = getDailies(actor)\r\n\r\n        if (actor.familiar) {\r\n            const type = 'dailies.familiar'\r\n            const localize = subLocalize('label')\r\n            const nbAbilityies = actor.attributes.familiarAbilities.value\r\n            const pack = getFamiliarPack()\r\n            const flags = getFlag<Record<`${number}`, string>>(actor, type) ?? {}\r\n\r\n            const template: DailyTemplate = {\r\n                label: localize('familiar'),\r\n                rows: [],\r\n            }\r\n\r\n            const options: SelectOption[] = pack.index.map(({ _id, name }) => ({ value: _id, label: name }))\r\n\r\n            const customUUIDS = getSetting<string>('familiar').split(',') as ItemUUID[]\r\n            for (let uuid of customUUIDS) {\r\n                uuid = uuid.trim() as ItemUUID\r\n                const item = await fromUuid<ItemPF2e>(uuid)\r\n                if (item && item.isOfType('effect')) options.push({ value: uuid, label: item.name })\r\n            }\r\n\r\n            options.sort((a, b) => (a.label < b.label ? -1 : b.label < a.label ? 1 : 0))\r\n\r\n            for (let index = 0; index < nbAbilityies; index++) {\r\n                template.rows.push({\r\n                    label: localize('ability', { nb: index + 1 }),\r\n                    value: flags[`${index}`] ?? '',\r\n                    order: 100,\r\n                    options,\r\n                    data: {\r\n                        type: 'select',\r\n                        daily: type,\r\n                        row: index.toString(),\r\n                    },\r\n                })\r\n            }\r\n\r\n            if (template.rows.length) {\r\n                this._rows[type] = template.rows.reduce((rows, { data }) => {\r\n                    rows[data.row] = { save: true } as DailyRow\r\n                    return rows\r\n                }, {} as Record<string, DailyRow>)\r\n                templates.push(template)\r\n            }\r\n        }\r\n\r\n        const rations = getRations(actor)\r\n        if (rations?.uses.value) {\r\n            const type = 'dailies.rations'\r\n            const row = 'rations'\r\n            const { value, max } = rations.uses\r\n            const quantity = rations.quantity\r\n            const remaining = (quantity - 1) * max + value\r\n            const last = remaining <= 1\r\n\r\n            const options = [\r\n                {\r\n                    value: 'false',\r\n                    label: localize('rations.no'),\r\n                },\r\n                {\r\n                    value: 'true',\r\n                    label: last ? localize('rations.last') : localize('rations.yes', { nb: remaining }),\r\n                },\r\n            ]\r\n\r\n            templates.push({\r\n                label: rations.name,\r\n                rows: [\r\n                    {\r\n                        label: '',\r\n                        order: 200,\r\n                        value: 'false',\r\n                        options,\r\n                        data: {\r\n                            type: 'select',\r\n                            daily: type,\r\n                            row: row,\r\n                        },\r\n                    },\r\n                ],\r\n            })\r\n\r\n            this._rows[type] = { [row]: { save: false } as DailyRow }\r\n        }\r\n\r\n        for (const daily of this._dailies) {\r\n            try {\r\n                const template = await getTemplate.call(this, daily)\r\n                templates.push(template)\r\n            } catch (error) {\r\n                localize.error('error.unexpected')\r\n                console.error(error)\r\n                console.error(`The error occured during templating of ${daily.key}`)\r\n            }\r\n        }\r\n\r\n        const rows: DailyTemplate[] = []\r\n        const groups: DailyTemplate[] = []\r\n        for (const template of templates) {\r\n            if (template.rows.length > 1) groups.push(template)\r\n            else if (template.rows.length) rows.push(template)\r\n        }\r\n\r\n        rows.sort((a, b) => b.rows[0]!.order - a.rows[0]!.order)\r\n        groups.sort((a, b) => a.rows.length - b.rows.length)\r\n\r\n        return mergeObject(super.getData(options), {\r\n            i18n: localize,\r\n            dump: ({ value, placeholder, data }: DailyRowTemplate) => {\r\n                let msg = ''\r\n                if (value) msg += ` value=\"${value}\"`\r\n                if (placeholder) msg += ` placeholder=\"${placeholder}\"`\r\n                Object.entries(data).forEach(([key, value]) => (msg += ` data-${key}=\"${value}\"`))\r\n                if (msg) msg += ' '\r\n                return msg\r\n            },\r\n            rows,\r\n            groups,\r\n        })\r\n    }\r\n\r\n    render(force?: boolean | undefined, options?: RenderOptions | undefined) {\r\n        if (this._randomInterval) clearInterval(this._randomInterval)\r\n\r\n        if (this.element.find('select.random')) {\r\n            this._randomInterval = setInterval(() => {\r\n                const randoms = this.element.find<HTMLSelectElement>('select.random')\r\n                randoms.each((_, select) => {\r\n                    select.selectedIndex = (select.selectedIndex + 1) % select.options.length\r\n                })\r\n            }, 2000)\r\n        }\r\n\r\n        return super.render(force, options)\r\n    }\r\n\r\n    close(options?: ({ force?: boolean | undefined } & Record<string, unknown>) | undefined) {\r\n        if (this._randomInterval) clearInterval(this._randomInterval)\r\n        return super.close(options)\r\n    }\r\n\r\n    activateListeners(html: JQuery<HTMLElement>): void {\r\n        super.activateListeners(html)\r\n\r\n        html.find<HTMLAnchorElement>('[data-action=clear]').on('click', this.#onClear.bind(this))\r\n        html.find<HTMLButtonElement>('[data-action=accept]').on('click', this.#onAccept.bind(this))\r\n        html.find<HTMLButtonElement>('[data-action=cancel]').on('click', this.#onCancel.bind(this))\r\n\r\n        html.find<HTMLSelectElement>('.combo select').on('change', this.#onComboSelectChange.bind(this))\r\n        html.find<HTMLInputElement>('.combo input').on('change', this.#onComboInputChange.bind(this))\r\n\r\n        html.find<HTMLAnchorElement>('[data-action=search]').on('click', this.#onSearch.bind(this))\r\n\r\n        html.find<HTMLAnchorElement>('[data-action=alert]').on('click', this.#onAlert.bind(this))\r\n    }\r\n\r\n    protected async _onDrop(event: ElementDragEvent) {\r\n        const localize = subLocalize('interface.error.drop')\r\n        let target = event.target as HTMLInputElement | HTMLLabelElement\r\n        if (target instanceof HTMLLabelElement) target = target.nextElementSibling as HTMLInputElement\r\n\r\n        try {\r\n            const dataString = event.dataTransfer?.getData('text/plain')\r\n            const data: { type: string; uuid: ItemUUID } = JSON.parse(dataString)\r\n\r\n            if (!data || data.type !== 'Item' || typeof data.uuid !== 'string') return localize.warn('wrongDataType')\r\n\r\n            const item = await fromUuid<ItemPF2e>(data.uuid)\r\n            if (!item) return localize.warn('wrongDataType')\r\n\r\n            const filter = await this.#getfilterFromElement(target)\r\n            if (!filter) return onDropItem(item, target)\r\n\r\n            if (filter.type === 'feat') onDropFeat.call(this, item, target, filter)\r\n            else if (filter.type === 'spell') onDropSpell.call(this, item, target, filter)\r\n            else onDropItem(item, target)\r\n        } catch (error) {\r\n            localize.error('error.unexpected')\r\n            console.error(error)\r\n            console.error(`The error occured during _onDrop`)\r\n        }\r\n    }\r\n\r\n    async #onAlert(event: JQuery.ClickEvent<any, any, HTMLAnchorElement>) {\r\n        event.preventDefault()\r\n        this.#lock()\r\n\r\n        const data = event.currentTarget.dataset as { daily: string; row: string }\r\n        const row = this.rows[data.daily]![data.row]! as DailyRowAlert\r\n        const args = this.dailyArgs[data.daily]!\r\n\r\n        let fixed\r\n        try {\r\n            fixed = await row.fix(args)\r\n        } catch (error) {\r\n            localize.error('error.unexpected')\r\n            console.error(error)\r\n            console.error(`The error occured during an alert fix of '${data.daily}'`)\r\n        }\r\n\r\n        this.#unlock()\r\n        if (fixed) this.render()\r\n    }\r\n\r\n    async #onSearch(event: JQuery.ClickEvent<any, any, HTMLAnchorElement>) {\r\n        event.preventDefault()\r\n        const filter = await this.#getfilterFromElement(event.currentTarget, true)\r\n        if (filter) game.pf2e.compendiumBrowser.openTab(filter.type, filter.search)\r\n        else game.pf2e.compendiumBrowser.render(true)\r\n    }\r\n\r\n    async #getfilterFromElement(element: HTMLElement, parsed: true): Promise<DailyDropParsedFilter | void>\r\n    async #getfilterFromElement(element: HTMLElement, parsed?: false): Promise<DailyDropResultFilter | void>\r\n    async #getfilterFromElement(\r\n        element: HTMLElement,\r\n        parsed?: boolean\r\n    ): Promise<DailyDropResultFilter | DailyDropParsedFilter | void> {\r\n        const { daily, row } = element.dataset as { daily: string; row: string }\r\n        const filter = (this.rows[daily]?.[row] as DailyRowDrop | undefined)?.filter\r\n        const args = this.dailyArgs[daily]\r\n\r\n        if (!args || !filter) return\r\n\r\n        if (typeof filter.search === 'function') filter.search = await filter.search(args)\r\n\r\n        if (!parsed) return filter as DailyDropResultFilter\r\n\r\n        return parseFilter.call(this, filter)\r\n    }\r\n\r\n    #onComboSelectChange(event: JQuery.ChangeEvent) {\r\n        const select = event.currentTarget as HTMLSelectElement\r\n        const input = select.nextElementSibling as HTMLInputElement\r\n        input.dataset.input = 'false'\r\n        input.value = select.options[select.selectedIndex]!.text\r\n    }\r\n\r\n    #onComboInputChange(event: JQuery.ChangeEvent<any, any, HTMLInputElement>) {\r\n        const input = event.currentTarget\r\n        const select = input.previousElementSibling as HTMLSelectElement\r\n        const value = input.value.toLowerCase()\r\n        const options = Array.from(select.options).map(x => x.value)\r\n\r\n        const index = options.indexOf(value)\r\n        if (index !== -1) {\r\n            select.value = value\r\n            input.value = select.options[index]!.text\r\n            input.dataset.input = 'false'\r\n        } else {\r\n            select.value = ''\r\n            input.dataset.input = 'true'\r\n        }\r\n    }\r\n\r\n    #lock() {\r\n        this.element.addClass('disabled')\r\n    }\r\n\r\n    #unlock() {\r\n        this.element.removeClass('disabled')\r\n    }\r\n\r\n    #validate() {\r\n        const warns: string[] = []\r\n        const emptyInputs = this.element.find('input').filter((_, input) => !input.value)\r\n        const alertInputs = this.element.find('input.alert')\r\n\r\n        if (emptyInputs.length) warns.push('error.empty')\r\n        if (alertInputs.length) warns.push('error.unattended')\r\n\r\n        warns.forEach(x => localize.warn(x))\r\n\r\n        return !warns.length\r\n    }\r\n\r\n    async #onAccept(event: JQuery.ClickEvent) {\r\n        event.preventDefault()\r\n        if (!this.#validate()) return\r\n        this.#lock()\r\n        await processData.call(this)\r\n        this.close()\r\n    }\r\n\r\n    #onClear(event: JQuery.ClickEvent<any, any, HTMLAnchorElement>) {\r\n        event.preventDefault()\r\n        const target = $(event.currentTarget)\r\n        const input = target.prevAll('input').first()\r\n        input.val('')\r\n        input.attr('value', '')\r\n        input.attr('data-uuid', '')\r\n        target.addClass('disabled')\r\n    }\r\n\r\n    #onCancel(event: JQuery.ClickEvent) {\r\n        event.preventDefault()\r\n        this.close()\r\n    }\r\n}\r\n","import { MODULE_ID } from '@utils/module'\r\n\r\ntype OwnModule = 'anonymous' | 'idleuh' | 'pf2e-hero-actions'\r\n\r\ntype ReturnedModule<T extends Record<string, any> | unknown = unknown> = Module<T> | undefined\r\ntype ReturnedModuleApi<T extends Record<string, any>> = Module<T>['api'] | undefined\r\n\r\nexport function getModule<T extends Record<string, any> | unknown = unknown>(id: string | OwnModule) {\r\n    return game.modules.get(id) as ReturnedModule<T>\r\n}\r\n\r\nexport function getCurrentModule<T extends Record<string, any> | unknown = unknown>() {\r\n    return getModule(MODULE_ID) as Module<T>\r\n}\r\n\r\nexport function getModuleApi<T extends Record<string, any>>(id: string | OwnModule) {\r\n    return getModule<T>(id)?.api as ReturnedModuleApi<T>\r\n}\r\n","export const tome = [\r\n    '/** @typedef {typeof ROWS[number]} TomeRow */',\r\n    \"/** @typedef {'adept' | 'second' | 'intense' | 'paragon'} TomeChild */\",\r\n    '/** @typedef {Record<TomeRow, { rank: OneToFour; options: string[] }>} TomeCustom */',\r\n    '/** @typedef {[TomeRow, TomeCustom, TomeChild]} TomeGenerics */',\r\n    '',\r\n    \"const ROWS = /** @type {const} */ (['first', 'second'])\",\r\n    '',\r\n    \"/** @param {'adept' | 'paragon'} option */\",\r\n    'function createChildCondition(option) {',\r\n    '    /** @type { BaseDailyConditionFunction<TomeGenerics>} */',\r\n    '    const condition = ({ item, utils }) => {',\r\n    \"        return utils.getChoiSetRuleSelection(item, option) === 'tome'\",\r\n    '    }',\r\n    '    return condition',\r\n    '}',\r\n    '',\r\n    '/** @type {Daily<TomeGenerics>} */',\r\n    'const thaumaturgeTome = {',\r\n    \"    key: 'tome',\",\r\n    '    item: {',\r\n    \"        uuid: 'Compendium.pf2e.classfeatures.MyN1cQgE0HsLF20e', // Tome\",\r\n    '    },',\r\n    '    children: [',\r\n    '        {',\r\n    \"            slug: 'adept',\",\r\n    \"            uuid: 'Compendium.pf2e.classfeatures.Obm4ItMIIr0whYeO', // Implement Adept\",\r\n    \"            condition: createChildCondition('adept'),\",\r\n    '        },',\r\n    '        {',\r\n    \"            slug: 'second',\",\r\n    \"            uuid: 'Compendium.pf2e.classfeatures.ZEUxZ4Ta1kDPHiq5', // Second Adept\",\r\n    \"            condition: createChildCondition('adept'),\",\r\n    '        },',\r\n    '        {',\r\n    \"            slug: 'intense',\",\r\n    \"            uuid: 'Compendium.pf2e.feats-srd.yRRM1dsY6jakEMaC', // Intense Implement\",\r\n    '        },',\r\n    '        {',\r\n    \"            slug: 'paragon',\",\r\n    \"            uuid: 'Compendium.pf2e.classfeatures.QEtgbY8N2V4wTbsI', // Implement Paragon\",\r\n    \"            condition: createChildCondition('paragon'),\",\r\n    '        },',\r\n    '    ],',\r\n    '    prepare: ({ utils, actor, children }) => {',\r\n    '        const skillNames = utils.skillNames',\r\n    '        const actorLevel = actor.level',\r\n    '        const actorSkills = /** @type {Record<SkillLongForm, { rank: ZeroToFour }>} */ (actor.skills)',\r\n    '',\r\n    '        /** @type {TomeCustom} */',\r\n    '        const custom = {',\r\n    '            first: { options: [], rank: 1 },',\r\n    '            second: { options: [], rank: 1 },',\r\n    '        }',\r\n    '',\r\n    '        // Implement Paragon',\r\n    '        if (children.paragon) {',\r\n    '            const skills = skillNames.filter(x => actorSkills[x].rank < 4)',\r\n    '            custom.first = { rank: 4, options: skills }',\r\n    '            custom.second = { rank: 4, options: skills }',\r\n    '        }',\r\n    '        // Intense Implement or Second Adept or Implement Adept',\r\n    '        else if (children.intense || children.adept || children.second) {',\r\n    '            const masters = skillNames.filter(x => actorSkills[x].rank < 3)',\r\n    '',\r\n    '            if (actorLevel >= 9) {',\r\n    '                custom.first = { rank: 3, options: masters }',\r\n    '                custom.second = { rank: 3, options: masters }',\r\n    '            } else {',\r\n    '                const experts = skillNames.filter(x => actorSkills[x].rank < 2)',\r\n    '                custom.first = { rank: 2, options: experts }',\r\n    '                custom.second = { rank: 3, options: masters }',\r\n    '            }',\r\n    '        }',\r\n    '        // Tome',\r\n    '        else {',\r\n    '            if (actorLevel >= 5) {',\r\n    '                const experts = skillNames.filter(x => actorSkills[x].rank < 2)',\r\n    '                custom.first = { rank: 2, options: experts }',\r\n    '                custom.second = { rank: 2, options: experts }',\r\n    '            } else if (actorLevel >= 3) {',\r\n    '                const trained = skillNames.filter(x => actorSkills[x].rank < 1)',\r\n    '                const experts = skillNames.filter(x => actorSkills[x].rank < 2)',\r\n    '                custom.first = { rank: 1, options: trained }',\r\n    '                custom.second = { rank: 2, options: experts }',\r\n    '            } else {',\r\n    '                const trained = skillNames.filter(x => actorSkills[x].rank < 1)',\r\n    '                custom.first = { rank: 1, options: trained }',\r\n    '                custom.second = { rank: 1, options: trained }',\r\n    '            }',\r\n    '        }',\r\n    '',\r\n    '        return custom',\r\n    '    },',\r\n    '    rows: ROWS.map(rowName => {',\r\n    '        /** @type {DailyRowCombo<TomeGenerics>} */',\r\n    '        const row = {',\r\n    \"            type: 'combo',\",\r\n    '            slug: rowName,',\r\n    '            label: ({ custom, utils }) => utils.proficiencyLabel(custom[rowName].rank),',\r\n    '            options: ({ custom }) => custom[rowName].options,',\r\n    '            labelizer: ({ utils }) => utils.skillLabel,',\r\n    '        }',\r\n    '        return row',\r\n    '    }),',\r\n    '    process: ({ custom, fields, utils, messages, addItem, addRule }) => {',\r\n    \"        messages.addGroup('tome', 65)\",\r\n    '',\r\n    '        for (const rowName of ROWS) {',\r\n    '            const rank = custom[rowName].rank',\r\n    '            let value = fields[rowName].value',\r\n    '',\r\n    \"            if (fields[rowName].input === 'true') {\",\r\n    '                const source = utils.createLoreSource({ name: value, rank })',\r\n    '                addItem(source)',\r\n    '            } else {',\r\n    '                const source = utils.createSkillRuleElement({ skill: value, value: rank })',\r\n    '                value = utils.skillLabel(value)',\r\n    '                addRule(source)',\r\n    '            }',\r\n    '',\r\n    \"            messages.add('tome', { label: utils.proficiencyLabel(rank), selected: value })\",\r\n    '        }',\r\n    '    },',\r\n    '}',\r\n    '',\r\n    'return thaumaturgeTome',\r\n].join('\\n')\r\n","export const flexibility = [\r\n    \"/** @typedef {'flexibility' | 'improved'} FlexibilityRow */\",\r\n    \"/** @typedef {'improved'} FlexibilityChild */\",\r\n    '/** @typedef {[FlexibilityRow, {}, FlexibilityChild]} FlexibilityGenerics */',\r\n    '',\r\n    '/**',\r\n    ' * @param {FlexibilityRow} slug',\r\n    ' * @param {number} level',\r\n    ' * @param {FlexibilityChild} [child]',\r\n    ' */',\r\n    'function createRow(slug, level, child) {',\r\n    '    /** @type {DailyRowDrop<FlexibilityGenerics>} */',\r\n    '    const row = {',\r\n    \"        type: 'drop',\",\r\n    '        label: `PF2E.Level${level}`,',\r\n    '        slug,',\r\n    '        filter: {',\r\n    \"            type: 'feat',\",\r\n    '            search: {',\r\n    \"                category: ['class'],\",\r\n    '                traits: {',\r\n    \"                    values: ['fighter'],\",\r\n    '                },',\r\n    '                level,',\r\n    '            },',\r\n    '        },',\r\n    '    }',\r\n    '    if (child) row.childPredicate = [child]',\r\n    '    return row',\r\n    '}',\r\n    '',\r\n    '/** @type {Daily<FlexibilityGenerics>} */',\r\n    'const combatFlexibility = {',\r\n    \"    key: 'flexibility',\",\r\n    '    item: {',\r\n    \"        uuid: 'Compendium.pf2e.classfeatures.8g6HzARbhfcgilP8', // Combat Flexibility\",\r\n    '    },',\r\n    '    children: [',\r\n    '        {',\r\n    \"            slug: 'improved',\",\r\n    \"            uuid: 'Compendium.pf2e.classfeatures.W2rwudMNcAxs8VoX', // Improved Flexibility\",\r\n    '        },',\r\n    '    ],',\r\n    '    rows: [',\r\n    \"        createRow('flexibility', 8), //\",\r\n    \"        createRow('improved', 14, 'improved'),\",\r\n    '    ],',\r\n    '    process: async ({ utils, fields, addFeat, messages, children }) => {',\r\n    '        const uuid = fields.flexibility.uuid',\r\n    '        const source = await utils.createFeatSource(uuid)',\r\n    '        addFeat(source)',\r\n    \"        messages.add('feats', { uuid })\",\r\n    '',\r\n    '        if (children.improved) {',\r\n    '            const uuid = fields.improved.uuid',\r\n    '            const source = await utils.createFeatSource(uuid)',\r\n    '            addFeat(source, children.improved)',\r\n    \"            messages.add('feats', { uuid })\",\r\n    '        }',\r\n    '    },',\r\n    '}',\r\n    '',\r\n    'return combatFlexibility',\r\n].join('\\n')\r\n","export const savant = [\r\n    \"/** @typedef {'first' | 'second' | 'third' | 'fourth'} SavantRow */\",\r\n    '/** @typedef {Record<SavantRow, { level: number; condition: boolean }>} SavantCustom */',\r\n    \"/** @typedef {[SavantRow, SavantCustom, '']} SavantGenerics */\",\r\n    '',\r\n    \"const ROWS = /** @type {const} */ (['first', 'second', 'third', 'fourth'])\",\r\n    '',\r\n    '/**',\r\n    ' * @param {CharacterPF2e} actor',\r\n    ' * @param {MagicTradition} tradition',\r\n    ' */',\r\n    'function getSpellcastingTraditionDetails(actor, tradition) {',\r\n    '    let maxSlot = 1',\r\n    '    let maxTradition = 0',\r\n    '',\r\n    '    for (const entry of actor.spellcasting) {',\r\n    \"        if ('pf2e-staves' in entry.flags) continue // we skip staff entries\",\r\n    '',\r\n    '        const slots = entry.system.slots',\r\n    '        for (const key in slots) {',\r\n    '            const slot = slots[key]',\r\n    '            if (slot.max) maxSlot = Math.max(maxSlot, Number(key.slice(4)))',\r\n    '        }',\r\n    '',\r\n    '        if (entry.tradition === tradition) maxTradition = Math.max(maxTradition, entry.rank)',\r\n    '    }',\r\n    '',\r\n    '    return { maxSlot: Math.min(maxSlot, 10), maxTradition }',\r\n    '}',\r\n    '',\r\n    '/** @type {Daily<SavantGenerics>} */',\r\n    'const scrollSavant = {',\r\n    \"    key: 'savant',\",\r\n    '    item: {',\r\n    \"        uuid: 'Compendium.pf2e.feats-srd.u5DBg0LrBUKP0JsJ', // Scroll Savant\",\r\n    '    },',\r\n    '    prepare: ({ actor }) => {',\r\n    \"        const { maxSlot, maxTradition } = getSpellcastingTraditionDetails(actor, 'arcane')\",\r\n    '        return {',\r\n    '            first: { level: maxSlot - 2, condition: true },',\r\n    '            second: { level: maxSlot - 3, condition: true },',\r\n    '            third: { level: maxSlot - 4, condition: maxTradition >= 3 && maxSlot >= 5 },',\r\n    '            fourth: { level: maxSlot - 5, condition: maxTradition >= 4 && maxSlot >= 6 },',\r\n    '        }',\r\n    '    },',\r\n    '    rows: ROWS.map(rowName => {',\r\n    '        /** @type {DailyRowDrop<SavantGenerics>} */',\r\n    '        const row = {',\r\n    \"            type: 'drop',\",\r\n    '            slug: rowName,',\r\n    '            label: ({ custom }) => `PF2E.SpellLevel${custom[rowName].level}`,',\r\n    '            filter: {',\r\n    \"                type: 'spell',\",\r\n    '                search: ({ custom }) => ({',\r\n    \"                    category: ['spell'],\",\r\n    \"                    traditions: ['arcane'],\",\r\n    '                    level: custom[rowName].level,',\r\n    '                }),',\r\n    '            },',\r\n    '            condition: ({ custom }) => custom[rowName].condition,',\r\n    '        }',\r\n    '        return row',\r\n    '    }),',\r\n    '    process: async ({ utils, fields, custom, addItem, messages }) => {',\r\n    '        for (const field of Object.values(fields)) {',\r\n    '            const uuid = field.uuid',\r\n    '            const source = await utils.createSpellScrollSource({ uuid, level: custom[field.row].level })',\r\n    '            addItem(source)',\r\n    \"            messages.add('scrolls', { uuid, label: source.name })\",\r\n    '        }',\r\n    '    },',\r\n    '}',\r\n    '',\r\n    'return scrollSavant',\r\n].join('\\n')\r\n","export const mind = [\r\n    \"/** @typedef {'alert' | 'smith' | 'mental' | 'runic' | 'advanced'} MindRow */\",\r\n    \"/** @typedef {'weapon' | 'mental' | 'runic' | 'advanced'} MindChild */\",\r\n    '/** @typedef {[MindRow, {}, MindChild]} MindGenerics */',\r\n    '',\r\n    \"const MIND_WEAPON_UUID = 'Compendium.pf2e-dailies.equipment.VpmEozw21aRxX15P'\",\r\n    '',\r\n    'const WEAPON_BASE_TYPES = {',\r\n    \"    0: { die: 'd4', traits: ['finesse', 'agile'], usage: 'held-in-one-hand' },\",\r\n    \"    1: { die: 'd6', traits: ['finesse'], usage: 'held-in-one-hand' },\",\r\n    \"    2: { die: 'd8', traits: [], usage: 'held-in-one-hand' },\",\r\n    \"    3: { die: 'd10', traits: ['reach'], usage: 'held-in-two-hands' },\",\r\n    '}',\r\n    '',\r\n    'const WEAPON_GROUPS = /** @type {Record<WeaponDamage, string>} */ {',\r\n    \"    slashing: 'sword',\",\r\n    \"    piercing: 'spear',\",\r\n    \"    bludgeoning: 'club',\",\r\n    '}',\r\n    '',\r\n    \"const WEAPON_TRAITS = ['grapple', 'nonlethal', 'shove', 'trip', 'modular']\",\r\n    '',\r\n    'const WEAPON_DAMAGE_TYPES = Object.keys(WEAPON_GROUPS)',\r\n    '',\r\n    \"const WEAPON_RUNES = ['corrosive', 'disrupting', 'flaming', 'frost', 'shock', 'thundering']\",\r\n    '',\r\n    'const WEAPON_GREATER_RUNES = [',\r\n    \"    'anarchic',\",\r\n    \"    'axiomatic',\",\r\n    \"    'greaterCorrosive',\",\r\n    \"    'greaterDisrupting',\",\r\n    \"    'greaterFlaming',\",\r\n    \"    'greaterFrost',\",\r\n    \"    'greaterShock',\",\r\n    \"    'greaterThundering',\",\r\n    \"    'holy',\",\r\n    \"    'unholy',\",\r\n    ']',\r\n    '',\r\n    '/** @type {Daily<MindGenerics>} */',\r\n    'const mindSmith = {',\r\n    \"    key: 'mindsmith',\",\r\n    '    item: {',\r\n    \"        uuid: 'Compendium.pf2e.feats-srd.juikoiIA0Jy8PboY', // Mind Smith Dedication\",\r\n    '    },',\r\n    '    children: [',\r\n    '        {',\r\n    \"            slug: 'weapon',\",\r\n    '            uuid: MIND_WEAPON_UUID, // Mind Weapon',\r\n    '        },',\r\n    '        {',\r\n    \"            slug: 'mental',\",\r\n    \"            uuid: 'Compendium.pf2e.feats-srd.PccekOihIbRWdDky', // Malleable Mental Forge\",\r\n    '        },',\r\n    '        {',\r\n    \"            slug: 'runic',\",\r\n    \"            uuid: 'Compendium.pf2e.feats-srd.2uQbQgz1AbjzcFSp', // Runic Mind Smithing\",\r\n    '        },',\r\n    '        {',\r\n    \"            slug: 'advanced',\",\r\n    \"            uuid: 'Compendium.pf2e.feats-srd.fgnfXwFcn9jZlXGD', // Advanced Runic Mind Smithing\",\r\n    '        },',\r\n    '    ],',\r\n    '    rows: [',\r\n    '        {',\r\n    \"            type: 'alert',\",\r\n    \"            slug: 'alert',\",\r\n    \"            message: 'Missing Mind Weapon',\",\r\n    '            fix,',\r\n    \"            childPredicate: [{ not: 'weapon' }],\",\r\n    '        },',\r\n    '        {',\r\n    \"            type: 'select',\",\r\n    \"            slug: 'smith',\",\r\n    \"            label: 'Mind Smith',\",\r\n    '            options: WEAPON_DAMAGE_TYPES,',\r\n    '            labelizer: ({ utils }) => utils.damageLabel,',\r\n    \"            childPredicate: ['weapon'],\",\r\n    '        },',\r\n    '        {',\r\n    \"            type: 'select',\",\r\n    \"            slug: 'mental',\",\r\n    \"            label: 'Mental Forge',\",\r\n    '            options: WEAPON_TRAITS,',\r\n    '            labelizer: ({ utils }) => utils.weaponTraitLabel,',\r\n    \"            childPredicate: ['weapon', 'mental'],\",\r\n    '        },',\r\n    '        {',\r\n    \"            type: 'select',\",\r\n    \"            slug: 'runic',\",\r\n    \"            label: 'Runic Smithing',\",\r\n    '            options: WEAPON_RUNES,',\r\n    '            labelizer: ({ utils }) => utils.weaponPropertyRunesLabel,',\r\n    \"            childPredicate: ['weapon', 'runic', { not: 'advanced' }],\",\r\n    '            condition: ({ children, utils }) => utils.hasFreePropertySlot(children.weapon),',\r\n    '        },',\r\n    '        {',\r\n    \"            type: 'select',\",\r\n    \"            slug: 'advanced',\",\r\n    \"            label: 'Runic Smithing',\",\r\n    '            options: WEAPON_GREATER_RUNES,',\r\n    '            labelizer: ({ utils }) => utils.weaponPropertyRunesLabel,',\r\n    \"            childPredicate: ['weapon', 'advanced'],\",\r\n    '            condition: ({ children, utils }) => utils.hasFreePropertySlot(children.weapon),',\r\n    '        },',\r\n    '    ],',\r\n    '    process: ({ children, updateItem, fields, messages, item, utils }) => {',\r\n    '        const weapon = children.weapon',\r\n    '        if (!weapon) return',\r\n    '',\r\n    \"        messages.addGroup('mindsmith')\",\r\n    '',\r\n    '        const selected = /** @type {WeaponDamage} */ fields.smith.value',\r\n    \"        updateItem({ _id: weapon.id, 'system.damage.damageType': selected, 'system.group': WEAPON_GROUPS[selected] })\",\r\n    \"        messages.add('mindsmith', { selected: utils.damageLabel(selected), uuid: item.uuid, label: 'mindsmith' })\",\r\n    '',\r\n    '        if (children.mental) {',\r\n    '            const selected = fields.mental.value',\r\n    '            const traits = deepClone(weapon._source.system.traits?.value ?? [])',\r\n    '            if (!traits.includes(selected)) traits.push(selected)',\r\n    \"            updateItem({ _id: weapon.id, 'system.traits.value': traits })\",\r\n    \"            messages.add('mindsmith', {\",\r\n    '                selected: utils.weaponTraitLabel(selected),',\r\n    '                uuid: children.mental.uuid,',\r\n    \"                label: 'mentalforge',\",\r\n    '            })',\r\n    '        }',\r\n    '',\r\n    '        if ((children.advanced || children.runic) && utils.hasFreePropertySlot(weapon)) {',\r\n    '            const child = children.advanced ?? children.runic',\r\n    '            const freeSlot = utils.getFreePropertyRuneSlot(weapon)',\r\n    '            const field = fields.advanced ?? fields.runic',\r\n    '            const selected = field.value',\r\n    '',\r\n    '            if (!weapon.system.runes.property.includes(selected)) {',\r\n    '                updateItem({ _id: weapon.id, [`system.${freeSlot}.value`]: selected, [`flags.world.runeSlot`]: freeSlot })',\r\n    \"                messages.add('mindsmith', {\",\r\n    '                    selected: utils.weaponPropertyRunesLabel(selected),',\r\n    '                    uuid: child.uuid,',\r\n    \"                    label: 'runicmind',\",\r\n    '                })',\r\n    '            }',\r\n    '        }',\r\n    '    },',\r\n    '    rest: ({ item, sourceId, updateItem }) => {',\r\n    '        if (sourceId !== MIND_WEAPON_UUID) return',\r\n    '',\r\n    '        let traits = item._source.system.traits?.value ?? []',\r\n    '        traits = traits.filter(trait => !WEAPON_TRAITS.includes(trait))',\r\n    \"        updateItem({ _id: item.id, 'system.traits.value': traits })\",\r\n    '',\r\n    \"        const runeSlot = item.getFlag('world', 'runeSlot')\",\r\n    '        if (runeSlot) {',\r\n    '            updateItem({ _id: item.id, [`system.${runeSlot}.value`]: null, [`flags.world.-=runeSlot`]: true })',\r\n    '        }',\r\n    '    },',\r\n    '}',\r\n    '',\r\n    'const OPTIONS = {',\r\n    \"    0: 'A one-handed weapon that deals <strong>1d4</strong> damage and has the <strong>agile</strong> and <strong>finesse</strong> traits',\",\r\n    \"    1: 'A one-handed weapon that deals <strong>1d6</strong> damage and has the <strong>finesse</strong> trait',\",\r\n    \"    2: 'A one-handed weapon that deals <strong>1d8</strong> damage',\",\r\n    \"    3: 'A two-handed weapon that deals <strong>1d10</strong> damage and has the <strong>reach</strong> trait',\",\r\n    '}',\r\n    '',\r\n    '/** * @param {DailyValueArgs<MindGenerics>} args */',\r\n    'async function fix({ actor }) {',\r\n    '    let content =',\r\n    \"        `<p>This character doesn't have a mind weapon in their inventory.</p><p>Please select one of the following options to create one.</p>`\",\r\n    '',\r\n    '    for (const [key, label] of Object.entries(OPTIONS)) {',\r\n    \"        content += `<label><input type='radio' name='type' value='${key}'>${label}</label>`\",\r\n    '    }',\r\n    '',\r\n    '    const weapon = await Dialog.wait(',\r\n    '        {',\r\n    \"            title: 'Mind Weapon',\",\r\n    '            content,',\r\n    '            buttons: {',\r\n    '                yes: {',\r\n    \"                    icon: `<i class='fas fa-save'></i>`,\",\r\n    \"                    label: 'Accept',\",\r\n    '                    callback: onWeaponSelected,',\r\n    '                },',\r\n    '                no: {',\r\n    \"                    icon: `<i class='fas fa-times'></i>`,\",\r\n    \"                    label: 'Cancel',\",\r\n    '                    callback: () => null,',\r\n    '                },',\r\n    '            },',\r\n    '            close: () => null,',\r\n    '        },',\r\n    '        {},',\r\n    \"        { id: 'pf2e-dailies-weapon', width: 600 }\",\r\n    '    )',\r\n    '',\r\n    '    if (weapon) {',\r\n    \"        await actor.createEmbeddedDocuments('Item', [weapon])\",\r\n    '        return true',\r\n    '    }',\r\n    '',\r\n    '    return false',\r\n    '}',\r\n    '',\r\n    '/** @params {JQuery} html */',\r\n    'async function onWeaponSelected(html) {',\r\n    \"    const selection = html.find('[name=type]:checked').val()\",\r\n    '    if (!selection) {',\r\n    \"        ui.notifications.warn('You must select one weapon base type.')\",\r\n    '        return',\r\n    '    }',\r\n    '',\r\n    '    const weapon = (await fromUuid(MIND_WEAPON_UUID))?.toObject()',\r\n    '    if (!weapon) {',\r\n    \"        ui.notifications.warn(`The weapon couldn't be found in the compendium.`)\",\r\n    '        return',\r\n    '    }',\r\n    '',\r\n    '    const stats = WEAPON_BASE_TYPES[selection]',\r\n    '',\r\n    \"    setProperty(weapon, 'system.damage.die', stats.die)\",\r\n    \"    setProperty(weapon, 'system.traits.value', stats.traits.slice())\",\r\n    \"    setProperty(weapon, 'system.usage.value', stats.usage)\",\r\n    '',\r\n    '    return weapon',\r\n    '}',\r\n    '',\r\n    'return mindSmith',\r\n].join('\\n')\r\n","import { createFeatDaily } from '@src/data/feat'\r\nimport { createLanguageDaily } from '@src/data/language'\r\nimport { createResistancelDaily } from '@src/data/resistance'\r\nimport { createTrainedLoreDaily, createTrainedSkillDaily } from '@src/data/skill'\r\nimport { createSpellDaily } from '@src/data/spell'\r\nimport { subLocalize } from '@utils/foundry/localize'\r\nimport { templatePath } from '@utils/foundry/path'\r\nimport { getSetting, setSetting } from '@utils/foundry/settings'\r\nimport { getModule } from '@utils/foundry/module'\r\nimport { AsyncFunction } from '@utils/function'\r\nimport { error, warn } from '@utils/foundry/notification'\r\nimport { tome } from './customs/tome'\r\nimport { flexibility } from './customs/flexibility'\r\nimport { savant } from './customs/savant'\r\nimport { mind } from './customs/mind'\r\nimport { EXT_VERSION } from '@src/main'\r\n\r\nconst localize = subLocalize('customs')\r\n\r\ntype DailyExampleType = 'tome' | 'flexibility' | 'savant' | 'mind'\r\ntype DailyTemplateType = 'default' | 'trainedSkill' | 'trainedLore' | 'language' | 'resistance' | 'feat' | 'spell'\r\ntype DailyData = {\r\n    key: string\r\n    uuid: ItemUUID\r\n    label: string\r\n    resistances: string\r\n    resistance: string\r\n    traits: string\r\n    level: string\r\n    category: string\r\n    traditions: string\r\n    levels: string\r\n}\r\n\r\nconst TEMPLATES = ['default', 'trainedSkill', 'trainedLore', 'language', 'resistance', 'feat', 'spell']\r\nconst EXAMPLES = ['flexibility', 'savant', 'tome', 'mind']\r\n\r\nexport class DailyCustoms extends FormApplication {\r\n    private _selectedTemplate: DailyTemplateType | DailyExampleType = 'default'\r\n    private _selectedDaily: string = ''\r\n    private _monaco: any | null = null\r\n\r\n    constructor() {\r\n        super()\r\n    }\r\n\r\n    static get defaultOptions(): FormApplicationOptions {\r\n        return mergeObject(super.defaultOptions, {\r\n            id: 'pf2e-dailies-customs',\r\n            title: localize('title'),\r\n            template: templatePath('customs.hbs'),\r\n            submitOnChange: false,\r\n            submitOnClose: false,\r\n            closeOnSubmit: false,\r\n            scrollY: ['.left .list'],\r\n        })\r\n    }\r\n\r\n    async _updateObject(event: Event, formData: Record<string, unknown>) {}\r\n\r\n    async getData(options?: Partial<FormApplicationOptions> | undefined) {\r\n        const customs = getSetting<SavedCustomDaily[]>('customDailies')\r\n        const code = customs.find(custom => custom.key === this._selectedDaily)?.code\r\n        const template = this._selectedTemplate\r\n        const extension = getModule<PF2eDailiesExtApi>('pf2e-dailies-ext')\r\n        const newVersion = extension?.active && isNewerVersion(EXT_VERSION, extension.version) ? { version: EXT_VERSION } : ''\r\n\r\n        return mergeObject(super.getData(options), {\r\n            i18n: localize,\r\n            template,\r\n            templates: TEMPLATES,\r\n            daily: this._selectedDaily,\r\n            code,\r\n            customs,\r\n            examples: EXAMPLES,\r\n            isExample: EXAMPLES.includes(template),\r\n            monaco: extension?.active,\r\n            newVersion,\r\n        })\r\n    }\r\n\r\n    activateListeners(html: JQuery<HTMLElement>) {\r\n        super.activateListeners(html)\r\n\r\n        this._monaco?.dispose()\r\n\r\n        const monaco = getModule<PF2eDailiesExtApi>('pf2e-dailies-ext')?.api\r\n        const area = html.find<HTMLTextAreaElement>('.code')[0]\r\n        if (monaco && area) {\r\n            const element = html.find('.monaco .placeholder')[0]!\r\n            this._monaco = monaco.createEditor(element, area.value)\r\n            this._monaco.onDidChangeModelContent(debounce(() => (area.value = this._monaco.getValue()), 200))\r\n        } else {\r\n            this._monaco = null\r\n        }\r\n\r\n        html.find<HTMLSelectElement>('[data-action=select-template]').on('change', this.#onSelectTemplate.bind(this))\r\n        html.find('[data-action=create-template]').on('click', this.#onCreateTemplate.bind(this))\r\n        html.find('[data-action=create-daily]').on('click', this.#onCreateDaily.bind(this))\r\n\r\n        html.find('.row[data-key]').on('click', this.#onSelectDaily.bind(this))\r\n        html.find('[data-action=delete-daily]').on('click', this.#onDeleteDaily.bind(this))\r\n\r\n        html.find('[data-action=save-code]').on('click', this.#onSaveCode.bind(this))\r\n    }\r\n\r\n    get code() {\r\n        const element = this.form.querySelector<HTMLTextAreaElement>('.window-content .code')\r\n        return element?.value\r\n    }\r\n\r\n    async #onSaveCode(event: JQuery.ClickEvent) {\r\n        event.preventDefault()\r\n\r\n        const code = this.code\r\n        const selected = this._selectedDaily\r\n\r\n        if (!selected || !code) return\r\n\r\n        const customs = getSetting<SavedCustomDaily[]>('customDailies')\r\n        const stipped = customs.filter(custom => custom.key !== selected)\r\n\r\n        try {\r\n            const fn = new AsyncFunction(code)\r\n            const daily = await fn()\r\n            const key = daily.key\r\n\r\n            if (typeof key !== 'string') return warn('invalidKey')\r\n            if (stipped.find(custom => custom.key === key)) return warn('duplicate')\r\n\r\n            const index = customs.findIndex(custom => custom.key === selected)\r\n            if (index < 0) return\r\n\r\n            customs.splice(index, 1, { key, code })\r\n            await setSetting('customDailies', customs)\r\n\r\n            localize.info('saved', { daily: key })\r\n            this._selectedDaily = key\r\n            this.render()\r\n        } catch (err) {\r\n            error('error.unexpected')\r\n            console.error(err)\r\n            console.error(`The error occured while testing the custom daily ${selected}`)\r\n        }\r\n    }\r\n\r\n    async #onDeleteDaily(event: JQuery.ClickEvent) {\r\n        event.preventDefault()\r\n        event.stopPropagation()\r\n\r\n        const remove = await Dialog.confirm({\r\n            title: localize('delete.title'),\r\n            content: localize('delete.content'),\r\n        })\r\n\r\n        if (!remove) return\r\n\r\n        const key = event.currentTarget.dataset.key as string\r\n        const customs = getSetting<SavedCustomDaily[]>('customDailies').filter(custom => custom.key !== key)\r\n\r\n        await setSetting('customDailies', customs)\r\n        localize.info('deleted', { daily: key })\r\n        this.#onCreateDaily()\r\n    }\r\n\r\n    #onCreateDaily() {\r\n        this._selectedDaily = ''\r\n        this._selectedTemplate = 'default'\r\n        this.render()\r\n    }\r\n\r\n    #onSelectDaily(event: JQuery.ClickEvent) {\r\n        event.preventDefault()\r\n\r\n        this._selectedDaily = event.currentTarget.dataset.key\r\n        this.render()\r\n    }\r\n\r\n    async #onCreateTemplate(event: JQuery.ClickEvent) {\r\n        event.preventDefault()\r\n        const template = this._selectedTemplate\r\n\r\n        const customs = getSetting<SavedCustomDaily[]>('customDailies')\r\n        const formData = new FormData(this.form)\r\n        const data = Object.fromEntries(formData) as DailyData\r\n        const isExample = EXAMPLES.includes(template)\r\n        let { key, uuid, label } = data\r\n\r\n        if (isExample) {\r\n            key = template\r\n        } else if (!key || !uuid) {\r\n            return localize.warn('template.noEmpty')\r\n        }\r\n\r\n        if (customs.find(custom => custom.key === key)) return warn('error.duplicate')\r\n\r\n        let code\r\n\r\n        if (template === 'trainedSkill') {\r\n            const daily = createTrainedSkillDaily(key, uuid, label)\r\n            code = this.#stringifyDaily(daily, { key, uuid, label }, 'SkillGenerics')\r\n        } else if (template === 'trainedLore') {\r\n            const daily = createTrainedLoreDaily(key, uuid, label)\r\n            code = this.#stringifyDaily(daily, { key, uuid, label }, 'SkillGenerics')\r\n        } else if (template === 'language') {\r\n            const daily = createLanguageDaily(key, uuid, label)\r\n            code = this.#stringifyDaily(daily, { key, uuid, label }, 'LanguageGenerics')\r\n        } else if (template === 'resistance') {\r\n            const resistance = simplyfiable(data.resistance)\r\n            const resistances = splitList(data.resistances)\r\n\r\n            if (resistance === '' || !resistances.length) return localize.warn('template.noEmpty')\r\n            if (typeof resistance === 'number' && resistance < 1) return localize.warn('template.badResistance')\r\n\r\n            const daily = createResistancelDaily(key, uuid, resistances, resistance, label)\r\n            code = this.#stringifyDaily(daily, { key, uuid, label, resistance, resistances }, 'ResistanceGenerics')\r\n        } else if (template === 'feat') {\r\n            const traits = splitList<FeatTrait>(data.traits)\r\n            const filter: DailyFeatFilter = {\r\n                category: splitList<FeatCategory>(data.category),\r\n                level: simplyfiable(data.level) || { min: 0, max: 20 },\r\n            }\r\n            if (traits.length) filter.traits = traits\r\n            const daily = createFeatDaily(key, uuid, filter, label)\r\n            code = this.#stringifyDaily(daily, { key, uuid, label }, 'FeatGenerics')\r\n        } else if (template === 'spell') {\r\n            const level = Number(data.level) || undefined\r\n            const traits = splitList<SpellTrait>(data.traits)\r\n            let levels: (DailySimplifiableValue | string)[] | DailySimplifiableValue = data.levels.split(',').map(x => x.trim())\r\n            if (levels.length === 1) {\r\n                levels = simplyfiable(levels[0]!) as DailySimplifiableValue\r\n            } else {\r\n                levels = levels\r\n                    .filter(x => x)\r\n                    .map(x => Number(x))\r\n                    .filter(x => !isNaN(x)) as number[]\r\n            }\r\n            const filter: DailySpellFilter = {\r\n                category: splitList(data.category),\r\n                traditions: splitList(data.traditions),\r\n                level: (levels || []) as DailySimplifiableValue | number[],\r\n            }\r\n            if (traits.length) filter.traits = traits\r\n            const daily = createSpellDaily(key, uuid, filter, level, label)\r\n            code = this.#stringifyDaily(daily, { key, uuid, label, level }, 'SpellGenerics')\r\n        } else if (template === 'tome') {\r\n            code = tome\r\n        } else if (template === 'flexibility') {\r\n            code = flexibility\r\n        } else if (template === 'savant') {\r\n            code = savant\r\n        } else if (template === 'mind') {\r\n            code = mind\r\n        } else {\r\n            const daily = { key, label, item: { uuid }, rows: [], process: () => {} }\r\n            code = this.#stringifyDaily(daily, { key, uuid, label })\r\n        }\r\n\r\n        customs.push({ key, code })\r\n        await setSetting('customDailies', customs)\r\n\r\n        this._selectedDaily = key\r\n        this.render()\r\n    }\r\n\r\n    #stringifyDaily(daily: Record<string, any>, args: Record<string, any>, type?: string) {\r\n        const placeholder = '____PLACEHOLDER____'\r\n        const fns: Function[] = []\r\n\r\n        let str = JSON.stringify(\r\n            daily,\r\n            (_, value) => {\r\n                if (typeof value === 'function') {\r\n                    fns.push(value)\r\n                    return placeholder\r\n                }\r\n                return value\r\n            },\r\n            4\r\n        )\r\n\r\n        str = str.replace(new RegExp('\"' + placeholder + '\"', 'g'), () => {\r\n            const fn = fns.shift()?.toString()\r\n            return fn?.replace(/( {5,})/g, match => match.slice(4)) ?? ''\r\n        })\r\n\r\n        let strArgs = ''\r\n        for (const [key, value] of Object.entries(args)) {\r\n            if (typeof value === 'string') strArgs += `const ${key} = '${value}';\\n`\r\n            else if (typeof value === 'object') strArgs += `const ${key} = ${JSON.stringify(value)};\\n`\r\n            else strArgs += `const ${key} = ${value};\\n`\r\n        }\r\n\r\n        const typing = type ? `Daily<${type}>` : 'Daily'\r\n        return `${strArgs}\\n/** @type {${typing}} */\\nconst daily = ${str};\\n\\nreturn daily;`\r\n    }\r\n\r\n    #onSelectTemplate(event: JQuery.ChangeEvent<any, any, HTMLSelectElement>) {\r\n        event.preventDefault()\r\n\r\n        this._selectedDaily = ''\r\n        this._selectedTemplate = event.currentTarget.value as DailyTemplateType\r\n\r\n        this.render()\r\n    }\r\n}\r\n\r\nfunction splitList<T extends string>(list: string) {\r\n    return list\r\n        .split(',')\r\n        .map(x => x.trim())\r\n        .filter(x => x) as T[]\r\n}\r\n\r\nfunction simplyfiable(value: string | number) {\r\n    if (typeof value === 'number') return value\r\n    value = value.trim()\r\n    if (value === 'level' || value === 'half') return value\r\n    const numbered = Number(value)\r\n    return isNaN(numbered) ? '' : numbered\r\n}\r\n","import { setModuleID } from '@utils/module'\r\nimport { registerSetting, registerSettingMenu } from '@utils/foundry/settings'\r\nimport { parseCustomDailies } from './dailies'\r\nimport { restForTheNight } from './rest'\r\nimport { renderCharacterSheetPF2e } from './sheet'\r\nimport { DailyCustoms } from '@apps/customs'\r\nimport { registerWrapper } from '@utils/libwrapper'\r\nimport { warn } from '@utils/foundry/notification'\r\n\r\nexport const MODULE_ID = 'pf2e-dailies'\r\nsetModuleID(MODULE_ID)\r\n\r\nexport const EXT_VERSION = '1.3.0'\r\n\r\nHooks.on('pf2e.restForTheNight', restForTheNight)\r\n\r\nHooks.on('renderCharacterSheetPF2e', renderCharacterSheetPF2e)\r\n\r\nHooks.once('setup', () => {\r\n    registerSetting({\r\n        name: 'customDailies',\r\n        type: Array,\r\n        default: [],\r\n        onChange: parseCustomDailies,\r\n    })\r\n\r\n    registerSetting({\r\n        name: 'familiar',\r\n        type: String,\r\n        default: '',\r\n        config: true,\r\n    })\r\n\r\n    registerSettingMenu({\r\n        name: 'customs',\r\n        type: DailyCustoms,\r\n    })\r\n})\r\n\r\nHooks.once('ready', async () => {\r\n    await parseCustomDailies()\r\n\r\n    if (!game.modules.get('lib-wrapper')?.active && game.user.isGM) {\r\n        warn('error.noLibwrapper', true)\r\n        return\r\n    }\r\n\r\n    registerWrapper(\r\n        'CONFIG.PF2E.Actor.documentClasses.character.prototype.performDailyCrafting',\r\n        onPerformDailyCrafting,\r\n        'OVERRIDE'\r\n    )\r\n})\r\n\r\nasync function onPerformDailyCrafting(this: CharacterPF2e) {\r\n    const entries = (await this.getCraftingEntries()).filter(e => e.isDailyPrep)\r\n    const alchemicalEntries = entries.filter(e => e.isAlchemical)\r\n    const reagentCost = alchemicalEntries.reduce((sum, entry) => sum + entry.reagentCost, 0)\r\n    const reagentValue = (this.system.resources.crafting.infusedReagents.value || 0) - reagentCost\r\n\r\n    if (reagentValue < 0) {\r\n        ui.notifications.warn(game.i18n.localize('PF2E.CraftingTab.Alerts.MissingReagents'))\r\n        return\r\n    } else {\r\n        await this.update({ 'system.resources.crafting.infusedReagents.value': reagentValue })\r\n    }\r\n\r\n    for (const entry of entries) {\r\n        for (const formula of entry.preparedCraftingFormulas) {\r\n            const itemSource: PhysicalItemSource = formula.item.toObject()\r\n            itemSource.system.quantity = formula.quantity\r\n            itemSource.system.temporary = true\r\n            itemSource.system.size = this.ancestry?.size === 'tiny' ? 'tiny' : 'med'\r\n\r\n            if (\r\n                entry.isAlchemical &&\r\n                (itemSource.type === 'consumable' || itemSource.type === 'weapon' || itemSource.type === 'equipment')\r\n            ) {\r\n                itemSource.system.traits.value.push('infused')\r\n            }\r\n            await this.addToInventory(itemSource)\r\n        }\r\n    }\r\n}\r\n","import { getFlag, getSourceId, setFlag } from '@utils/foundry/flags'\r\nimport { sluggify } from '@utils/pf2e/utils'\r\nimport { getDailyFromSourceId } from './dailies'\r\nimport { MODULE_ID } from './main'\r\n\r\nexport async function restForTheNight(actor: CharacterPF2e) {\r\n    const update: EmbeddedDocumentUpdateData<ItemPF2e>[] = []\r\n    const remove: string[] = []\r\n\r\n    for (const item of actor.items) {\r\n        if (getFlag(item, 'temporary')) {\r\n            remove.push(item.id)\r\n\r\n            // we remove the itemGrants flag from the parent feat\r\n            if (item.isOfType('feat')) {\r\n                const parentId = getFlag<string>(item, 'grantedBy')\r\n                if (parentId) {\r\n                    const slug = sluggify(item.name, { camel: 'dromedary' })\r\n                    const path = `flags.pf2e.itemGrants.-=${slug}`\r\n                    update.push({ _id: parentId, [path]: true })\r\n                }\r\n            }\r\n\r\n            // we don't need to do more work because the item is being deleted\r\n            continue\r\n        }\r\n\r\n        const sourceId = getSourceId(item)\r\n\r\n        // We run the daily rest function if it exists\r\n        if (sourceId) {\r\n            const daily = getDailyFromSourceId(sourceId)\r\n            if (daily?.rest) {\r\n                await daily.rest({ item, sourceId, updateItem: data => update.push(data) })\r\n            }\r\n        }\r\n\r\n        // we clean temporary rule elements\r\n        const rules = deepClone(item._source.system.rules)\r\n        let modifiedRules = false\r\n        for (let i = rules.length - 1; i >= 0; i--) {\r\n            if (MODULE_ID in rules[i]!) {\r\n                rules.splice(i, 1)\r\n                modifiedRules = true\r\n            }\r\n        }\r\n        if (modifiedRules) update.push({ _id: item.id, 'system.rules': rules })\r\n    }\r\n\r\n    if (update.length) await actor.updateEmbeddedDocuments('Item', update)\r\n    if (remove.length) await actor.deleteEmbeddedDocuments('Item', remove)\r\n\r\n    await setFlag(actor, 'rested', true)\r\n}\r\n","import { DailiesInterface } from '@apps/interface'\r\nimport { localize } from '@utils/foundry/localize'\r\nimport { getFlag } from '@utils/foundry/flags'\r\nimport { warn } from '@utils/foundry/notification'\r\nimport { hasAnyDaily } from './dailies'\r\n\r\nexport function renderCharacterSheetPF2e(sheet: CharacterSheetPF2e, html: JQuery) {\r\n    const actor = sheet.actor\r\n    if (!actor.isOwner || !hasAnyDaily(actor)) return\r\n\r\n    const small = html.find('aside .sidebar .hitpoints .hp-small')\r\n    small\r\n        .append(`<a class=\"roll-icon dailies\" data-tooltip=\"${localize('sheet.title')}\"><i class=\"fas fa-mug-saucer\"></i></a>`)\r\n        .find('.dailies')\r\n        .on('click', () => openDailiesInterface(actor))\r\n}\r\n\r\nfunction openDailiesInterface(actor: CharacterPF2e) {\r\n    if (getFlag(actor, 'rested') !== true) return warn('error.unrested')\r\n    new DailiesInterface(actor).render(true)\r\n}\r\n","import { MODULE_ID } from '@utils/module'\r\n\r\nexport function registerWrapper(target: string, fn: libWrapper.OverrideFunction, type: 'OVERRIDE'): number\r\nexport function registerWrapper(target: string, fn: libWrapper.WrappedFunction, type: 'WRAPPER' | 'MIXED'): number\r\nexport function registerWrapper(\r\n    target: string,\r\n    fn: libWrapper.WrappedFunction | libWrapper.OverrideFunction,\r\n    type: 'WRAPPER' | 'MIXED' | 'OVERRIDE' = 'WRAPPER'\r\n): number {\r\n    return libWrapper.register(MODULE_ID, target, fn, type)\r\n}\r\n"],"names":["__webpack_require__","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","getSettingLocalizationPath","path","join","templatePath","filter","x","getSetting","game","settings","setSetting","value","set","registerSetting","options","name","scope","config","hint","Array","isArray","choices","reduce","choice","register","getFlag","doc","fallback","getSourceId","localize","args","data","i18n","format","hasLocalization","has","localizePath","subLocalize","subKey","fn","defineProperties","warn","configurable","info","str","arg1","arg2","notify","error","template","hash","arg3","type","undefined","permanent","ui","notifications","dcByLevel","Map","dcAdjustments","chatUUID","uuid","Set","scrolls","scrollCompendiumIds","wordCharacter","String","raw","nonWordCharacter","nonWordCharacterRE","RegExp","wordBoundary","nonWordBoundary","lowerCaseLetter","upperCaseLetter","lowerCaseThenUpperCaseRE","nonWordCharacterHyphenOrSpaceRE","upperOrWordBoundariedLowerRE","sluggify","text","camel","console","replace","toLowerCase","trim","dromedary","charAt","toUpperCase","slice","part","index","Error","RUNE_PROPERTY_KEYS","SKILL_DICTIONARY","acr","arc","ath","cra","dec","dip","itm","med","nat","occ","prf","rel","soc","ste","sur","thi","SKILL_LONG_FORMS","keys","values","LANGUAGE_LIST","capitalize","sequenceArray","start","end","levels","i","push","halfLevelString","utils","skillNames","skillLabel","skill","CONFIG","PF2E","skillList","createSkillRuleElement","mode","predicate","rule","length","createLoreSource","rank","img","system","proficient","languageNames","languageLabel","language","languages","createLanguageRuleElement","resistanceLabel","resistance","createResistanceRuleElement","createFeatSource","async","source","fromUuid","toObject","createSpellScrollSource","level","temp","spell","scrollUUID","getScrollCompendiumUUID","scroll","location","heightenedLevel","temporary","traits","traditions","sourceId","flags","core","description","createSpellScroll","createSpellSource","getChoiSetRuleSelection","item","option","_source","rules","find","rollOption","selection","proficiencyLabel","proficiencyLevels","randomOption","result","Roll","evaluate","total","halfLevelValue","actor","Math","max","floor","damageLabel","damage","weaponDamage","weaponTraitLabel","trait","weaponTraits","weaponPropertyRunesLabel","rune","weaponPropertyRunes","hasFreePropertySlot","potency","runes","property","getFreePropertyRuneSlot","potencyRune","createSpellDaily","label","daily","rows","slug","search","process","addSpell","fields","messages","add","TricksterAce","category","drop","castTime","time","includes","parseInt","createScrollChain","uuids","children","createRow","addItem","field","indexOf","row","minActorLevel","child","condition","childPredicate","createFeatDaily","addFeat","feat","combatFlexibility","flexibility","improved","createLanguageDaily","actorLanguages","sort","labelizer","addRule","selected","MIND_WEAPON_UUID","WEAPON_BASE_TYPES","die","usage","WEAPON_GROUPS","slashing","piercing","bludgeoning","WEAPON_TRAITS","WEAPON_DAMAGE_TYPES","mindSmith","message","fix","content","weapon","Dialog","wait","title","buttons","yes","icon","callback","onWeaponSelected","no","close","id","width","createEmbeddedDocuments","not","updateItem","addGroup","smith","_id","mental","deepClone","advanced","runic","freeSlot","rest","runeSlot","html","val","stats","setProperty","RATION_UUID","getRations","itemTypes","flatMap","items","getItems","findItemWithSourceId","list","includesSourceId","getItemSourceIdCondition","createResistancelDaily","resistances","random","scrollSavant","prepare","maxSlot","maxTradition","tradition","entry","spellcasting","slots","Number","min","getSpellcastingTraditionDetails","first","second","third","fourth","map","rowName","custom","createTrainedSkillDaily","actorSkills","skills","input","createTrainedLoreDaily","thaumaturgeTome","createChildCondition","actorLevel","paragon","intense","adept","masters","experts","trained","AsyncFunction","constructor","BUILTINS_UUIDS","parseDailies","conjunction","UUIDS","dailies","prefix","original","keyWithPrefix","err","parseCustomDailies","clear","CUSTOM_DAILIES","customs","code","entries","CUSTOM_UUIDS","getDailies","isOfType","isInvested","Item","getDailyFromSourceId","getFamiliarPack","packs","isObject","PredicatePF2e","isValid","statements","super","this","static","every","s","StatementValidator","isStatement","test","clone","foundry","logCompatibilityWarning","CONST","COMPATIBILITY_MODES","WARNING","since","until","all","any","or","nor","flat","convertLegacyData","domain","isTrue","statement","isBinaryOp","testBinaryOp","isCompound","testCompound","eq","operator","left","right","domainArray","from","leftValues","isNaN","d","startsWith","exec","rightValues","some","l","r","and","subProp","nand","if","then","isAtomic","operands","binaryOperators","isAnd","isOr","isNand","isNor","isNot","isIf","templateOrders","select","combo","alert","getTemplate","saved","rowsObj","childrenObj","prepareArgs","dailyArgs","groupLabel","getProcessedValue","labeled","predicates","save","savedRow","rowLabel","rowTemplate","order","isComboRow","isSelectRow","isRandomRow","tmp","labelize","isDropRow","isAlerRow","getSimplifiableValue","numbered","parseFilter","parseFeatFilter","parseSpellFilter","checkFilter","checkbox","isExpanded","forEach","setTraits","searchTraits","dataTraits","getFilterTraits","pf2e","compendiumBrowser","tabs","getFilterData","checkboxes","school","rarity","multiselects","getSpellFilterLevel","getFeatFilterLevel","sliders","simplified","onDropFeat","target","types","localizeAll","testFn","translatedSkills","toLocaleLowerCase","lang","getTranslatedSkills","prerequisites","prerequisite","rarities","sources","itemLevel","dataset","onDropItem","onDropSpell","categories","spellCategories","isCantrip","isFocusSpell","isRitual","schools","nextElementSibling","classList","remove","processData","getFields","addItems","addRules","updateItems","msg","addedSpells","getRules","existing","splice","feats","spells","messageObj","group","familiar","pack","abilities","ids","effect","deleteEmbeddedDocuments","isCustom","getDocument","rations","uses","quantity","delete","remaining","fakeChatUUID","nb","parent","parentId","onDelete","rowFields","prepared","showSlotlessLevels","showUnpreparedSpells","proficiency","classDC","class","getProperty","update","expandObject","rested","updateEmbeddedDocuments","messageList","a","b","parseMessages","ChatMessage","create","speaker","getSpeaker","elements","element","toArray","previousElementSibling","DailiesInterface","Application","_actor","_randomInterval","_dailies","_dailyArgs","_saved","_children","_custom","_predicate","_rows","defaultOptions","mergeObject","height","submitOnClose","submitOnChange","dragDrop","dropSelector","templates","nbAbilityies","attributes","familiarAbilities","customUUIDS","split","toString","last","groups","getData","dump","placeholder","render","force","clearInterval","setInterval","each","_","selectedIndex","activateListeners","on","bind","event","HTMLLabelElement","dataString","dataTransfer","JSON","parse","preventDefault","currentTarget","fixed","openTab","parsed","addClass","removeClass","warns","emptyInputs","alertInputs","$","prevAll","attr","getModule","modules","tome","savant","mind","TEMPLATES","EXAMPLES","DailyCustoms","FormApplication","_selectedTemplate","_selectedDaily","_monaco","closeOnSubmit","scrollY","formData","extension","newVersion","active","isNewerVersion","EXT_VERSION","version","examples","isExample","monaco","dispose","api","area","createEditor","onDidChangeModelContent","debounce","getValue","form","querySelector","stipped","findIndex","stopPropagation","confirm","FormData","fromEntries","simplyfiable","splitList","fns","stringify","shift","match","strArgs","isSystem","setModuleID","onPerformDailyCrafting","getCraftingEntries","e","isDailyPrep","reagentCost","isAlchemical","sum","reagentValue","resources","crafting","infusedReagents","formula","preparedCraftingFormulas","itemSource","size","ancestry","addToInventory","Hooks","modifiedRules","setFlag","sheet","isOwner","hasAnyDaily","append","openDailiesInterface","once","default","onChange","restricted","registerMenu","registerSettingMenu","user","isGM","libWrapper","registerWrapper"],"sourceRoot":""}