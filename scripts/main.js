(()=>{var er=Object.defineProperty;var l=(t,e)=>er(t,"name",{value:e,configurable:!0});var tr=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)};var rt=(t,e,r)=>(tr(t,e,"read from private field"),r?r.call(t):e.get(t)),st=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)};var v="pf2e-dailies",be=async function(){}.constructor;function T(t){return game.settings.get(v,t)}l(T,"getSetting");function we(t,e){return game.settings.set(v,t,e)}l(we,"setSetting");function Y(...t){return`${v}.settings.${t.join(".")}`}l(Y,"getSettingLocalizationPath");function re(t){let e=t.name;t.scope=t.scope??"world",t.config=t.config??!1,t.config&&(t.name=Y(e,"name"),t.hint=Y(e,"hint")),Array.isArray(t.choices)&&(t.choices=t.choices.reduce((r,s)=>(r[s]=Y(e,"choices",s),r),{})),game.settings.register(v,e,t)}l(re,"registerSetting");function nt(t){let e=t.name;t.name=Y("menus",e,"name"),t.label=Y("menus",e,"label"),t.hint=Y("menus",e,"hint"),t.restricted=t.restricted??!0,t.icon=t.icon??"fas fa-cogs",game.settings.registerMenu(v,e,t)}l(nt,"registerSettingMenu");function H(...t){return t=t.filter(e=>typeof e=="string"),`modules/${v}/templates/${t.join("/")}`}l(H,"templatePath");function I(t,e,r){return t.getFlag(v,e)??r}l(I,"getFlag");function ve(t,e,r){return t.setFlag(v,e,r)}l(ve,"setFlag");function S(...t){let[e,r]=t;return e=`${v}.${e}`,r?game.i18n.format(e,r):game.i18n.localize(e)}l(S,"localize");function se(t){return game.i18n.has(`${v}.${t}`,!1)}l(se,"hasLocalization");function $e(t){return`${v}.${t}`}l($e,"localizePath");function O(t){let e=l((...r)=>S(`${t}.${r[0]}`,r[1]),"fn");return Object.defineProperties(e,{warn:{value:(...r)=>C(`${t}.${r[0]}`,r[1],r[2]),enumerable:!1,configurable:!1},info:{value:(...r)=>rr(`${t}.${r[0]}`,r[1],r[2]),enumerable:!1,configurable:!1},error:{value:(...r)=>U(`${t}.${r[0]}`,r[1],r[2]),enumerable:!1,configurable:!1},has:{value:r=>se(`${t}.${r}`),enumerable:!1,configurable:!1},path:{value:r=>$e(`${t}.${r}`),enumerable:!1,configurable:!1},template:{value:(r,{hash:s})=>e(r,s),enumerable:!1,configurable:!1}}),e}l(O,"subLocalize");function at(){return CONFIG.ChatMessage.documentClass}l(at,"getChatMessageClass");function Me(t,e,r,s){let a=typeof e=="string"?e:"info",o=typeof e=="object"?e:typeof r=="object"?r:void 0,n=typeof e=="boolean"?e:typeof r=="boolean"?r:s??!1;ui.notifications.notify(S(t,o),a,{permanent:n})}l(Me,"notify");function C(...t){let[e,r,s]=t;Me(e,"warning",r,s)}l(C,"warn");function rr(...t){let[e,r,s]=t;Me(e,"info",r,s)}l(rr,"info");function U(...t){let[e,r,s]=t;Me(e,"error",r,s)}l(U,"error");function J(t){return t.getFlag("core","sourceId")}l(J,"getSourceId");function sr(t,e){let r=J(t);return r?e.includes(r):!1}l(sr,"includesSourceId");function nr(t){return Array.isArray(t)?e=>sr(e,t):e=>J(e)===t}l(nr,"getItemSourceIdCondition");function ar(t,e){return e?e.flatMap(r=>t.itemTypes[r]):t.items}l(ar,"getItems");function Se(t,e,r){return ar(t,r).find(nr(e))}l(Se,"findItemWithSourceId");function ke(t,e){let r=[];if(t<=e)for(let s=t;s<=e;s++)r.push(s);else for(let s=t;s>=e;s--)r.push(s);return r}l(ke,"sequenceArray");function xe(t){return t?t[0].toUpperCase()+t.slice(1):""}l(xe,"capitalize");function Ue(t,e){return e?`@UUID[${t}]{${e}}`:`@UUID[${t}]`}l(Ue,"chatUUID");function it(t){return`<span style="background: #DDD;
    padding: 1px 4px;
    border: 1px solid var(--color-border-dark-tertiary);
    border-radius: 2px;
    white-space: nowrap;
    word-break: break-all;">${t}</span>`}l(it,"fakeChatUUID");function ot(t,e){if(typeof t!="object")return!1;for(;t=Reflect.getPrototypeOf(t);)if(t.constructor.name===e)return!0;return!1}l(ot,"isInstanceOf");function Ie(t,e,r={},s,a){return{key:t,label:a,item:{uuid:e},rows:[{type:"drop",slug:"spell",filter:{type:"spell",search:r}}],process:async({addSpell:n,utils:i,fields:u,messages:c})=>{let d=u.spell.uuid,f=await i.createSpellSource(d),m=`${f.name} (Level ${s||f.system.level.value})`;n(f,s),c.add("spells",{uuid:d,label:m})}}}l(Ie,"createSpellDaily");function lt(){let t=Ie("ace","Compendium.pf2e.feats-srd.Item.POrE3ZgBRdBL9MsW",{category:["cantrip","spell"],level:4},4),e=t.rows[0];return e.filter.drop=r=>{let s=r.system.time.value;return s.includes("hour")||s.includes("min")&&parseInt(s)>10?{error:$e("interface.error.drop.wrongSpellTime"),data:{time:"10 min"}}:!0},t}l(lt,"tricksterAce");var ut={key:"blade",item:{uuid:"Compendium.pf2e.classfeatures.Item.EtltLdiy9kNfHU0c"},children:[{slug:"good",uuid:"Compendium.pf2e.classfeatures.Item.nxZYP3KGfTSkaW6J"},{slug:"evil",uuid:"Compendium.pf2e.classfeatures.Item.JiY2ZB4FkK8RJm4T"},{slug:"liberator",uuid:"Compendium.pf2e.classfeatures.Item.FCoMFUsth4xB4veC"},{slug:"paladin",uuid:"Compendium.pf2e.classfeatures.Item.peEXunfbSD8WcMFk"},{slug:"antipaladin",uuid:"Compendium.pf2e.classfeatures.Item.EQ6DVIQHAUXUhY6Y"},{slug:"tyrant",uuid:"Compendium.pf2e.classfeatures.Item.HiIvez0TqESbleB5"},{slug:"spirit",uuid:"Compendium.pf2e.feats-srd.Item.h5ksUZlrVGBjq6p4"},{slug:"master",uuid:"Compendium.pf2e.feats-srd.Item.jYEMVfrXJLpXS6aC"}],rows:[{type:"select",slug:"weapon",label:()=>S("label.blade.weapon"),options:({actor:t})=>t.itemTypes.weapon.filter(e=>!e.isAlchemical).map(e=>({value:e.id,label:e.name}))},{type:"select",slug:"rune",label:()=>S("label.blade.rune"),options:({children:t})=>{let e=["returning","shifting"],{antipaladin:r,evil:s,good:a,liberator:o,master:n,paladin:i,spirit:u,tyrant:c}=t;return u&&(e.push("flaming"),a&&e.push("holy"),s&&e.push("unholy"),(o||r)&&e.push("anarchic"),(i||c)&&e.push("axiomatic")),a&&e.push("disrupting","ghost-touch"),n&&e.push("greater-disrupting","keen"),s&&e.push("fearsome"),e.map(d=>({value:d,label:ct(d)}))},condition:({actor:t})=>t.itemTypes.weapon.filter(e=>!e.isAlchemical).length}],process:async({actor:t,fields:e,addRule:r,messages:s})=>{let a=e.weapon.value,o=e.rune.value,n=t.items.get(a);if(!n)return;r({definition:[`item:id:${a}`],key:"AdjustStrike",mode:"add",property:"property-runes",value:o},n),r({key:"CriticalSpecialization",predicate:[{or:[`item:category:${n.category}`,`item:id:${a}`]}]},n);let i=n.name!==n._source.name?`... ${n._source.name}`:n.name;s.addGroup("blade"),s.add("blade",{uuid:n.uuid,label:i,selected:ct(o)})}};function ct(t){let e=t.replace(/-\w/,r=>r[1].toUpperCase());return game.i18n.localize(`PF2E.WeaponPropertyRune.${e}.Name`)}l(ct,"localizeRune");var ir="systems/pf2e/icons/equipment/weapons/wish-knife.webp",dt={key:"ceremonial",item:{uuid:"Compendium.pf2e.feats-srd.Item.78pkCdFaY8hI07Lj",condition:({actor:t})=>t.itemTypes.weapon.some(e=>e.group==="knife")},rows:[{type:"drop",slug:"spell",label:({utils:t,actor:e})=>t.spellRankLabel(je(e)),filter:{type:"spell",search:({actor:t})=>({category:["spell"],level:je(t)})}}],process:async({actor:t,fields:e,utils:r,item:s,addItem:a,messages:o})=>{let n=e.spell.uuid,i=je(t),u=await r.createWandSource({uuid:n,level:i,itemName:s.name,itemImg:ir});a(u),o.addGroup("ceremonial"),o.add("ceremonial",{uuid:n,label:u.name})}};function je(t){return Math.ceil((t.level-5)/2)}l(je,"calculateRank");var or=["first","second","third","fourth","fifth","sixth","seventh"];function ze(t,e,r){return{key:t,label:r,item:{uuid:e[0]},children:[{slug:"expert",uuid:e[1]},{slug:"master",uuid:e[2]}],rows:[G("first",1),G("second",2,8),G("third",3,void 0,"expert"),G("fourth",4,14,"expert"),G("fifth",5,16,"expert"),G("sixth",6,void 0,"master"),G("seventh",7,20,"master")],process:async({utils:a,fields:o,addItem:n,messages:i})=>{for(let u of Object.values(o)){let c=u.uuid,d=or.indexOf(u.row)+1,f=await a.createSpellScrollSource({uuid:c,level:d});n(f),i.add("scrolls",{uuid:c,label:f.name})}}}}l(ze,"createScrollChain");function G(t,e,r,s){let a={type:"drop",slug:t,label:({utils:o})=>o.spellRankLabel(e),filter:{type:"spell",search:{category:["spell"],level:e}}};return r&&(a.condition=({actor:o})=>o.level>=r),s&&(a.childPredicate=[s]),a}l(G,"createRow");function Ce(t,e,r={},s){return{key:t,label:s,item:{uuid:e},rows:[{type:"drop",slug:"feat",filter:{type:"feat",search:r}}],process:async({utils:o,fields:n,addFeat:i,messages:u})=>{let c=n.feat.uuid,d=await o.createFeatSource(c);i(d),u.add("feats",{uuid:c})}}}l(Ce,"createFeatDaily");var ft={key:"flexibility",item:{uuid:"Compendium.pf2e.classfeatures.Item.8g6HzARbhfcgilP8"},children:[{slug:"improved",uuid:"Compendium.pf2e.classfeatures.Item.W2rwudMNcAxs8VoX"}],rows:[pt("flexibility",8),pt("improved",14,"improved")],process:async({utils:t,fields:e,addFeat:r,messages:s,children:a})=>{let o=e.flexibility.uuid,n=await t.createFeatSource(o);if(r(n),s.add("feats",{uuid:o}),a.improved){let i=e.improved.uuid,u=await t.createFeatSource(i);r(u,a.improved),s.add("feats",{uuid:i})}}};function pt(t,e,r){let s={type:"drop",label:`PF2E.Level${e}`,slug:t,filter:{type:"feat",search:{category:["class"],traits:["fighter"],level:e}}};return r&&(s.childPredicate=[r]),s}l(pt,"createRow");function ne(t,e,r){return{key:t,label:r,item:{uuid:e},rows:[{type:"select",slug:"language",options:({actor:s,utils:a})=>{let o=s.system.traits.languages.value;return a.languageNames.filter(n=>!o.includes(n)).sort()},labelizer:({utils:s})=>s.languageLabel}],process:({addRule:s,utils:a,fields:o,messages:n})=>{let i=o.language.value,u=a.createLanguageRuleElement({language:i});s(u),n.add("languages",{uuid:e,selected:a.languageLabel(i),label:r})}}}l(ne,"createLanguageDaily");var We="Compendium.pf2e-dailies.equipment.Item.VpmEozw21aRxX15P",mt="Compendium.pf2e.feats-srd.Item.PccekOihIbRWdDky",lr={0:{die:"d4",traits:["finesse","agile"],usage:"held-in-one-hand"},1:{die:"d6",traits:["finesse"],usage:"held-in-one-hand"},2:{die:"d8",traits:[],usage:"held-in-one-hand"},3:{die:"d10",traits:["reach"],usage:"held-in-two-hands"}},yt={slashing:"sword",piercing:"spear",bludgeoning:"club"},gt=["grapple","nonlethal","shove","trip","modular"],cr=Object.keys(yt),ur=["corrosive","disrupting","flaming","frost","shock","thundering"],dr=["anarchic","axiomatic","greaterCorrosive","greaterDisrupting","greaterFlaming","greaterFrost","greaterShock","greaterThundering","holy","unholy"],ht={key:"mindsmith",item:{uuid:"Compendium.pf2e.feats-srd.Item.juikoiIA0Jy8PboY"},children:[{slug:"weapon",uuid:We},{slug:"mental",uuid:mt},{slug:"runic",uuid:"Compendium.pf2e.feats-srd.Item.2uQbQgz1AbjzcFSp"},{slug:"advanced",uuid:"Compendium.pf2e.feats-srd.Item.fgnfXwFcn9jZlXGD"}],rows:[{type:"alert",slug:"alert",message:()=>S("interface.alert.weapon"),fix:pr,childPredicate:[{not:"weapon"}]},{type:"select",slug:"smith",label:()=>S("label.mindsmith"),options:cr,labelizer:({utils:t})=>t.damageLabel,childPredicate:["weapon"]},...[1,2].map(t=>({type:"select",slug:`mental${t}`,label:()=>S("label.mentalforge",{nb:t}),options:gt,labelizer:({utils:e})=>e.weaponTraitLabel,childPredicate:["weapon","mental"]})),{type:"select",slug:"runic",label:()=>S("label.runicmind"),options:ur,labelizer:({utils:t})=>t.weaponPropertyRunesLabel,childPredicate:["weapon","runic",{not:"advanced"}],condition:({children:t,utils:e})=>e.hasFreePropertySlot(t.weapon)},{type:"select",slug:"advanced",label:()=>S("label.runicmind"),options:dr,labelizer:({utils:t})=>t.weaponPropertyRunesLabel,childPredicate:["weapon","advanced"],condition:({children:t,utils:e})=>e.hasFreePropertySlot(t.weapon)}],process:({children:t,updateItem:e,fields:r,messages:s,item:a,utils:o})=>{let n=t.weapon;if(!n)return;s.addGroup("mindsmith");let i=r.smith.value;if(e({_id:n.id,"system.damage.damageType":i,"system.group":yt[i]}),s.add("mindsmith",{selected:o.damageLabel(i),uuid:a.uuid,label:"mindsmith"}),t.mental){let u=deepClone(n._source.system.traits?.value??[]);for(let c of[1,2]){let d=r[`mental${c}`].value;u.includes(d)||u.push(d),e({_id:n.id,"system.traits.value":u}),s.add("mindsmith",{selected:o.weaponTraitLabel(d),uuid:t.mental.uuid,label:S("label.mentalforge",{nb:c})})}}if((t.advanced||t.runic)&&o.hasFreePropertySlot(n)){let u=t.advanced??t.runic,c=o.getFreePropertyRuneSlot(n),f=(r.advanced??r.runic).value;c&&!n.system.runes.property.includes(f)&&(e({_id:n.id,[`system.${c}.value`]:f,[`flags.${v}.runeSlot`]:c}),s.add("mindsmith",{selected:o.weaponPropertyRunesLabel(f),uuid:u.uuid,label:"runicmind"}))}},rest:({item:t,sourceId:e,updateItem:r,actor:s})=>{if(e!==We)return;if(Se(s,mt)){let n=t._source.system.traits?.value??[];n=n.filter(i=>!gt.includes(i)),r({_id:t.id,"system.traits.value":n})}let o=I(t,"runeSlot");o&&r({_id:t.id,[`system.${o}.value`]:null,[`flags.${v}.-=runeSlot`]:!0})}};async function pr({actor:t}){let e=O("dialog.weapon"),r=e("flavor");for(let a of["0","1","2","3"]){let o=e(`option.${a}`);r+=`<label><input type="radio" name="type" value="${a}">${o}</label>`}let s=await Dialog.wait({title:e("title"),content:r,buttons:{yes:{icon:'<i class="fas fa-save"></i>',label:e("accept"),callback:fr},no:{icon:'<i class="fas fa-times"></i>',label:e("cancel"),callback:()=>null}},close:()=>null},{},{id:"pf2e-dailies-weapon",width:600});return s?(await t.createEmbeddedDocuments("Item",[s]),!0):!1}l(pr,"fix");async function fr(t){let e=O("dialog.weapon"),r=t.find("[name=type]:checked").val();if(!r){e.warn("error.noSelection");return}let s=(await fromUuid(We))?.toObject();if(!s){e.warn("error.missing");return}let a=lr[r];return setProperty(s,"system.damage.die",a.die),setProperty(s,"system.traits.value",a.traits.slice()),setProperty(s,"system.usage.value",a.usage),s}l(fr,"onWeaponSelected");function ae(t,e,r,s,a,o){return{key:t,label:a,item:{uuid:e},rows:[{type:o?"random":"select",slug:"resistance",options:r,labelizer:({utils:i})=>i.resistanceLabel}],process:async({utils:i,fields:u,actor:c,addRule:d,messages:f})=>{let m=o?await i.randomOption(r):u.resistance.value,y=typeof s=="number"?s:s==="half"?i.halfLevelValue(c):c.level,p=i.createResistanceRuleElement({type:m,value:y});d(p),f.add("resistances",{uuid:e,selected:i.resistanceLabel(m,y),label:a,random:o})}}}l(ae,"createResistancelDaily");var mr="Compendium.pf2e.feat-effects.Item.jO7wMhnjT7yoAtQg",bt={key:"root",item:{uuid:"Compendium.pf2e.feats-srd.Item.22P7IFyhrF7Fbw8B"},rows:[{type:"select",slug:"target",options:({actor:t,utils:e})=>e.getPlayersActors(t).map(s=>({value:s.id,label:s.name}))}],process:({fields:t,messages:e})=>{let r=t.target.value,s=game.actors.get(r);s&&(e.addGroup("root"),e.add("root",{uuid:mr,selected:s.name}))}};function j(){return game.modules.get("pf2e-staves")?.active}l(j,"isPF2eStavesActive");function ie(t){if(!t)return;let e=I(t,"staff")??getProperty(t,"flags.pf2e-staves");if(e)return delete e.prevDescription,deepClone(e)}l(ie,"getSpellcastingEntryStaffFlags");function oe(t){let e=ie(t);if(e)return e.overcharge??=0,e.max=X(t.actor)+e.overcharge,e}l(oe,"getSpellcastingEntryStaffData");async function le(t,e){let r=oe(t);if(!r)return;let s=Math.clamped(e,0,r.max);if(s!==r.charges)return r.charges=s,ve(t,"staff",r)}l(le,"updateEntryCharges");async function wt(t,...e){let r=ie(this);if(!r)return t(...e);let s=this.actor;if(!s.items.get(r.staveID)?.isEquipped){C("staves.noStaff");return}let[o,{level:n}]=e,i=o.computeCastRank(n);if(!n||n==="0")return o.toMessage(void 0,{data:{castLevel:i}});if(r.charges<1||r.charges<i&&r.overcharge){C("staves.noCharge");return}let u=[];if(!r.overcharge){let c=s.spellcasting.filter(m=>m.isSpontaneous&&m.system.slots[`slot${i}`].value),d=!1,f=l(m=>m.system.slots[`slot${i}`].value,"entryRankValue");if(c.length===1){let m=c[0],y=S("staves.spontaneous.one",{rank:A.spellRankLabel(i),entry:m.name,remaining:f(m)});d=await Dialog.confirm({title:S("staves.spontaneous.title"),defaultYes:!1,content:`<div class="pf2e-dailies-spontaneous">${y}</div>`}),d&&(d=0)}else if(c.length>1){let m=c.map((p,g)=>({index:g,name:p.name,remaining:f(p)})),y=await renderTemplate(H("staves-spontaneous.hbs"),{entries:m,castRank:A.spellRankLabel(i),i18n:(p,{hash:g})=>S(`staves.spontaneous.${p}`,g)});d=await Dialog.wait({title:S("staves.spontaneous.title"),content:y,buttons:{yes:{icon:'<i class="fas fa-check"></i>',label:game.i18n.localize("Yes"),callback:p=>p.find("input[name=entry]:checked").val()},no:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("No"),callback:()=>!1}},close:()=>null})}if(d===null)return;if(d!==!1){let m=c[d],y=m.system.slots[`slot${i}`].value;u.push({_id:m.id,[`system.slots.slot${i}.value`]:y-1}),r.charges-=1}}if(!u.length){if(r.charges<i){C("staves.noCharge");return}r.charges-=i}u.push({_id:this.id,[`flags.${v}.staff`]:r}),await s.updateEmbeddedDocuments("Item",u),await o.toMessage(void 0,{data:{castLevel:i}})}l(wt,"onSpellcastingEntryCast");function ce(t,{itemOnly:e,innate:r,focus:s}={}){return t.spellcasting.regular.filter(a=>!(a.flags?.["pf2e-staves"]||I(a,"staff")||!r&&a.isInnate||!s&&a.isFocusPool||a.system.prepared.value==="items"&&(!e||e==="scroll"&&a.system.prepared.validItems!=="scroll")))}l(ce,"getValidSpellcastingList");function De(t){let e=0;if(t.system.prepared.value==="items"){let r=Math.ceil(t.actor.level/2);r>e&&(e=r)}else{let r=t.system.slots;for(let s in r)r[s].max&&(e=Math.max(e,Number(s.slice(4))))}return e}l(De,"getSpellcastingEntryMaxSlotRank");function vt(t){let e=[],r=t.spellcasting.regular.filter(s=>s.isPrepared);for(let s of r)for(let a=1;a<=10;a++){let o=s.system.slots[`slot${a}`];if(o.max)for(let{id:n,prepared:i,expended:u}of Object.values(o.prepared)){if(i===!1||u)continue;let c=s.spells.get(n);c&&e.push(c)}}return e}l(vt,"getPreparedSpells");function St(t){if(!t)return;let e=t.rank,r=t.spellcasting,a=Object.entries(r.system.slots[`slot${e}`].prepared).find(([o,{id:n,expended:i}])=>n===t.id&&i!==!0);if(a)return{slot:a[0],rank:e,entry:r}}l(St,"getNotExpendedPreparedSpellSlot");function kt(t){let e=ce(t,{itemOnly:!0}),r={mod:0};for(let{tradition:s,attribute:a,statistic:o,rank:n}of e){let i=o.mod;i>r.mod&&(r={tradition:s,attribute:a,mod:i,rank:n})}if(r.mod)return r}l(kt,"getBestSpellcastingEntry");var xt={key:"savant",item:{uuid:"Compendium.pf2e.feats-srd.Item.u5DBg0LrBUKP0JsJ"},prepare:({actor:t})=>{let{maxSlot:e,maxTradition:r}=gr(t,"arcane");return{first:{level:e-2,condition:!0},second:{level:e-3,condition:!0},third:{level:e-4,condition:r>=3&&e>=5},fourth:{level:e-5,condition:r>=4&&e>=6}}},rows:["first","second","third","fourth"].map(t=>({type:"drop",slug:t,label:({custom:r,utils:s})=>s.spellRankLabel(r[t].level),filter:{type:"spell",search:({custom:r})=>({category:["spell"],traditions:["arcane"],level:r[t].level})},condition:({custom:r})=>r[t].condition})),process:async({utils:t,fields:e,custom:r,addItem:s,messages:a})=>{for(let o of Object.values(e)){let n=o.uuid,i=await t.createSpellScrollSource({uuid:n,level:r[o.row].level});s(i),a.add("scrolls",{uuid:n,label:i.name})}}};function gr(t,e){let r=1,s=0,a=ce(t);for(let o of a){let n=De(o);n>r&&(r=n),o.tradition===e&&(s=Math.max(s,o.rank))}return{maxSlot:Math.min(r,10),maxTradition:s}}l(gr,"getSpellcastingTraditionDetails");function B(t,e,r){return{key:t,label:r,item:{uuid:e},rows:[{type:"combo",slug:"skill",options:({actor:a,utils:o})=>{let n=a.skills;return o.skillNames.filter(i=>n[i].rank<1)},labelizer:({utils:a})=>a.skillLabel}],process:({fields:a,addItem:o,addRule:n,utils:i,messages:u})=>{let c=a.skill.value;if(a.skill.input==="true"){let d=i.createLoreSource({name:c,rank:1});o(d)}else{let d=i.createSkillRuleElement({skill:c,value:1});c=i.skillLabel(c),n(d)}u.add("skills",{uuid:e,selected:c,label:r})}}}l(B,"createTrainedSkillDaily");function Ee(t,e,r){return{key:t,label:r,item:{uuid:e},rows:[{type:"input",slug:"skill"}],process:({addItem:a,utils:o,fields:n,messages:i})=>{let u=n.skill.value,c=o.createLoreSource({name:u,rank:1});a(c),i.add("skills",{uuid:e,selected:u,label:r})}}}l(Ee,"createTrainedLoreDaily");var It={key:"tome",item:{uuid:"Compendium.pf2e.classfeatures.Item.MyN1cQgE0HsLF20e"},children:[{slug:"adept",uuid:"Compendium.pf2e.classfeatures.Item.Obm4ItMIIr0whYeO",condition:Ge("adept")},{slug:"second",uuid:"Compendium.pf2e.classfeatures.Item.ZEUxZ4Ta1kDPHiq5",condition:Ge("adept")},{slug:"intense",uuid:"Compendium.pf2e.feats-srd.Item.yRRM1dsY6jakEMaC"},{slug:"paragon",uuid:"Compendium.pf2e.classfeatures.Item.QEtgbY8N2V4wTbsI",condition:Ge("paragon")}],prepare:({utils:t,actor:e,children:r})=>{let s=t.skillNames,a=e.level,o=e.skills,n={first:{options:[],rank:1},second:{options:[],rank:1}};if(r.paragon){let i=s.filter(u=>o[u].rank<4);n.first={rank:4,options:i},n.second={rank:4,options:i}}else if(r.intense||r.adept||r.second){let i=s.filter(u=>o[u].rank<3);if(a>=9)n.first={rank:3,options:i},n.second={rank:3,options:i};else{let u=s.filter(c=>o[c].rank<2);n.first={rank:2,options:u},n.second={rank:3,options:i}}}else if(a>=5){let i=s.filter(u=>o[u].rank<2);n.first={rank:2,options:i},n.second={rank:2,options:i}}else if(a>=3){let i=s.filter(c=>o[c].rank<1),u=s.filter(c=>o[c].rank<2);n.first={rank:1,options:i},n.second={rank:2,options:u}}else{let i=s.filter(u=>o[u].rank<1);n.first={rank:1,options:i},n.second={rank:1,options:i}}return n},rows:["first","second"].map(t=>({type:"combo",slug:t,label:({custom:r,utils:s})=>s.proficiencyLabel(r[t].rank),options:({custom:r})=>r[t].options,labelizer:({utils:r})=>r.skillLabel})),process:({custom:t,fields:e,utils:r,messages:s,addItem:a,addRule:o})=>{s.addGroup("tome",65);for(let n of["first","second"]){let i=t[n].rank,u=e[n].value;if(e[n].input==="true"){let c=r.createLoreSource({name:u,rank:i});a(c)}else{let c=r.createSkillRuleElement({skill:u,value:i});u=r.skillLabel(u),o(c)}s.add("tome",{label:r.proficiencyLabel(i),selected:u})}}};function Ge(t){return function({item:e,utils:r}){return r.getChoiSetRuleSelection(e,t)==="tome"}}l(Ge,"createChildCondition");var yr=["root-magic"],Be=[It,B("longevity","Compendium.pf2e.feats-srd.Item.WoLh16gyDp8y9WOZ"),B("ageless","Compendium.pf2e.feats-srd.Item.wylnETwIz32Au46y"),B("memories","Compendium.pf2e.feats-srd.Item.ptEOt3lqjxUnAW62"),B("studies","Compendium.pf2e.feats-srd.Item.9bgl6qYWKHzqWZj0"),Ee("study","Compendium.pf2e.feats-srd.Item.aLJsBBZzlUK3G8MW"),ne("linguistics","Compendium.pf2e.feats-srd.Item.eCWQU16hRLfN1KaX"),ne("borts","Compendium.pf2e.equipment-srd.Item.iS7hAQMAaThHYE8g"),ae("elementalist","Compendium.pf2e.feats-srd.Item.tx9pkrpmtqe4FnvS",["air","earth","fire","water"],"half","elementalist"),ae("ganzi","Compendium.pf2e.heritages.Item.3reGfXH0S82hM7Gp",["acid","electricity","sonic"],"half","ganzi",!0),Ce("metamagical","Compendium.pf2e.classfeatures.Item.89zWKD2CN7nRu2xp",{category:["class"],traits:{selected:["spellshape","wizard"],conjunction:"and"},level:"half"}),ft,xt,ze("esoterica",["Compendium.pf2e.feats-srd.Item.OqObuRB8oVSAEKFR","Compendium.pf2e.feats-srd.Item.nWd7m0yRcIEVUy7O","Compendium.pf2e.feats-srd.Item.LHjPTV5vP3MOsPPJ"]),ze("trickster",["Compendium.pf2e.feats-srd.Item.ROAUR1GhC19Pjk9C","Compendium.pf2e.feats-srd.Item.UrOj9TROtn8nuxPf","Compendium.pf2e.feats-srd.Item.lIg5Gzz7W70jfbk1"]),lt(),ht,ut,bt,dt],hr=Oe(Be,"dailies"),ue=new Map;function Oe(t,e){let r=new Map;for(let s of t){let a=deepClone(s);try{let o=`${e}.${a.key}`;if(r.set(a.item.uuid,{daily:a,condition:a.item.condition}),a.key=o,a.children)for(let n=0;n<a.children.length;n++){let{uuid:i,condition:u}=a.children[n];r.set(i,{daily:a,index:n,condition:u})}}catch(o){U("error.unexpected"),console.error(o),console.error(`The error occured during data gathering of ${e}.${a.key}`)}}return r}l(Oe,"prepareDailies");var de=[];async function qe(){ue.clear(),de=[];let t=T("customDailies");for(let{key:r,code:s}of t)try{let o=await new be(s)();if(!Ve(o,!0))continue;de.push(o)}catch(a){U("error.unexpected"),console.error(a),console.error(`The error occured during call of custom function for ${r}`)}for(let[r,s]of hr.entries())ue.set(r,s);let e=Oe(de,"custom");for(let[r,s]of e.entries())ue.set(r,s)}l(qe,"parseCustomDailies");function Ve(t,e=!1){return yr.includes(t.key)?(e&&game.user.isGM&&C("deprecated.custom.key",{name:t.label.trim()||t.key},!0),!1):!0}l(Ve,"checkCustomDaily");function Ct(t){let e={};for(let r of t.items){let s=J(r);if(!s||r.isOfType("physical")&&r.isInvested===!1)continue;let a=ue.get(s);if(!a)continue;let{daily:o,index:n,condition:i}=a;try{if(typeof i=="function"&&!i({actor:t,item:r,utils:A}))continue;e[o.key]??=deepClone(o),n===void 0?e[o.key].item=r:e[o.key].children[n].item=r}catch(u){U("error.unexpected"),console.error(u),console.error(`The error occured during data gathering of ${o.key}`)}}return Object.values(e).filter(r=>r.item&&r.item instanceof Item)}l(Ct,"getDailies");function Dt(t){return ue.get(t)?.daily}l(Dt,"getDailyFromSourceId");function Ae(){return game.packs.get("pf2e.familiar-abilities")}l(Ae,"getFamiliarPack");function Et(t){return`Compendium.pf2e.familiar-abilities.Item.${t}`}l(Et,"familiarUUID");var br="Compendium.pf2e.equipment-srd.Item.L9ZV076913otGtiB";function Fe(t){return Se(t,br)}l(Fe,"getRations");function Ot(t){return Error(`PF2e System | ${t}`)}l(Ot,"ErrorPF2e");function Ye(t){return typeof t=="object"&&t!==null}l(Ye,"isObject");var _=class extends Array{constructor(...e){super(...Array.isArray(e[0])?e[0]:e),this.isValid=_.isValid(this)}static isValid(e){return this.isArray(e)}static isArray(e){return super.isArray(e)&&e.every(r=>q.isStatement(r))}static test(e=[],r){return e instanceof _?e.test(r):new _(...e).test(r)}test(e){if(this.length===0)return!0;if(!this.isValid)return console.warn("PF2e System | The provided predicate set is malformed."),!1;let r=e instanceof Set?e:new Set(e);return this.every(s=>this.#e(s,r))}toObject(){return deepClone([...this])}clone(){return new _(this.toObject())}#e(e,r){return typeof e=="string"&&r.has(e)||q.isBinaryOp(e)&&this.#s(e,r)||q.isCompound(e)&&this.#r(e,r)}#s(e,r){if("eq"in e)return r.has(`${e.eq[0]}:${e.eq[1]}`);{let s=Object.keys(e)[0],[a,o]=Object.values(e)[0],n=Array.from(r),i=l(d=>{let f=Number(d);if(!Number.isNaN(f))return[f];let m=new RegExp(String.raw`^${d}:([^:]+)$`),y=n.map(p=>Number(m.exec(p)?.[1]||NaN)).filter(p=>!Number.isNaN(p));return y.length>0?y:[NaN]},"getValues"),u=i(a),c=i(o);switch(s){case"gt":return u.some(d=>c.every(f=>d>f));case"gte":return u.some(d=>c.every(f=>d>=f));case"lt":return u.some(d=>c.every(f=>d<f));case"lte":return u.some(d=>c.every(f=>d<=f));default:return console.warn("PF2e System | Malformed binary operation encountered"),!1}}}#r(e,r){return"and"in e&&e.and.every(s=>this.#e(s,r))||"nand"in e&&!e.nand.every(s=>this.#e(s,r))||"or"in e&&e.or.some(s=>this.#e(s,r))||"xor"in e&&e.xor.filter(s=>this.#e(s,r)).length===1||"nor"in e&&!e.nor.some(s=>this.#e(s,r))||"not"in e&&!this.#e(e.not,r)||"if"in e&&!(this.#e(e.if,r)&&!this.#e(e.then,r))}};l(_,"PredicatePF2e");var Re,q=class{static isStatement(e){return e instanceof Object?this.isCompound(e)||this.isBinaryOp(e):typeof e=="string"?this.isAtomic(e):!1}static isAtomic(e){return typeof e=="string"&&e.length>0||this.isBinaryOp(e)}static isBinaryOp(e){if(!Ye(e))return!1;let r=Object.entries(e);if(r.length>1)return!1;let[s,a]=r[0];return rt(this,Re).has(s)&&Array.isArray(a)&&a.length===2&&typeof a[0]=="string"&&["string","number"].includes(typeof a[1])}static isCompound(e){return Ye(e)&&(this.isAnd(e)||this.isOr(e)||this.isNand(e)||this.isXor(e)||this.isNor(e)||this.isNot(e)||this.isIf(e))}static isAnd(e){return Object.keys(e).length===1&&Array.isArray(e.and)&&e.and.every(r=>this.isStatement(r))}static isNand(e){return Object.keys(e).length===1&&Array.isArray(e.nand)&&e.nand.every(r=>this.isStatement(r))}static isOr(e){return Object.keys(e).length===1&&Array.isArray(e.or)&&e.or.every(r=>this.isStatement(r))}static isXor(e){return Object.keys(e).length===1&&Array.isArray(e.xor)&&e.xor.every(r=>this.isStatement(r))}static isNor(e){return Object.keys(e).length===1&&Array.isArray(e.nor)&&e.nor.every(r=>this.isStatement(r))}static isNot(e){return Object.keys(e).length===1&&!!e.not&&this.isStatement(e.not)}static isIf(e){return Object.keys(e).length===2&&this.isStatement(e.if)&&this.isStatement(e.then)}};l(q,"StatementValidator"),Re=new WeakMap,st(q,Re,new Set(["eq","gt","gte","lt","lte"]));var wr={select:100,combo:80,random:60,alert:40,input:20,drop:0};async function Ft({children:t=[],key:e,item:r,prepare:s,label:a,rows:o=[]}){let n=this.actor,i=this.saved[e]=I(n,e)??{},u=this.rows[e]={},c=this.children[e]=t.reduce((b,{slug:h,item:k})=>(b[h]=k,b),{}),d={actor:n,item:r,children:c,utils:A},f=this.custom[e]=s&&await s(d)||{},m=this.dailyArgs[e]={...d,custom:f},y=await He(a,m),p=y?`label.${y}`:e.startsWith("dailies.")?`label.${e.slice(8)}`:void 0;p&&se(p)&&(y=S(p));let g=this.predicate[e]=t.filter(b=>b.item).map(b=>b.slug),w={label:y?game.i18n.localize(y):r.name,rows:[]};for(let b of o){u[b.slug]=b;let{type:h,slug:k,childPredicate:x=[],condition:F,label:E,save:ee}=b;if(x.length&&!_.test(x,g)||F&&!await F(m))continue;let P=ee===!1||h==="random"?void 0:i[k],ge=await He(E,m),Ne=P===void 0?"":typeof P!="object"?P:"name"in P?P.name:P.selected,R={label:ge?game.i18n.localize(ge):"",value:Ne,order:wr[h],data:{type:h,daily:e,row:k}};if(At(b)||vr(b)||Sr(b)){let te=await He(b.options,m)??[];if(h!=="combo"&&!te.length)continue;let V=typeof b.labelizer=="function"&&b.labelizer(m)||(L=>xe(L));R.options=te.map(L=>typeof L=="string"?{value:L,label:V(L)}:L),At(b)&&(R.selected=R.value,R.data.input=P?.input??!0,!R.data.input&&te.includes(R.selected)&&(R.value=V(R.selected)))}else kr(b)?R.data.uuid=P?.uuid??"":xr(b)&&(R.value=typeof b.message=="function"?await b.message(m):b.message);w.rows.push(R)}return w}l(Ft,"getTemplate");async function He(t,e){return typeof t=="function"?await t(e):t}l(He,"getProcessedValue");function At(t){return t.type==="combo"}l(At,"isComboRow");function vr(t){return t.type==="select"}l(vr,"isSelectRow");function Sr(t){return t.type==="random"}l(Sr,"isRandomRow");function kr(t){return t.type==="drop"}l(kr,"isDropRow");function xr(t){return t.type==="alert"}l(xr,"isAlerRow");function Rt(){return Object.entries(CONFIG.PF2E.skillList).reduce((t,[e,r])=>({...t,[e]:game.i18n.localize(r).toLocaleLowerCase(game.i18n.lang)}),{})}l(Rt,"getTranslatedSkills");var Te=String.raw`[\p{Alphabetic}\p{Mark}\p{Decimal_Number}\p{Join_Control}]`,Je=String.raw`[^\p{Alphabetic}\p{Mark}\p{Decimal_Number}\p{Join_Control}]`,Ir=new RegExp(Je,"gu"),Cr=String.raw`(?:${Te})(?=${Je})|(?:${Je})(?=${Te})`,Dr=String.raw`(?:${Te})(?=${Te})`,Tt=String.raw`\p{Lowercase_Letter}`,Pt=String.raw`\p{Uppercase_Letter}`,Er=new RegExp(`(${Tt})(${Pt}${Dr})`,"gu"),Or=/[^-\p{White_Space}\p{Alphabetic}\p{Mark}\p{Decimal_Number}\p{Join_Control}]/gu,Ar=new RegExp(`${Pt}|(?:${Cr})${Tt}`,"gu");function W(t,{camel:e=null}={}){if(typeof t!="string")return console.warn("Non-string argument passed to `sluggify`"),"";switch(e){case null:return t.replace(Er,"$1-$2").toLowerCase().replace(/['â€™]/g,"").replace(Ir," ").trim().replace(/[-\s]+/g,"-");case"bactrian":{let r=W(t,{camel:"dromedary"});return r.charAt(0).toUpperCase()+r.slice(1)}case"dromedary":return t.replace(Or,"").replace(/[-_]+/g," ").replace(Ar,(r,s)=>s===0?r.toLowerCase():r.toUpperCase()).replace(/\s+/g,"");default:throw Ot("I don't think that's a real camel.")}}l(W,"sluggify");function Pe(t,e,r){if(e===void 0)return r;if(typeof e=="number")return e;if(e==="level")return t.level;if(e==="half")return Math.max(1,Math.floor(t.level/2));let s=Number(e);return isNaN(s)?r:s}l(Pe,"getSimplifiableValue");async function Lt(t){return{type:t.type,search:await(t.type==="feat"?Rr(this.actor,t.search):Fr(this.actor,t.search)),drop:t.drop}}l(Lt,"parseFilter");function N(t,e){t?.length&&(e.selected=t,e.isExpanded=!0,t.forEach(r=>e.options[r].selected=!0))}l(N,"checkFilter");function _t(t,e){let r=Le(t);r?.selected.length&&(e.conjunction=r.conjunction,e.selected=r.selected)}l(_t,"setTraits");function Le(t){if(!t)return;let e=Array.isArray(t)?t:t.selected;if(e?.length)return{selected:e.map(r=>typeof r=="string"?{value:r}:r),conjunction:!Array.isArray(t)&&t.conjunction||"and"}}l(Le,"getFilterTraits");async function Fr(t,e){let r=await game.pf2e.compendiumBrowser.tabs.spell.getFilterData();N(e.category,r.checkboxes.category),N(e.school,r.checkboxes.school),N(e.traditions,r.checkboxes.traditions),N(e.rarity,r.checkboxes.rarity),N(e.source,r.checkboxes.source),_t(e.traits,r.multiselects.traits);let s=Xe(t,e.level);return s?.length&&N(s,r.checkboxes.rank),r}l(Fr,"parseSpellFilter");async function Rr(t,e){let r=await game.pf2e.compendiumBrowser.tabs.feat.getFilterData();N(e.category,r.checkboxes.category),N(e.skills,r.checkboxes.skills),N(e.rarity,r.checkboxes.rarity),N(e.source,r.checkboxes.source),_t(e.traits,r.multiselects.traits);let s=Ze(t,e.level);return s&&(r.sliders.level.values.min=s.min,r.sliders.level.values.max=s.max,r.sliders.level.isExpanded=!0),r}l(Rr,"parseFeatFilter");function Xe(t,e){if(Array.isArray(e))return e;let r=Pe(t,e);if(r)return ke(1,r)}l(Xe,"getSpellFilterLevel");function Ze(t,e){if(e!==void 0)return typeof e=="object"?{min:Pe(t,e.min,0),max:Pe(t,e.min,20)}:{min:0,max:Pe(t,e,20)}}l(Ze,"getFeatFilterLevel");var D=O("interface.error.drop");async function Nt(t,e,r){if(!t.isOfType("feat"))return D("notFeat");let{search:s,drop:a}=r;if(s.category?.length&&!s.category.includes(t.category))return D.warn("wrongType",{types:Z("featCategories",s.category)});if(s.traits){let n=Le(s.traits);if(n?.selected.length){let i=n.conjunction==="or"?"some":"every";if(!n.selected[i](c=>Number(c.not??!1)-Number(t.traits.has(c.value))))return D.warn("wrongTraits")}}if(s.skills?.length){let n=Rt(),i=t.system.prerequisites.value.map(c=>c.value.toLocaleLowerCase());if(!s.skills.some(c=>i.some(d=>d.includes(c)||d.includes(n[c]))))return D.warn("wrongSkill",{skills:Z("skillList",s.skills)})}if(s.rarity?.length&&!s.rarity.includes(t.system.traits.rarity))return D.warn("wrongRarity",{rarities:Z("rarityTraits",s.rarity)});if(s.source?.length&&!s.source.includes(W(t.system.source.value)))return D.warn("wrongSource",{sources:s.source.join(", ")});let o=Ze(this.actor,s.level);if(o){let n=t.level;if(n<o.min)return D.warn("wrongLevelLow",{level:`min: ${o.min}`});if(n>o.max)return D.warn("wrongLevelHigh",{level:`max: ${o.max}`})}if(a){let n=this.dailyArgs[e.dataset.daily];if(n){let i=await a(t,n);if(typeof i=="object")return i.data?game.i18n.format(i.error,i.data):game.i18n.localize(i.error);if(i===!1)return D.warn("wrongCustom")}}pe(t,e)}l(Nt,"onDropFeat");async function $t(t,e,r){if(!t.isOfType("spell"))return D("notSpell");let{search:s,drop:a}=r;if(s.category?.length){let n=s.category.map(i=>game.i18n.localize(i==="cantrip"?"PF2E.SpellCantripLabel":CONFIG.PF2E.preparationType[i])).join(", ");if(t.isCantrip&&!s.category.includes("cantrip")||t.isFocusSpell&&!s.category.includes("focus")||t.isRitual&&!s.category.includes("ritual")||!t.isCantrip&&!t.isFocusSpell&&!t.isRitual&&!s.category.includes("spell"))return D.warn("wrongCategory",{categories:n})}if(s.traits){let n=Le(s.traits);if(n?.selected.length){let i=n.conjunction==="or"?"some":"every";if(!n.selected[i](c=>Number(c.not??!1)-Number(t.traits.has(c.value))))return D.warn("wrongTraits")}}if(s.traditions?.length&&!s.traditions.some(n=>t.traditions.has(n)))return D.warn("wrongTradition",{traditions:Z("magicTraditions",s.traditions)});let o=Xe(this.actor,s.level);if(o?.length&&!o.includes(t.level))return D.warn("wrongLevel",{levels:o.join(", ")});if(s.school?.length&&!s.school.includes(t.school))return D.warn("wrongSchool",{schools:Z("magicSchools",s.school)});if(s.rarity?.length&&!s.rarity.includes(t.system.traits.rarity))return D.warn("wrongRarity",{rarities:Z("rarityTraits",s.rarity)});if(s.source?.length&&!s.source.includes(W(t.system.source.value)))return D.warn("wrongSource",{sources:s.source.join(", ")});if(a){let n=this.dailyArgs[e.dataset.daily];if(n){let i=await a(t,n);if(typeof i=="object")return i.data?ui.notifications.warn(game.i18n.format(i.error,i.data)):ui.notifications.warn(game.i18n.localize(i.error));if(i===!1)return D.warn("wrongCustom")}}pe(t,e)}l($t,"onDropSpell");function Z(t,e){return e.map(s=>game.i18n.localize(CONFIG.PF2E[t][s])).join(", ")}l(Z,"localizeAll");function pe(t,e){e.value=t.name,e.dataset.uuid=t.uuid,e.nextElementSibling.nextElementSibling.classList.remove("disabled")}l(pe,"onDropItem");async function Mt(){let t=this.actor,e=this.dailies,r=Pr.call(this),s=[],a=new Map,[o,n]=_e(),i={},u=O("message"),c=!1,d="",f=l(p=>{let g=p.id,w=a.get(g);if(w)return w;let b=deepClone(p._source.system.rules);for(let h=b.length-1;h>=0;h--)v in b[h]&&b.splice(h,1);return a.set(g,b),b},"getRules"),m={languages:{order:80,messages:[]},skills:{order:70,messages:[]},resistances:{order:60,messages:[]},feats:{order:50,messages:[]},spells:{order:40,messages:[]},scrolls:{order:30,messages:[]}},y={add:(p,g)=>{m[p]??={order:0,messages:[]},m[p].messages.push(g)},addGroup:(p,g=1,w)=>{m[p]??={label:w,order:g,messages:[]}}};if(t.familiar&&r["dailies.familiar"]){let p=t.familiar,g=Ae(),w=[],b=p.itemTypes.action.map(h=>h.id);b.length&&p.deleteEmbeddedDocuments("Item",b),y.addGroup("familiar",20);for(let h of Object.values(r["dailies.familiar"])){let k=h.value,x=k.includes("."),F=await(x?fromUuid(k):g.getDocument(k));if(!F||!F.isOfType("action"))continue;let E=F.toObject();E&&(w.push(E),y.add("familiar",{uuid:x?k:Et(k)}))}w.length&&p.createEmbeddedDocuments("Item",w)}if(r["dailies.rations"]?.rations.value==="true"){let p=Fe(t);if(p?.uses.value){let g=p.quantity,{value:w,max:b}=p.uses;w<=1?g<=1?p.delete():n({_id:p.id,"system.quantity":Math.max(p.quantity-1,0),"system.charges.value":b}):n({_id:p.id,"system.charges.value":Math.max(w-1,0)});let h=(g-1)*b+w,k=h<=1?it(p.name):Ue(p.uuid);h<=1?d+=u("rations.last",{name:k}):h<=3?d+=u("rations.almost",{name:k,nb:h-1}):d+=u("rations.used",{name:k,nb:h-1})}}if(r["dailies.staff"]){let p=r["dailies.staff"].staffID.value,g=t.items.get(p),w=X(t);if(g&&w){let b=[],h,k=/<strong>(?<rank>[a-zA-Z0-9]+)<\/strong>.+?(?<uuids>@UUID\[[a-zA-Z0-9-.]+\].+?)\n/g;for(;(h=k.exec(g.description))!==null;){let x=parseInt(h.groups.rank.trim())||0,F,E=/@UUID\[([a-zA-Z0-9-.]+)\]/g;for(;(F=E.exec(h.groups.uuids))!==null;)b.push({rank:x,uuid:F[1]})}if(b.length){let x=0,F=r["dailies.staff"].expend?.value,E=t.items.get(F),ee=St(E);if(ee){let{entry:L,rank:ye,slot:he}=ee;x=ye,n({_id:L.id,[`system.slots.slot${ye}.prepared.${he}.expended`]:!0})}let{attribute:P,tradition:ge,rank:Ne,slug:R}=kt(t)??{},te={type:"spellcastingEntry",name:g.name,system:{ability:{value:P??""},prepared:{value:"charge"},showSlotlessLevels:{value:!1},showUnpreparedSpells:{value:!1},proficiency:{value:Ne??1,slug:R},tradition:{value:ge??""}},flags:{[v]:{type:"staff",staff:{charges:w+x,staveID:p,overcharge:x}}}};s.push(te),await Promise.all(b.map(async({rank:L,uuid:ye})=>{let he=await A.createSpellSource(ye);setProperty(he,`flags.${v}.entry`,{level:L,type:"staff"}),s.push(he)}));let V=x?"staff.withExpend":"staff.noExpend";y.addGroup(V,45),y.add(V,{uuid:g.uuid}),x&&y.add(V,{uuid:E.uuid,label:`${E.name} (${A.spellRankLabel(ee.rank)})`})}}}for(let{item:p,key:g,process:w}of e){if(!r[g])continue;let b=this.dailyArgs[g];try{await w({...b,fields:r[g],messages:y,addItem:h=>s.push(h),updateItem:n,addRule:(h,k)=>{h[v]=!0,f(k??p).push(h)},addFeat:(h,k)=>{if(k??=p,k.isOfType("feat")){let x=k.id;setProperty(h,"flags.pf2e.grantedBy",{id:x,onDelete:"cascade"}),setProperty(h,`flags.${v}.grantedBy`,x)}s.push(h)},addSpell:(h,k)=>{setProperty(h,`flags.${v}.entry`,{level:k,type:"fallback"}),s.push(h),c=!0}})}catch(h){U("error.unexpected"),console.error(h),console.error(`The error occured during processing of ${g}`)}}for(let[p,g]of Object.entries(r)){let w=this.rows[p];if(w)for(let{row:b,type:h,input:k,value:x,uuid:F}of Object.values(g)){if(h==="random"||w[b]?.save===!1)continue;let E=i[p]??={};h==="combo"?E[b]={input:k==="true",selected:x}:h==="drop"?E[b]={uuid:F,name:x}:E[b]=x}}for(let[p,g]of a)n({_id:p,"system.rules":g});if(c){let p={type:"spellcastingEntry",name:S("spellEntry.name"),system:{prepared:{value:"innate"},showSlotlessLevels:{value:!1},showUnpreparedSpells:{value:!1},proficiency:{value:1,slug:t.classDC?.slug||t.class?.slug||void 0}},flags:{[v]:{type:"fallback"}}};s.push(p)}for(let p of s)getProperty(p,"system.temporary")===!0||setProperty(p,`flags.${v}.temporary`,!0);if(s.length){let p=await t.createEmbeddedDocuments("Item",s);for(let g of p)if(g.isOfType("feat")){let w=I(g,"grantedBy");if(w){let h=`flags.pf2e.itemGrants.${W(g.name,{camel:"dromedary"})}`;n({_id:w,[h]:{id:g.id,onDelete:"detach"}})}}else if(g.isOfType("spellcastingEntry")){let w=I(g,"type"),b=p.filter(h=>h.isOfType("spell")&&I(h,"entry")?.type===w);for(let h of b){let{level:k}=I(h,"entry"),x={_id:h.id,"system.location.value":g.id};k!==void 0&&(x["system.location.heightenedLevel"]=k),n(x)}}}await t.update({[`flags.${v}`]:{...expandObject(i),rested:!1}}),o.size&&await t.updateEmbeddedDocuments("Item",o.contents),d=Tr(m,d),d=d?`${u("changes")}<hr />${d}`:u("noChanges"),ChatMessage.create({content:d,speaker:ChatMessage.getSpeaker({actor:t})})}l(Mt,"processData");function Tr(t,e){let r=O("message"),s=Object.entries(t).map(([a,o])=>(o.label??=r.has(a)?r(a):r("gained",{type:a}),o));s.sort((a,o)=>o.order-a.order);for(let{label:a,messages:o}of s)if(o.length){e&&(e+="<hr />"),a&&(e+=`<p><strong>${a}</strong></p>`);for(let{uuid:n,selected:i,label:u,random:c}of o){let d=`label.${u}`;u=u&&se(d)?S(d):u||"",e+="<p>",e+=n?`${Ue(n,u)}`:`<strong>${u}</strong>`,i&&(e+=` <span>${i}</span>`),c&&(e+=' <i class="fa-solid fa-dice-d20"></i>'),e+="</p>"}}return e}l(Tr,"parseMessages");function Pr(){let t=this.element.find(".window-content .content").find("input:not(.alert), select[data-type]").toArray(),e={};for(let r of t){let s={...r.dataset,value:r.value};if(s.type==="combo"&&s.input==="false"){let a=r.previousElementSibling;s.value=a.value}e[s.daily]??={},e[s.daily][s.row]=s}return e}l(Pr,"getFields");var M=O("interface"),fe=class extends Application{constructor(e,r){super(r),this._actor=e,this._dailies=[],this._dailyArgs={},this._saved={},this._children={},this._custom={},this._predicate={},this._rows={}}static get defaultOptions(){return mergeObject(super.defaultOptions,{id:"pf2e-dailies-interface",template:H("interface.hbs"),height:"auto",width:400,submitOnClose:!1,submitOnChange:!1,dragDrop:[{dropSelector:'[data-droppable="true"]'}]})}get actor(){return this._actor}get dailies(){return this._dailies}get dailyArgs(){return this._dailyArgs}get saved(){return this._saved}get children(){return this._children}get custom(){return this._custom}get predicate(){return this._predicate}get rows(){return this._rows}async getData(e){let r=[],s=this._actor;if(this._dailies=Ct(s),s.familiar){let n="dailies.familiar",i=O("label"),u=s.attributes.familiarAbilities.value,c=Ae(),d=I(s,n)??{},f={label:i("familiar"),rows:[]},m=c.index.map(({_id:p,name:g})=>({value:p,label:g})),y=T("familiar").split(",");for(let p of y){p=p.trim();let g=await fromUuid(p);g&&g.isOfType("action")&&m.push({value:p,label:g.name})}m.sort((p,g)=>p.label.localeCompare(g.label));for(let p=0;p<u;p++)f.rows.push({label:i("ability",{nb:p+1}),value:d[`${p}`]??"",order:100,options:m,data:{type:"select",daily:n,row:p.toString()}});f.rows.length&&(this._rows[n]=f.rows.reduce((p,{data:g})=>(p[g.row]={save:!0},p),{}),r.push(f))}{let n=Fe(s);if(n?.uses.value){let i="dailies.rations",u="rations",{value:c,max:d}=n.uses,m=(n.quantity-1)*d+c,y=m<=1,p=[{value:"false",label:M("rations.no")},{value:"true",label:y?M("rations.last"):M("rations.yes",{nb:m})}];r.push({label:n.name,rows:[{label:"",order:200,value:"false",options:p,data:{type:"select",daily:i,row:u}}]}),this._rows[i]={[u]:{save:!1}}}}if(!j()){let n=s.itemTypes.weapon.filter(u=>{let c=u.system.traits?.value;return!c||!c.includes("staff")?!1:c.includes("coda")||c.includes("magical")});if(X(s)&&n.length){let u="dailies.staff",c=I(s,u)??{},d=n.map(y=>({value:y.id,label:y.name}));d.sort((y,p)=>y.label.localeCompare(p.label));let f={label:M("staves.prepare"),rows:[{label:M("staves.staff"),value:c.staffID??"",order:100,options:d,data:{type:"select",daily:u,row:"staffID"}}]},m=vt(s);if(m.length){m.sort((p,g)=>p.rank-g.rank);let y=m.map(p=>({value:p.id,label:`${p.name} (${A.spellRankLabel(p.rank)})`}));y.unshift({value:"",label:""}),f.rows.push({label:M("staves.expend"),value:"",order:100,options:y,data:{type:"select",daily:u,row:"expend"}})}r.push(f),this._rows[u]={staffID:{save:!0},overcharge:{save:!1}}}}for(let n of this._dailies)try{let i=await Ft.call(this,n);r.push(i)}catch(i){M.error("error.unexpected"),console.error(i),console.error(`The error occured during templating of ${n.key}`)}let a=[],o=[];for(let n of r)n.rows.length>1?o.push(n):n.rows.length&&a.push(n);return a.sort((n,i)=>i.rows[0].order-n.rows[0].order),o.sort((n,i)=>n.rows.length-i.rows.length),mergeObject(super.getData(e),{i18n:M,dump:({value:n,placeholder:i,data:u})=>{let c="";return n&&(c+=` value="${n}"`),i&&(c+=` placeholder="${i}"`),Object.entries(u).forEach(([d,f])=>c+=` data-${d}="${f}"`),c&&(c+=" "),c},rows:a,groups:o,hasDailies:a.length||o.length})}render(e,r){return this._randomInterval&&clearInterval(this._randomInterval),this.element.find("select.random")&&(this._randomInterval=setInterval(()=>{this.element.find("select.random").each((a,o)=>{o.selectedIndex=(o.selectedIndex+1)%o.options.length})},2e3)),super.render(e,r)}close(e){return this._randomInterval&&clearInterval(this._randomInterval),super.close(e)}activateListeners(e){super.activateListeners(e),e.find("[data-action=clear]").on("click",this.#c.bind(this)),e.find("[data-action=accept]").on("click",this.#l.bind(this)),e.find("[data-action=cancel]").on("click",this.#u.bind(this)),e.find(".combo select").on("change",this.#n.bind(this)),e.find(".combo input").on("change",this.#a.bind(this)),e.find("[data-action=search]").on("click",this.#s.bind(this)),e.find("[data-action=alert]").on("click",this.#e.bind(this))}_canDragDrop(e){return!0}async _onDrop(e){let r=O("interface.error.drop"),s=e.target;s instanceof HTMLLabelElement&&(s=s.nextElementSibling);try{let a=e.dataTransfer?.getData("text/plain"),o=JSON.parse(a);if(!o||o.type!=="Item"||typeof o.uuid!="string")return r.warn("wrongDataType");let n=await fromUuid(o.uuid);if(!n)return r.warn("wrongDataType");let i=await this.#r(s);if(!i)return pe(n,s);i.type==="feat"?Nt.call(this,n,s,i):i.type==="spell"?$t.call(this,n,s,i):pe(n,s)}catch(a){r.error("error.unexpected"),console.error(a),console.error("The error occured during _onDrop")}}async#e(e){e.preventDefault(),this.#t();let r=e.currentTarget.dataset,s=this.rows[r.daily][r.row],a=this.dailyArgs[r.daily],o;try{o=await s.fix(a)}catch(n){M.error("error.unexpected"),console.error(n),console.error(`The error occured during an alert fix of '${r.daily}'`)}this.#i(),o&&this.render()}async#s(e){e.preventDefault();let r=await this.#r(e.currentTarget,!0);r?game.pf2e.compendiumBrowser.openTab(r.type,r.search):game.pf2e.compendiumBrowser.render(!0)}async#r(e,r){let{daily:s,row:a}=e.dataset,o=this.rows[s]?.[a]?.filter,n=this.dailyArgs[s];if(!(!n||!o))return typeof o.search=="function"&&(o.search=await o.search(n)),r?Lt.call(this,o):o}#n(e){let r=e.currentTarget,s=r.nextElementSibling;s.dataset.input="false",s.value=r.options[r.selectedIndex].text}#a(e){let r=e.currentTarget,s=r.previousElementSibling,a=r.value.toLowerCase(),n=Array.from(s.options).map(i=>i.value).indexOf(a);n!==-1?(s.value=a,r.value=s.options[n].text,r.dataset.input="false"):(s.value="",r.dataset.input="true")}#t(){this.element.addClass("disabled")}#i(){this.element.removeClass("disabled")}#o(){let e=[],r=this.element.find("input").filter((a,o)=>!o.value),s=this.element.find("input.alert");return r.length&&e.push("error.empty"),s.length&&e.push("error.unattended"),e.forEach(a=>M.warn(a)),!e.length}async#l(e){e.preventDefault(),this.#o()&&(this.#t(),await Mt.call(this),this.close())}#c(e){e.preventDefault();let r=$(e.currentTarget),s=r.prevAll("input").first();s.val(""),s.attr("value",""),s.attr("data-uuid",""),r.addClass("disabled")}#u(e){e.preventDefault(),this.close()}};l(fe,"DailiesInterface");function Ut(t,e){I(t,"isWatch")&&e.find(".message-content button").on("click",()=>Q())}l(Ut,"renderChatMessage");function jt(){let t=`<div>${S("message.dailiesRequest.content")}</div>`;t+=`<button type="button" style="margin-top: 8px;">${S("message.dailiesRequest.button")}</button>`,at().create({content:t,flags:{[v]:{isWatch:!0}}})}l(jt,"createWatchChatMessage");var Lr="tLa4bewBhyqzi6Ow",_r={1:"RjuupS9xyXDLgyIr",2:"Y7UD64foDbDMV9sx",3:"ZmefGBXGJF3CFDbn",4:"QSQZJ5BC3DeHv153",5:"tjLvRWklAylFhBHQ",6:"4sGIy77COooxhQuC",7:"fomEZZ4MxVVK3uVu",8:"iPki3yuoucnj7bIt",9:"cFHomF3tty8Wi1e5",10:"o1XIHJ4MJyroAHfF"},Nr={1:"UJWiN0K3jqVjxvKk",2:"vJZ49cgi8szuQXAD",3:"wrDmWkGxmwzYtfiA",4:"Sn7v9SsbEDMUIwrO",5:"5BF7zMnrPYzyigCs",6:"kiXh4SUWKr166ZeM",7:"nmXPj9zuMRQBNT60",8:"Qs8RgNH6thRPv2jt",9:"Fgv722039TVM5JTc"},$r={cantripDeck5:"PF2E.Item.Physical.FromSpell.CantripDeck5",scroll:"PF2E.Item.Physical.FromSpell.Scroll",wand:"PF2E.Item.Physical.FromSpell.Wand"},Mr=new Set(["arcane","divine","occult","primal"]);async function Qe(t,e,{heightenedLevel:r,mystified:s=!1,temp:a=!1,itemName:o,itemImg:n}){let i=await fromUuid(t);if(!i)return null;r??=i.baseRank,(!o||typeof o!="string")&&(o??=e);let u=game.packs.find(p=>p.collection==="pf2e.equipment-srd"),c=Ur(e,r),d=await u?.getDocument(c??"");if(!ot(d,"ConsumablePF2e"))return null;let f={...d.toObject(),_id:null},m=f.system.traits;m.value=Array.from(new Set([...m.value,...i.traits])),m.rarity=i.rarity,m.value.includes("magical")&&m.value.some(p=>Mr.has(p))&&m.value.splice(m.value.indexOf("magical"),1),m.value.sort(),f.name=jr(o,i.name,r);let y=f.system.description.value;return f.system.description.value=(()=>{let p=document.createElement("p");p.append(i.sourceId?`@UUID[${i.sourceId}]{${i.name}}`:i.description);let g=document.createElement("div"),w=document.createElement("hr");return g.append(p,w),w.insertAdjacentHTML("afterend",y),g.innerHTML})(),e!=="cantripDeck5"&&(f.system.spell=i.clone({"system.location.heightenedLevel":r}).toObject()),s&&(f.system.identification.status="unidentified"),typeof n=="string"&&(f.img=n),f.system.temporary=a,f}l(Qe,"createConsumableFromSpell");function Ur(t,e){switch(t){case"cantripDeck5":return Lr;case"scroll":return _r[e]??null;default:return Nr[e]??null}}l(Ur,"getIdForSpellConsumable");function jr(t,e,r){let s=$r[t]||`${t} of {name} (Level {level})`;return game.i18n.format(s,{name:e,level:r})}l(jr,"getNameForSpellConsumable");var zt="max(1,floor(@actor.level/2))",zr=["propertyRune1","propertyRune2","propertyRune3","propertyRune4"],Wt,Gt,A={get skillNames(){return Wt??=Object.keys(CONFIG.PF2E.skillList).filter(t=>t!=="lore"),Wt.slice()},skillLabel:t=>game.i18n.localize(CONFIG.PF2E.skillList[t]),createSkillRuleElement:({skill:t,value:e,mode:r="upgrade",predicate:s})=>{let a={key:"ActiveEffectLike",mode:r,path:`system.skills.${t}.rank`,value:e};return s&&s.length&&(a.predicate=s),a},createLoreSource:({name:t,rank:e})=>({type:"lore",img:"systems/pf2e/icons/default-icons/lore.svg",name:t,system:{proficient:{value:e}}}),get languageNames(){return Gt??=Object.keys(CONFIG.PF2E.languages),Gt.slice()},languageLabel:t=>game.i18n.localize(CONFIG.PF2E.languages[t]),createLanguageRuleElement:({language:t,mode:e="add",predicate:r})=>{let s={key:"ActiveEffectLike",mode:e,path:"system.traits.languages.value",value:t};return r&&r.length&&(s.predicate=r),s},resistanceLabel:(t,e)=>{let r=game.i18n.localize(`PF2E.Trait${xe(t)}`);return e&&(r+=` ${e}`),r},createResistanceRuleElement:({type:t,value:e,predicate:r})=>{e==="half"&&(e=zt);let s={key:"Resistance",type:t,value:e};return r&&r.length&&(s.predicate=r),s},createFeatSource:async t=>{let e=(await fromUuid(t))?.toObject();if(!e)throw new Error(`An error occured while trying to create a feat source with uuid: ${t}`);return e},createSpellScrollSource:async({uuid:t,level:e,itemName:r,itemImg:s})=>{let a=await Qe(t,"scroll",{heightenedLevel:e,temp:!0,itemName:r,itemImg:s});if(!a)throw new Error(`An error occured while trying to create a spell scroll source with uuid: ${t}`);return a},createWandSource:async({uuid:t,level:e,itemName:r,itemImg:s})=>{let a=await Qe(t,"wand",{heightenedLevel:e,temp:!0,itemName:r,itemImg:s});if(!a)throw new Error(`An error occured while trying to create a wand source with uuid: ${t}`);return a},createSpellSource:async t=>{let e=(await fromUuid(t))?.toObject();if(!e)throw new Error(`An error occured while trying to create a spell source with uuid: ${t}`);return e},spellRankLabel:t=>game.i18n.format("PF2E.Item.Spell.Rank.Ordinal",{rank:Wr(t)}),get halfLevelString(){return zt},getChoiSetRuleSelection:(t,e)=>t._source.system.rules.find(a=>a.key==="ChoiceSet"&&a.rollOption===e)?.selection,proficiencyLabel:t=>game.i18n.localize(CONFIG.PF2E.proficiencyLevels[t]),randomOption:async t=>{let e=(await new Roll(`1d${t.length}`).evaluate({async:!0})).total,r=t[e-1];return typeof r=="string"?r:r.value},halfLevelValue:t=>Math.max(1,Math.floor(t.level/2)),sequenceArray:ke,damageLabel:t=>game.i18n.localize(CONFIG.PF2E.damageTypes[t]),weaponTraitLabel:t=>game.i18n.localize(CONFIG.PF2E.weaponTraits[t]),weaponPropertyRunesLabel:t=>{let e=`PF2E.WeaponPropertyRune.${t}.Name`;return game.i18n.localize(e)},hasFreePropertySlot:t=>{let e=t.system.runes.potency;return e>0&&t.system.runes.property.length<e},getFreePropertyRuneSlot:t=>{let e=t.system.potencyRune.value;if(e===null)return null;for(let r=0;r<e;r++){let s=zr[r];if(!t.system[s].value)return s}return null},getPlayersActors:(t,...e)=>{e.length||(e=["creature"]);let r=game.actors;if(t){let s=T("members")?Array.from(t.parties??[]).flatMap(a=>a.members):null;s?r=s:r=r.filter(a=>a.hasPlayerOwner),t instanceof Actor&&(r=r.filter(a=>a!==t))}else r=r.filter(s=>s.hasPlayerOwner);return r.filter(s=>s.isOfType(...e))}};function Wr(t){let e=new Intl.PluralRules(game.i18n.lang,{type:"ordinal"}),r=game.i18n.localize(`PF2E.OrdinalSuffixes.${e.select(t)}`);return game.i18n.format("PF2E.OrdinalNumber",{value:t,suffix:r})}l(Wr,"ordinalString");function Q(t){if((!t||!t.isOfType("character")||!t.isOwner)&&(t=canvas.tokens.controlled.find(r=>r.actor?.isOfType("character")&&r.actor.isOwner)?.actor,t||(t=game.user.character)),!t||!t.isOfType("character")||!t.isOwner)return C("error.noCharacterSelected");if(I(t,"rested")!==!0)return C("error.unrested");new fe(t,{title:S("interface.title",{name:t.name})}).render(!0)}l(Q,"openDailiesInterface");function Bt(){if(!game.user.isGM)return C("error.notGM");jt()}l(Bt,"requestDailies");function _e(){let t=new Collection;return[t,e=>{let r=e._id;if(!r)return;let s=t.get(r)??{};t.set(r,mergeObject(s,e))}]}l(_e,"createUpdateCollection");async function qt(){let t=(await this.getCraftingEntries()).filter(a=>a.isDailyPrep),r=t.filter(a=>a.isAlchemical).reduce((a,o)=>a+o.reagentCost,0),s=(this.system.resources.crafting.infusedReagents.value||0)-r;if(s<0){ui.notifications.warn(game.i18n.localize("PF2E.CraftingTab.Alerts.MissingReagents"));return}else await this.update({"system.resources.crafting.infusedReagents.value":s});for(let a of t)for(let o of a.preparedCraftingFormulas){let n=o.item.toObject();n.system.quantity=o.quantity,n.system.temporary=!0,n.system.size=this.ancestry?.size==="tiny"?"tiny":"med",a.isAlchemical&&(n.type==="consumable"||n.type==="weapon"||n.type==="equipment")&&n.system.traits.value.push("infused"),await this.addToInventory(n)}}l(qt,"onPerformDailyCrafting");function Vt(t,e){let r=t.actor;if(!r.isOwner)return;e.find("aside .sidebar .hitpoints .hp-small").append(`<a class="roll-icon dailies" data-tooltip="${S("sheet.title")}"><i class="fas fa-mug-saucer"></i></a>`).find(".dailies").on("click",()=>Q(r)),j()||Gr(e,r)}l(Vt,"renderCharacterSheetPF2e");function Gr(t,e){let s=t.find(".sheet-body .sheet-content [data-tab=spellcasting] .spellcastingEntry-list").find("[data-container-type=spellcastingEntry]:not([data-container-id=rituals])"),{el:a,entry:o,staffData:n}=(()=>{for(let d of s){let f=d.dataset.containerId,m=e.spellcasting.get(f),y=oe(m);if(y)return{el:d,entry:m,staffData:y}}return{}})();if(!a)return;let i=$(`<div class="pf2e-dailies-charges"><label>${S("staves.label")}</label></div>`),u=$(`<input type="number" min="0" max="${n.max}" value="${n.charges}">`);u.on("change",d=>qr(d,e));let c=$('<a><i class="fas fa-redo"></i></a>');c.on("click",d=>Br(d,e)),i.append(u),i.append(c),a.querySelector(".spell-ability-data .statistic-values").after(i[0])}l(Gr,"renderStavesEntries");function Yt(t,e){let{itemId:r}=t.currentTarget.closest(".spellcasting-entry").dataset;return e.spellcasting.get(r)}l(Yt,"getEntryDataFromEvent");async function Br(t,e){let r=Yt(t,e);le(r,9999)}l(Br,"onStaffChargesReset");async function qr(t,e){let r=Yt(t,e);le(r,t.currentTarget.valueAsNumber)}l(qr,"onStaffChargesChange");function X(t){let e=0,r=ce(t,{itemOnly:!0});for(let s of r){let a=De(s);a>e&&(e=a)}return e}l(X,"getActorMaxSlotRank");var Ht=["/** @typedef {'flexibility' | 'improved'} FlexibilityRow */","/** @typedef {'improved'} FlexibilityChild */","/** @typedef {[FlexibilityRow, {}, FlexibilityChild]} FlexibilityGenerics */","","/**"," * @param {FlexibilityRow} slug"," * @param {number} level"," * @param {FlexibilityChild} [child]"," */","function createRow(slug, level, child) {","    /** @type {DailyRowDrop<FlexibilityGenerics>} */","    const row = {","        type: 'drop',","        label: `PF2E.Level${level}`,","        slug,","        filter: {","            type: 'feat',","            search: {","                category: ['class'],","                traits: {","                    values: ['fighter'],","                },","                level,","            },","        },","    }","    if (child) row.childPredicate = [child]","    return row","}","","/** @type {Daily<FlexibilityGenerics>} */","const combatFlexibility = {","    key: 'flexibility',","    item: {","        uuid: 'Compendium.pf2e.classfeatures.Item.8g6HzARbhfcgilP8', // Combat Flexibility","    },","    children: [","        {","            slug: 'improved',","            uuid: 'Compendium.pf2e.classfeatures.Item.W2rwudMNcAxs8VoX', // Improved Flexibility","        },","    ],","    rows: [","        createRow('flexibility', 8), //","        createRow('improved', 14, 'improved'),","    ],","    process: async ({ utils, fields, addFeat, messages, children }) => {","        const uuid = fields.flexibility.uuid","        const source = await utils.createFeatSource(uuid)","        addFeat(source)","        messages.add('feats', { uuid })","","        if (children.improved) {","            const uuid = fields.improved.uuid","            const source = await utils.createFeatSource(uuid)","            addFeat(source, children.improved)","            messages.add('feats', { uuid })","        }","    },","}","","return combatFlexibility"].join(`
`);var Jt=["/** @typedef {'alert' | 'smith' | 'mental' | 'runic' | 'advanced'} MindRow */","/** @typedef {'weapon' | 'mental' | 'runic' | 'advanced'} MindChild */","/** @typedef {[MindRow, {}, MindChild]} MindGenerics */","","const MIND_WEAPON_UUID = 'Compendium.pf2e-dailies.equipment.Item.VpmEozw21aRxX15P'","","const WEAPON_BASE_TYPES = {","    0: { die: 'd4', traits: ['finesse', 'agile'], usage: 'held-in-one-hand' },","    1: { die: 'd6', traits: ['finesse'], usage: 'held-in-one-hand' },","    2: { die: 'd8', traits: [], usage: 'held-in-one-hand' },","    3: { die: 'd10', traits: ['reach'], usage: 'held-in-two-hands' },","}","","const WEAPON_GROUPS = /** @type {Record<WeaponDamage, string>} */ {","    slashing: 'sword',","    piercing: 'spear',","    bludgeoning: 'club',","}","","const WEAPON_TRAITS = ['grapple', 'nonlethal', 'shove', 'trip', 'modular']","","const WEAPON_DAMAGE_TYPES = Object.keys(WEAPON_GROUPS)","","const WEAPON_RUNES = ['corrosive', 'disrupting', 'flaming', 'frost', 'shock', 'thundering']","","const WEAPON_GREATER_RUNES = [","    'anarchic',","    'axiomatic',","    'greaterCorrosive',","    'greaterDisrupting',","    'greaterFlaming',","    'greaterFrost',","    'greaterShock',","    'greaterThundering',","    'holy',","    'unholy',","]","","/** @type {Daily<MindGenerics>} */","const mindSmith = {","    key: 'mindsmith',","    item: {","        uuid: 'Compendium.pf2e.feats-srd.Item.juikoiIA0Jy8PboY', // Mind Smith Dedication","    },","    children: [","        {","            slug: 'weapon',","            uuid: MIND_WEAPON_UUID, // Mind Weapon","        },","        {","            slug: 'mental',","            uuid: 'Compendium.pf2e.feats-srd.Item.PccekOihIbRWdDky', // Malleable Mental Forge","        },","        {","            slug: 'runic',","            uuid: 'Compendium.pf2e.feats-srd.Item.2uQbQgz1AbjzcFSp', // Runic Mind Smithing","        },","        {","            slug: 'advanced',","            uuid: 'Compendium.pf2e.feats-srd.Item.fgnfXwFcn9jZlXGD', // Advanced Runic Mind Smithing","        },","    ],","    rows: [","        {","            type: 'alert',","            slug: 'alert',","            message: 'Missing Mind Weapon',","            fix,","            childPredicate: [{ not: 'weapon' }],","        },","        {","            type: 'select',","            slug: 'smith',","            label: 'Mind Smith',","            options: WEAPON_DAMAGE_TYPES,","            labelizer: ({ utils }) => utils.damageLabel,","            childPredicate: ['weapon'],","        },","        {","            type: 'select',","            slug: 'mental',","            label: 'Mental Forge',","            options: WEAPON_TRAITS,","            labelizer: ({ utils }) => utils.weaponTraitLabel,","            childPredicate: ['weapon', 'mental'],","        },","        {","            type: 'select',","            slug: 'runic',","            label: 'Runic Smithing',","            options: WEAPON_RUNES,","            labelizer: ({ utils }) => utils.weaponPropertyRunesLabel,","            childPredicate: ['weapon', 'runic', { not: 'advanced' }],","            condition: ({ children, utils }) => utils.hasFreePropertySlot(children.weapon),","        },","        {","            type: 'select',","            slug: 'advanced',","            label: 'Runic Smithing',","            options: WEAPON_GREATER_RUNES,","            labelizer: ({ utils }) => utils.weaponPropertyRunesLabel,","            childPredicate: ['weapon', 'advanced'],","            condition: ({ children, utils }) => utils.hasFreePropertySlot(children.weapon),","        },","    ],","    process: ({ children, updateItem, fields, messages, item, utils }) => {","        const weapon = children.weapon","        if (!weapon) return","","        messages.addGroup('mindsmith')","","        const selected = /** @type {WeaponDamage} */ fields.smith.value","        updateItem({ _id: weapon.id, 'system.damage.damageType': selected, 'system.group': WEAPON_GROUPS[selected] })","        messages.add('mindsmith', { selected: utils.damageLabel(selected), uuid: item.uuid, label: 'mindsmith' })","","        if (children.mental) {","            const selected = fields.mental.value","            const traits = deepClone(weapon._source.system.traits?.value ?? [])","            if (!traits.includes(selected)) traits.push(selected)","            updateItem({ _id: weapon.id, 'system.traits.value': traits })","            messages.add('mindsmith', {","                selected: utils.weaponTraitLabel(selected),","                uuid: children.mental.uuid,","                label: 'mentalforge',","            })","        }","","        if ((children.advanced || children.runic) && utils.hasFreePropertySlot(weapon)) {","            const child = children.advanced ?? children.runic","            const freeSlot = utils.getFreePropertyRuneSlot(weapon)","            const field = fields.advanced ?? fields.runic","            const selected = field.value","","            if (!weapon.system.runes.property.includes(selected)) {","                updateItem({ _id: weapon.id, [`system.${freeSlot}.value`]: selected, [`flags.world.runeSlot`]: freeSlot })","                messages.add('mindsmith', {","                    selected: utils.weaponPropertyRunesLabel(selected),","                    uuid: child.uuid,","                    label: 'runicmind',","                })","            }","        }","    },","    rest: ({ item, sourceId, updateItem }) => {","        if (sourceId !== MIND_WEAPON_UUID) return","","        let traits = item._source.system.traits?.value ?? []","        traits = traits.filter(trait => !WEAPON_TRAITS.includes(trait))","        updateItem({ _id: item.id, 'system.traits.value': traits })","","        const runeSlot = item.getFlag('world', 'runeSlot')","        if (runeSlot) {","            updateItem({ _id: item.id, [`system.${runeSlot}.value`]: null, [`flags.world.-=runeSlot`]: true })","        }","    },","}","","const OPTIONS = {","    0: 'A one-handed weapon that deals <strong>1d4</strong> damage and has the <strong>agile</strong> and <strong>finesse</strong> traits',","    1: 'A one-handed weapon that deals <strong>1d6</strong> damage and has the <strong>finesse</strong> trait',","    2: 'A one-handed weapon that deals <strong>1d8</strong> damage',","    3: 'A two-handed weapon that deals <strong>1d10</strong> damage and has the <strong>reach</strong> trait',","}","","/** * @param {DailyValueArgs<MindGenerics>} args */","async function fix({ actor }) {","    let content =","        `<p>This character doesn't have a mind weapon in their inventory.</p><p>Please select one of the following options to create one.</p>`","","    for (const [key, label] of Object.entries(OPTIONS)) {","        content += `<label><input type='radio' name='type' value='${key}'>${label}</label>`","    }","","    const weapon = await Dialog.wait(","        {","            title: 'Mind Weapon',","            content,","            buttons: {","                yes: {","                    icon: `<i class='fas fa-save'></i>`,","                    label: 'Accept',","                    callback: onWeaponSelected,","                },","                no: {","                    icon: `<i class='fas fa-times'></i>`,","                    label: 'Cancel',","                    callback: () => null,","                },","            },","            close: () => null,","        },","        {},","        { id: 'pf2e-dailies-weapon', width: 600 }","    )","","    if (weapon) {","        await actor.createEmbeddedDocuments('Item', [weapon])","        return true","    }","","    return false","}","","/** @params {JQuery} html */","async function onWeaponSelected(html) {","    const selection = html.find('[name=type]:checked').val()","    if (!selection) {","        ui.notifications.warn('You must select one weapon base type.')","        return","    }","","    const weapon = (await fromUuid(MIND_WEAPON_UUID))?.toObject()","    if (!weapon) {","        ui.notifications.warn(`The weapon couldn't be found in the compendium.`)","        return","    }","","    const stats = WEAPON_BASE_TYPES[selection]","","    setProperty(weapon, 'system.damage.die', stats.die)","    setProperty(weapon, 'system.traits.value', stats.traits.slice())","    setProperty(weapon, 'system.usage.value', stats.usage)","","    return weapon","}","","return mindSmith"].join(`
`);var Xt=["/** @typedef {'first' | 'second' | 'third' | 'fourth'} SavantRow */","/** @typedef {Record<SavantRow, { level: number; condition: boolean }>} SavantCustom */","/** @typedef {[SavantRow, SavantCustom, '']} SavantGenerics */","","const ROWS = /** @type {const} */ (['first', 'second', 'third', 'fourth'])","","/**"," * @param {CharacterPF2e} actor"," * @param {MagicTradition} tradition"," */","function getSpellcastingTraditionDetails(actor, tradition) {","    let maxSlot = 1","    let maxTradition = 0","","    for (const entry of actor.spellcasting.regular) {","        if ('pf2e-staves' in entry.flags) continue // we skip staff entries","","        const slots = entry.system.slots","        for (const key in slots) {","            const slot = slots[key]","            if (slot.max) maxSlot = Math.max(maxSlot, Number(key.slice(4)))","        }","","        if (entry.tradition === tradition) maxTradition = Math.max(maxTradition, entry.rank)","    }","","    return { maxSlot: Math.min(maxSlot, 10), maxTradition }","}","","/** @type {Daily<SavantGenerics>} */","const scrollSavant = {","    key: 'savant',","    item: {","        uuid: 'Compendium.pf2e.feats-srd.Item.u5DBg0LrBUKP0JsJ', // Scroll Savant","    },","    prepare: ({ actor }) => {","        const { maxSlot, maxTradition } = getSpellcastingTraditionDetails(actor, 'arcane')","        return {","            first: { level: maxSlot - 2, condition: true },","            second: { level: maxSlot - 3, condition: true },","            third: { level: maxSlot - 4, condition: maxTradition >= 3 && maxSlot >= 5 },","            fourth: { level: maxSlot - 5, condition: maxTradition >= 4 && maxSlot >= 6 },","        }","    },","    rows: ROWS.map(rowName => {","        /** @type {DailyRowDrop<SavantGenerics>} */","        const row = {","            type: 'drop',","            slug: rowName,","            label: ({ custom }) => `PF2E.SpellLevel${custom[rowName].level}`,","            filter: {","                type: 'spell',","                search: ({ custom }) => ({","                    category: ['spell'],","                    traditions: ['arcane'],","                    level: custom[rowName].level,","                }),","            },","            condition: ({ custom }) => custom[rowName].condition,","        }","        return row","    }),","    process: async ({ utils, fields, custom, addItem, messages }) => {","        for (const field of Object.values(fields)) {","            const uuid = field.uuid","            const source = await utils.createSpellScrollSource({ uuid, level: custom[field.row].level })","            addItem(source)","            messages.add('scrolls', { uuid, label: source.name })","        }","    },","}","","return scrollSavant"].join(`
`);var Zt=["/** @typedef {typeof ROWS[number]} TomeRow */","/** @typedef {'adept' | 'second' | 'intense' | 'paragon'} TomeChild */","/** @typedef {Record<TomeRow, { rank: OneToFour; options: string[] }>} TomeCustom */","/** @typedef {[TomeRow, TomeCustom, TomeChild]} TomeGenerics */","","const ROWS = /** @type {const} */ (['first', 'second'])","","/** @param {'adept' | 'paragon'} option */","function createChildCondition(option) {","    /** @type { BaseDailyConditionFunction<TomeGenerics>} */","    const condition = ({ item, utils }) => {","        return utils.getChoiSetRuleSelection(item, option) === 'tome'","    }","    return condition","}","","/** @type {Daily<TomeGenerics>} */","const thaumaturgeTome = {","    key: 'tome',","    item: {","        uuid: 'Compendium.pf2e.classfeatures.Item.MyN1cQgE0HsLF20e', // Tome","    },","    children: [","        {","            slug: 'adept',","            uuid: 'Compendium.pf2e.classfeatures.Item.Obm4ItMIIr0whYeO', // Implement Adept","            condition: createChildCondition('adept'),","        },","        {","            slug: 'second',","            uuid: 'Compendium.pf2e.classfeatures.Item.ZEUxZ4Ta1kDPHiq5', // Second Adept","            condition: createChildCondition('adept'),","        },","        {","            slug: 'intense',","            uuid: 'Compendium.pf2e.feats-srd.Item.yRRM1dsY6jakEMaC', // Intense Implement","        },","        {","            slug: 'paragon',","            uuid: 'Compendium.pf2e.classfeatures.Item.QEtgbY8N2V4wTbsI', // Implement Paragon","            condition: createChildCondition('paragon'),","        },","    ],","    prepare: ({ utils, actor, children }) => {","        const skillNames = utils.skillNames","        const actorLevel = actor.level","        const actorSkills = /** @type {Record<SkillLongForm, { rank: ZeroToFour }>} */ (actor.skills)","","        /** @type {TomeCustom} */","        const custom = {","            first: { options: [], rank: 1 },","            second: { options: [], rank: 1 },","        }","","        // Implement Paragon","        if (children.paragon) {","            const skills = skillNames.filter(x => actorSkills[x].rank < 4)","            custom.first = { rank: 4, options: skills }","            custom.second = { rank: 4, options: skills }","        }","        // Intense Implement or Second Adept or Implement Adept","        else if (children.intense || children.adept || children.second) {","            const masters = skillNames.filter(x => actorSkills[x].rank < 3)","","            if (actorLevel >= 9) {","                custom.first = { rank: 3, options: masters }","                custom.second = { rank: 3, options: masters }","            } else {","                const experts = skillNames.filter(x => actorSkills[x].rank < 2)","                custom.first = { rank: 2, options: experts }","                custom.second = { rank: 3, options: masters }","            }","        }","        // Tome","        else {","            if (actorLevel >= 5) {","                const experts = skillNames.filter(x => actorSkills[x].rank < 2)","                custom.first = { rank: 2, options: experts }","                custom.second = { rank: 2, options: experts }","            } else if (actorLevel >= 3) {","                const trained = skillNames.filter(x => actorSkills[x].rank < 1)","                const experts = skillNames.filter(x => actorSkills[x].rank < 2)","                custom.first = { rank: 1, options: trained }","                custom.second = { rank: 2, options: experts }","            } else {","                const trained = skillNames.filter(x => actorSkills[x].rank < 1)","                custom.first = { rank: 1, options: trained }","                custom.second = { rank: 1, options: trained }","            }","        }","","        return custom","    },","    rows: ROWS.map(rowName => {","        /** @type {DailyRowCombo<TomeGenerics>} */","        const row = {","            type: 'combo',","            slug: rowName,","            label: ({ custom, utils }) => utils.proficiencyLabel(custom[rowName].rank),","            options: ({ custom }) => custom[rowName].options,","            labelizer: ({ utils }) => utils.skillLabel,","        }","        return row","    }),","    process: ({ custom, fields, utils, messages, addItem, addRule }) => {","        messages.addGroup('tome', 65)","","        for (const rowName of ROWS) {","            const rank = custom[rowName].rank","            let value = fields[rowName].value","","            if (fields[rowName].input === 'true') {","                const source = utils.createLoreSource({ name: value, rank })","                addItem(source)","            } else {","                const source = utils.createSkillRuleElement({ skill: value, value: rank })","                value = utils.skillLabel(value)","                addRule(source)","            }","","            messages.add('tome', { label: utils.proficiencyLabel(rank), selected: value })","        }","    },","}","","return thaumaturgeTome"].join(`
`);var z=O("customs"),Vr=["default","trainedSkill","trainedLore","language","resistance","feat","spell"],Ke=["flexibility","savant","tome","mind"],me=class extends FormApplication{static get defaultOptions(){return mergeObject(super.defaultOptions,{id:"pf2e-dailies-customs",title:z("title"),template:H("customs.hbs"),submitOnChange:!1,submitOnClose:!1,closeOnSubmit:!1,scrollY:[".left .list"]})}async _updateObject(e,r){}async getData(e){let r=T("customDailies"),s=r.find(i=>i.key===this._selectedDaily)?.code,a=this._selectedTemplate,o=game.modules.get("pf2e-dailies-ext"),n=o?.active&&isNewerVersion(tt,o.version)?{version:tt}:"";return mergeObject(super.getData(e),{i18n:z,template:a,templates:Vr,daily:this._selectedDaily,code:s,customs:r,examples:Ke,isExample:Ke.includes(a),monaco:o?.active,newVersion:n})}activateListeners(e){super.activateListeners(e),this._monaco?.dispose();let r=game.modules.get("pf2e-dailies-ext")?.api,s=e.find(".code")[0];if(r&&s){let a=e.find(".monaco .placeholder")[0];this._monaco=r.createEditor(a,s.value),this._monaco.onDidChangeModelContent(debounce(()=>s.value=this._monaco.getValue(),200))}else this._monaco=null;e.find("[data-action=select-template]").on("change",this.#i.bind(this)),e.find("[data-action=create-template]").on("click",this.#a.bind(this)),e.find("[data-action=create-daily]").on("click",this.#r.bind(this)),e.find(".row[data-key]").on("click",this.#n.bind(this)),e.find("[data-action=delete-daily]").on("click",this.#s.bind(this)),e.find("[data-action=save-code]").on("click",this.#e.bind(this))}get code(){return this.form.querySelector(".window-content .code")?.value}async#e(e){e.preventDefault();let r=this.code,s=this._selectedDaily;if(!s||!r)return;let a=T("customDailies"),o=a.filter(n=>n.key!==s);try{let u=(await new be(r)()).key;if(typeof u!="string")return C("invalidKey");if(o.find(d=>d.key===u))return C("duplicate");let c=a.findIndex(d=>d.key===s);if(c<0)return;a.splice(c,1,{key:u,code:r}),await we("customDailies",a),z.info("saved",{daily:u}),this._selectedDaily=u,this.render()}catch(n){U("error.unexpected"),console.error(n),console.error(`The error occured while testing the custom daily ${s}`)}}async#s(e){if(e.preventDefault(),e.stopPropagation(),!await Dialog.confirm({title:z("delete.title"),content:z("delete.content")}))return;let s=e.currentTarget.dataset.key,a=T("customDailies").filter(o=>o.key!==s);await we("customDailies",a),z.info("deleted",{daily:s}),this.#r()}#r(){this._selectedDaily="",this._selectedTemplate="default",this.render()}#n(e){e.preventDefault(),this._selectedDaily=e.currentTarget.dataset.key,this.render()}async#a(e){e.preventDefault();let r=this._selectedTemplate,s=T("customDailies"),a=new FormData(this.form),o=Object.fromEntries(a),n=Ke.includes(r),{key:i,uuid:u,label:c}=o;if(n)i=r;else if(!i||!u)return z.warn("template.noEmpty");if(s.find(f=>f.key===i))return C("error.duplicate");let d;if(r==="trainedSkill"){let f=B(i,u,c);d=this.#t(f,{key:i,uuid:u,label:c},"SkillGenerics")}else if(r==="trainedLore"){let f=Ee(i,u,c);d=this.#t(f,{key:i,uuid:u,label:c},"SkillGenerics")}else if(r==="language"){let f=ne(i,u,c);d=this.#t(f,{key:i,uuid:u,label:c},"LanguageGenerics")}else if(r==="resistance"){let f=et(o.resistance),m=K(o.resistances);if(f===""||!m.length)return z.warn("template.noEmpty");if(typeof f=="number"&&f<1)return z.warn("template.badResistance");let y=ae(i,u,m,f,c);d=this.#t(y,{key:i,uuid:u,label:c,resistance:f,resistances:m},"ResistanceGenerics")}else if(r==="feat"){let f=K(o.traits),m={category:K(o.category),level:et(o.level)||{min:0,max:20}};f.length&&(m.traits=f);let y=Ce(i,u,m,c);d=this.#t(y,{key:i,uuid:u,label:c},"FeatGenerics")}else if(r==="spell"){let f=Number(o.level)||void 0,m=K(o.traits),y=o.levels.split(",").map(w=>w.trim());y.length===1?y=et(y[0]):y=y.filter(w=>w).map(w=>Number(w)).filter(w=>!isNaN(w));let p={category:K(o.category),traditions:K(o.traditions),level:y||[]};m.length&&(p.traits=m);let g=Ie(i,u,p,f,c);d=this.#t(g,{key:i,uuid:u,label:c,level:f},"SpellGenerics")}else if(r==="tome")d=Zt;else if(r==="flexibility")d=Ht;else if(r==="savant")d=Xt;else if(r==="mind")d=Jt;else{let f={key:i,label:c,item:{uuid:u},rows:[],process:()=>{}};d=this.#t(f,{key:i,uuid:u,label:c})}s.push({key:i,code:d}),await we("customDailies",s),this._selectedDaily=i,this.render()}#t(e,r,s){let a="____PLACEHOLDER____",o=[],n=JSON.stringify(e,(c,d)=>typeof d=="function"?(o.push(d),a):d,4);n=n.replace(new RegExp('"'+a+'"',"g"),()=>o.shift()?.toString()?.replace(/( {5,})/g,d=>d.slice(4))??"");let i="";for(let[c,d]of Object.entries(r))typeof d=="string"?i+=`const ${c} = '${d}';
`:typeof d=="object"?i+=`const ${c} = ${JSON.stringify(d)};
`:i+=`const ${c} = ${d};
`;let u=s?`Daily<${s}>`:"Daily";return`${i}
/** @type {${u}} */
const daily = ${n};

return daily;`}#i(e){e.preventDefault(),this._selectedDaily="",this._selectedTemplate=e.currentTarget.value,this.render()}};l(me,"DailyCustoms");function K(t){return t.split(",").map(e=>e.trim()).filter(e=>e)}l(K,"splitList");function et(t){if(typeof t=="number"||(t=t.trim(),t==="level"||t==="half"))return t;let e=Number(t);return isNaN(e)?"":e}l(et,"simplyfiable");async function Qt(t){let e=[],[r,s]=_e(),a=j();for(let o of t.items){if(I(o,"temporary")){if(e.push(o.id),o.isOfType("feat")){let c=I(o,"grantedBy");if(c){let f=`flags.pf2e.itemGrants.-=${W(o.name,{camel:"dromedary"})}`;s({_id:c,[f]:!0})}}continue}if(!a&&o.isOfType("spellcastingEntry")&&o.system.prepared.value==="charge"){e.push(o.id);continue}let n=J(o);if(n){let c=Dt(n);c?.rest&&await c.rest({item:o,sourceId:n,updateItem:s,actor:t})}let i=deepClone(o._source.system.rules),u=!1;for(let c=i.length-1;c>=0;c--)v in i[c]&&(i.splice(c,1),u=!0);u&&s({_id:o.id,"system.rules":i})}r.size&&await t.updateEmbeddedDocuments("Item",r.contents),e.length&&await t.deleteEmbeddedDocuments("Item",e),await ve(t,"rested",!0)}l(Qt,"restForTheNight");var tt="1.3.0",Yr="CONFIG.PF2E.Item.documentClasses.spellcastingEntry.prototype.cast",Hr="CONFIG.PF2E.Actor.documentClasses.character.prototype.performDailyCrafting";Hooks.once("setup",()=>{re({name:"customDailies",type:Array,default:[],onChange:qe}),re({name:"familiar",type:String,default:"",config:!0}),re({name:"watch",type:Boolean,default:!1,config:!0,onChange:Kt}),re({name:"members",type:Boolean,default:!0,config:!0,scope:"user"}),nt({name:"customs",type:me}),game.modules.get(v).api={openDailiesInterface:t=>Q(t),requestDailies:Bt,getBuiltinDailies:()=>deepClone(Be),getCustomDailies:()=>deepClone(de),prepareDailies:Oe,checkCustomDaily:Ve,getUtils:()=>deepClone(A),getSpellcastingEntryStaffFlags:ie,getSpellcastingEntryStaffData:oe,updateEntryCharges:le},T("watch")&&Kt(!0),j()||(CONFIG.PF2E.preparationType.charge="Charge",libWrapper.register(v,Yr,wt))});Hooks.once("ready",async()=>{if(j()&&C("staves.conflict",!0),await qe(),!game.modules.get("lib-wrapper")?.active&&game.user.isGM){C("error.noLibwrapper",!0);return}libWrapper.register(v,Hr,qt,"OVERRIDE")});Hooks.on("pf2e.restForTheNight",Qt);Hooks.on("renderCharacterSheetPF2e",Vt);function Kt(t){Hooks[t?"on":"off"]("renderChatMessage",Ut)}l(Kt,"enableWatchHook");})();
//# sourceMappingURL=main.js.map
